<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>小龙播客</title>
  
  <subtitle>小龙播客</subtitle>
  <link href="https://xiaoyvlongoing.github.io/atom.xml" rel="self"/>
  
  <link href="https://xiaoyvlongoing.github.io/"/>
  <updated>2021-07-04T08:35:22.329Z</updated>
  <id>https://xiaoyvlongoing.github.io/</id>
  
  <author>
    <name>小龙</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>SQL数据类型</title>
    <link href="https://xiaoyvlongoing.github.io/2020/02/10/SQL%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
    <id>https://xiaoyvlongoing.github.io/2020/02/10/SQL%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</id>
    <published>2020-02-10T06:47:40.000Z</published>
    <updated>2021-07-04T08:35:22.329Z</updated>
    
    <content type="html"><![CDATA[<h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><p>数据库：就是以一定格式进行组织的数据集合</p><p>关系是用表格存储的，二维表格存储</p><p>非关系是用字典类型存储的</p><p>数据库管理系统：DBMS</p><ul><li>数据库文件集合：主要一系列的数据文件，作用存储数据</li></ul><p>SQL语句：结构化查询语言</p><p>数据库文件一般都是.db后缀名</p><ol><li>取数据与数据库交流</li><li></li></ol><table><thead><tr><th>SQL语句</th><th>语句的性质</th></tr></thead><tbody><tr><td>sudo apt-get install mysql-server</td><td>安装服务端</td></tr><tr><td>sudo apt-get install mysql-client</td><td>安装客户端</td></tr><tr><td>sudo service mysql start</td><td>启动服务端</td></tr><tr><td>ps -ajx|grep mysql：就像是任务管理器</td><td>查看服务器是否开启，就像是任务管理器</td></tr><tr><td>mysql -uroot -pmysql</td><td>mysql -u用户名-pmysql登录：可以增删改查，创建表格</td></tr><tr><td>sudo service mysql stop</td><td>停止服务端</td></tr><tr><td>exit /quit/ctrl+d</td><td>退出</td></tr><tr><td>/etc/mysql/mysql.conf.d/mysqld.cnf</td><td>配置文件路径为</td></tr><tr><td></td><td></td></tr><tr><td>select now();</td><td>查看时间</td></tr><tr><td>select version();</td><td>查看版本信息</td></tr><tr><td></td><td></td></tr><tr><td>sudo service mysql restart</td><td><strong>重启MySQL服务</strong></td></tr></tbody></table><p>客户端Navicat使用</p><h2 id="SQL数据类型"><a href="#SQL数据类型" class="headerlink" title="SQL数据类型"></a>SQL数据类型</h2><table><thead><tr><th><strong>类型</strong></th><th><strong>功能</strong></th></tr></thead><tbody><tr><td><strong>字符串：</strong></td><td></td></tr><tr><td>char：定长字符串：最多255</td><td>名字不管多次都占10个字节（知道固定长度的字节）</td></tr><tr><td>varchar：变字符串最多65535</td><td>节省空间（适合经常变化的）（存多少占多数）</td></tr><tr><td>text</td><td>字符串 text 表示存储大文本，当字符大于 4000 时推荐使用</td></tr><tr><td>字段就是最上面的属性名.enum：枚举类型</td><td>列举出一些类型，只能在这些列举的范围选择</td></tr><tr><td></td><td></td></tr><tr><td><strong>年月日类型：</strong></td><td></td></tr><tr><td>date</td><td>年，月，日</td></tr><tr><td>datetime</td><td>年，月，日，时分秒</td></tr><tr><td>decimal：定点数</td><td>（5,2）共代表5个</td></tr><tr><td></td><td></td></tr><tr><td><strong>整型</strong></td><td></td></tr><tr><td>TINYINT：</td><td></td></tr><tr><td>SMALLINT</td><td></td></tr><tr><td>singned:有符号</td><td></td></tr><tr><td>unsingned：无符号</td><td></td></tr><tr><td></td><td></td></tr><tr><td><strong>小数类型</strong></td><td></td></tr><tr><td>float：小数类型</td><td></td></tr><tr><td>decimal表示浮点数</td><td>如 decimal(5, 2) 表示共存5位数，小数占 2 位.</td></tr><tr><td></td><td></td></tr></tbody></table><h3 id="数据完整性和约束"><a href="#数据完整性和约束" class="headerlink" title="数据完整性和约束"></a>数据完整性和约束</h3><h6 id="参照完整性，就是增删改查中：要保证数据的正确性，"><a href="#参照完整性，就是增删改查中：要保证数据的正确性，" class="headerlink" title="参照完整性，就是增删改查中：要保证数据的正确性，"></a>参照完整性，就是增删改查中：要保证数据的正确性，</h6><h5 id="约束：删除的时候不让删"><a href="#约束：删除的时候不让删" class="headerlink" title="约束：删除的时候不让删"></a>约束：删除的时候不让删</h5><p>保证数据的独一性</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>NOT NULL</td><td>非空约束</td></tr><tr><td>PRMARY KEY</td><td>主键约束</td></tr><tr><td>UNIQUE KE</td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><p>数据库基本操作</p><table><thead><tr><th>数据表库的命令</th><th>使用的功能</th></tr></thead><tbody><tr><td>show databases;</td><td>查看所有数据库</td></tr><tr><td>select database();</td><td>查看当前使用的数据库</td></tr><tr><td>create database (数据库名字)  charset=utf8;</td><td>创建数据库</td></tr><tr><td>show  create database （数据库的名字）；</td><td>创建数据库查看数据库的字符集</td></tr><tr><td>drop database （数据库名称）;</td><td>删除数据表</td></tr><tr><td>数据表名.drop(数据表名[数据表名[对应的异常值这些异常值写出了T] == T].index,inplace = T)</td><td>对表里面的一些异常数据进行删除</td></tr><tr><td>use (数据库名称);   返回上一层服务器 use mysql</td><td>使用数据表进入指定的数据库</td></tr><tr><td></td><td></td></tr><tr><td>create database 数据库的名字</td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h2 id="查看表结构命令："><a href="#查看表结构命令：" class="headerlink" title="查看表结构命令："></a>查看表结构命令：</h2><table><thead><tr><th>命令</th><th>命令介绍</th></tr></thead><tbody><tr><td>show tables;</td><td>产看数据库的所有表</td></tr><tr><td>desc 表名;</td><td>查看表里面的内容</td></tr><tr><td>show create table 表名;</td><td>查看数据表</td></tr><tr><td>select * from students;</td><td>查看添加的文档</td></tr></tbody></table><h2 id="创建数据表"><a href="#创建数据表" class="headerlink" title="创建数据表"></a>创建数据表</h2><pre><code>crea table 表名 （字段   类型    约束    【字段   类型     约束】）；crea table xxx(id int unsigned primary key auto_increment not null,name varchar(20));create table创建students 表（id ，name ，age， high， （decimal），gender（enum），cls_id）</code></pre><h6 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h6><pre class=" language-python"><code class="language-python">create table 列表名<span class="token punctuation">(</span>id int unsigned（无符号<span class="token number">0</span><span class="token operator">-</span><span class="token number">255</span>）  primary key（主键） auto_increment（自动增加） <span class="token operator">not</span> null（不能为空）<span class="token punctuation">,</span>name varchar<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>（上限为<span class="token number">20</span>个字符） <span class="token operator">not</span> null<span class="token punctuation">,</span>age tinyint unsigned default  <span class="token number">0</span>（缺省值自动填充为<span class="token number">0</span>）<span class="token punctuation">,</span>height decimal<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>（一共有<span class="token number">5</span>位数，有小数点是有两位）gender enum<span class="token punctuation">(</span><span class="token string">"男"</span><span class="token punctuation">,</span>“女”<span class="token punctuation">,</span><span class="token string">"人妖"</span><span class="token punctuation">,</span><span class="token string">"保密"</span><span class="token punctuation">)</span>（枚举），time date default <span class="token string">"2020-01-01"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre><code>create table classes(id int unsigned  primary key auto_increment not null,name varchar(20） not null,id_age tinyint unsigned default  0);</code></pre><h2 id="列子"><a href="#列子" class="headerlink" title="列子"></a>列子</h2><pre class=" language-python"><code class="language-python">create table students<span class="token punctuation">(</span>id int unsigned primary key  auto_increment <span class="token operator">not</span> null<span class="token punctuation">,</span>name varchar<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">not</span> null<span class="token punctuation">,</span>age tinyint unsigned default  <span class="token number">0</span><span class="token punctuation">,</span>height decimal<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>gender enum<span class="token punctuation">(</span><span class="token string">"男"</span><span class="token punctuation">,</span><span class="token string">"女"</span><span class="token punctuation">,</span><span class="token string">"人妖"</span><span class="token punctuation">,</span><span class="token string">"保密"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>time date default  <span class="token string">"2020-01-01"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="./SQL%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/1611042404103.png" alt="SQL数据类型"></p><ul><li>Field：创建的字段</li><li>Type：属性的性质，和约束，枚举</li><li>Null：表示字段为空，yes表示可以为空</li><li>Key：唯一标识</li><li>Default：，默认值，如果字段被设计时，如果允许默认条件下，用户会进行数据的插入，那么就可以用事先准备好的数据来填充通常填充的是NULL</li><li>Extre：表示id可以顺序下去，</li></ul><table><thead><tr><th>alter table 表名 drop 列名;</th><th>删除字段</th></tr></thead><tbody><tr><td>drop table 表名;</td><td>删除表</td></tr><tr><td>delete from  表名 where id =数字几;</td><td>物理删除行</td></tr><tr><td>alter table   表名 add is_delete bit default 0;</td><td>逻辑增添</td></tr><tr><td>update 表名 set is_delete =1 where name = “行名”</td><td>逻辑删除</td></tr></tbody></table><h2 id="创建数据库和增删改查流程"><a href="#创建数据库和增删改查流程" class="headerlink" title="创建数据库和增删改查流程"></a>创建数据库和增删改查流程</h2><table><thead><tr><th>创建数据库命令</th><th>命令的作用</th></tr></thead><tbody><tr><td>mysql -uroot -pmysql;</td><td>登录数据库</td></tr><tr><td>quit、exit，</td><td>退出数据库</td></tr><tr><td>show databases;</td><td>查看所有的数据库</td></tr><tr><td>create database  数据库名称    charset=utf8;</td><td>创建数据库</td></tr><tr><td>select database();</td><td>查看当前使用数据库</td></tr><tr><td>use 数据库名称;</td><td>使用数据库</td></tr><tr><td>show tables；</td><td>查看当前数据库中所有的表</td></tr><tr><td>create table students(id  int  数据表名   primary  key  auto_increment  not mull,name varchar(20)  not  null, age tinyint unsigned default0,height decimal(5,2),gender enum(“男”，“女”));</td><td>创建表</td></tr><tr><td>alter table 表名 add 列名 类型   约束;</td><td>添加字段</td></tr><tr><td>alter table 表名 modify 列名 类型 约束;         例:alter table students modify birthday date not null;</td><td>修改字段类型及约束</td></tr><tr><td>alter table 表名 drop 列名</td><td>修改字段</td></tr><tr><td>show create table  表名;</td><td>查看数据表的类型，约束</td></tr><tr><td>show create database  数据库名;</td><td>查看数据库的类型</td></tr><tr><td>drop table 表名;</td><td>删除表</td></tr><tr><td><strong>增添数据</strong></td><td></td></tr><tr><td>insert into 表名  values(…..);：添加数据</td><td>添加数据值，对应着字段名字</td></tr><tr><td>insert into 表名 （列1.。。）values(值1，。。。);       insert into students (name,age,height,gender,time) values(“姓名”,18,180.22,”男”,”2020-07-08”);</td><td>部分的插入，对应的字段和插入的内容</td></tr><tr><td>insert into 表名 values（，，，），（。。。）。。;</td><td>全列多行插入</td></tr><tr><td>insert into 表名 （列1，。。。） values（值1，。。。），（值1.。）;</td><td>部分列多行插入</td></tr><tr><td>select * from 表名;</td><td>查看表的内容</td></tr><tr><td>select 列1 ，列2 。。。from 表名;</td><td>查看指定字段的内容</td></tr><tr><td>update 表名 set 列1 = 值1，列2=值2.。。where  条件;    列如:update students set age = 18, gender = ‘女’ where id = 6;</td><td>修改的数据</td></tr><tr><td>delete from 表名 where 条件;    列如:delete from students where id = 3;</td><td>删除数据（物理删除）</td></tr><tr><td>alter table   表名 add is_delete bit default 0;</td><td>逻辑的添加</td></tr><tr><td>update 表名 set is_delete =1 where name = “行名”</td><td>逻辑的删除，要先增添，才能删除</td></tr><tr><td>drop database 数据库名称;</td><td>删除数据库</td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;数据库&quot;&gt;&lt;a href=&quot;#数据库&quot; class=&quot;headerlink&quot; title=&quot;数据库&quot;&gt;&lt;/a&gt;数据库&lt;/h2&gt;&lt;p&gt;数据库：就是以一定格式进行组织的数据集合&lt;/p&gt;
&lt;p&gt;关系是用表格存储的，二维表格存储&lt;/p&gt;
&lt;p&gt;非关系是用字典类型存储的&lt;/</summary>
      
    
    
    
    <category term="SQL" scheme="https://xiaoyvlongoing.github.io/categories/SQL/"/>
    
    
    <category term="SQL" scheme="https://xiaoyvlongoing.github.io/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>Matplotlib基础</title>
    <link href="https://xiaoyvlongoing.github.io/2020/02/10/Matplotlib%E5%9F%BA%E7%A1%80/"/>
    <id>https://xiaoyvlongoing.github.io/2020/02/10/Matplotlib%E5%9F%BA%E7%A1%80/</id>
    <published>2020-02-10T06:47:40.000Z</published>
    <updated>2021-06-24T17:26:56.806Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Matplotlib基本操作："><a href="#Matplotlib基本操作：" class="headerlink" title="Matplotlib基本操作："></a>Matplotlib基本操作：</h2><table><thead><tr><th>函数</th><th>函数的用途</th></tr></thead><tbody><tr><td>import matplotlib.pyplot as plt</td><td>导入包</td></tr><tr><td>from pylab import mpl</td><td>导入中文字体包</td></tr><tr><td>plt.figure(figsize=(10,10),dpi=100)</td><td>创建画布，画布的范围和画布的大小</td></tr><tr><td>plt.plot()</td><td>添加图形的数据</td></tr><tr><td>plt.plot(x, y_beijing, color=’r’, linestyle=’–’, label=”北京”)</td><td>可以填加多个数据，“r”为红色，“–”虚线表示，右上角显示</td></tr><tr><td>plt.xticks(x[::5],x_tick[::5])</td><td>添加x轴的名字</td></tr><tr><td>plt.yticks(y_ticks[::5])</td><td>添加y轴的名字</td></tr><tr><td>plt.grid(True,linestyle=”–”,alpha=20)</td><td>添加网格线</td></tr><tr><td>plt.xlabel(“时间”)</td><td>添加描述信息</td></tr><tr><td>plt.ylabel(“温度”)</td><td>添加描述信息</td></tr><tr><td>plt.title(“”)</td><td>添加标题描述信息</td></tr><tr><td>plt.savefig(“./test.png”)</td><td>图像的保存</td></tr><tr><td>plt.legend(loc=0)</td><td>添加图例，右上角会显示：北京或者上海</td></tr><tr><td>plt.show()</td><td>图像的显示</td></tr><tr><td>mpl.rcParams[“font.sans-serif”] = [“SimHei”]</td><td>设置显示中文字体</td></tr><tr><td>mpl.rcParams[“axes.unicode_minus”] = False</td><td>设置正常显示符号</td></tr><tr><td></td><td></td></tr><tr><td>plt.imshow(x,<strong>cmap</strong>)</td><td>图片显示:                                                                                                  <strong>x</strong>：图片                                                                                               <strong>cmap</strong>：默认：“绿色”</td></tr><tr><td></td><td></td></tr><tr><td>fig,axes=plt.<strong>subplots</strong>(nrows=1,ncols=2,figsize=(10,8),dpi=100)</td><td>其中参数1和2分别代表子图的行数和列数,</td></tr><tr><td>.set_title</td><td>设置的图像的标题</td></tr><tr><td></td><td></td></tr><tr><td>plt.<strong>subplot</strong>（nrows, ncols, index, **kwargs）</td><td><strong>在循环中使用创建多少行多少列图</strong>                                                              nrows：生成多少行图，                                                          ncols：生成多少个列图，                                                         index：在第几个图生成对应的图</td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><p>**plt.函数名()<strong>相当于面向过程的画图方法，</strong>axes.set_方法名()**相当于面向对象的画图方法。</p><h2 id="创建多个图像"><a href="#创建多个图像" class="headerlink" title="创建多个图像"></a>创建多个图像</h2><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 0.准备数据</span>x <span class="token operator">=</span> range<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>y_shanghai <span class="token operator">=</span> <span class="token punctuation">[</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> x<span class="token punctuation">]</span>y_beijing <span class="token operator">=</span> <span class="token punctuation">[</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> x<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># 1.创建画布</span><span class="token comment" spellcheck="true"># plt.figure(figsize=(20, 8), dpi=100)</span>fig<span class="token punctuation">,</span> axes <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>nrows<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> ncols<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#plt.subplots：拆分页面，多图展示</span><span class="token comment" spellcheck="true"># 2.绘制图像</span><span class="token comment" spellcheck="true"># plt.plot(x, y_shanghai, label="上海")</span><span class="token comment" spellcheck="true"># plt.plot(x, y_beijing, color="r", linestyle="--", label="北京")</span>axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y_shanghai<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"上海"</span><span class="token punctuation">)</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y_beijing<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"r"</span><span class="token punctuation">,</span> linestyle<span class="token operator">=</span><span class="token string">"--"</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"北京"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 2.1 添加x,y轴刻度</span><span class="token comment" spellcheck="true"># 构造x,y轴刻度标签</span>x_ticks_label <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"11点&amp;#123;&amp;#125;分"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> x<span class="token punctuation">]</span>y_ticks <span class="token operator">=</span> range<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 刻度显示</span><span class="token comment" spellcheck="true"># plt.xticks(x[::5], x_ticks_label[::5])</span><span class="token comment" spellcheck="true"># plt.yticks(y_ticks[::5])</span>axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_yticks<span class="token punctuation">(</span>y_ticks<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xticklabels<span class="token punctuation">(</span>x_ticks_label<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_yticks<span class="token punctuation">(</span>y_ticks<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xticklabels<span class="token punctuation">(</span>x_ticks_label<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 2.2 添加网格显示</span><span class="token comment" spellcheck="true"># plt.grid(True, linestyle="--", alpha=0.5)</span>axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span> linestyle<span class="token operator">=</span><span class="token string">"--"</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span> linestyle<span class="token operator">=</span><span class="token string">"--"</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 2.3 添加描述信息</span><span class="token comment" spellcheck="true"># plt.xlabel("时间")</span><span class="token comment" spellcheck="true"># plt.ylabel("温度")</span><span class="token comment" spellcheck="true"># plt.title("中午11点--12点某城市温度变化图", fontsize=20)</span>axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">"时间"</span><span class="token punctuation">)</span>axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">"温度"</span><span class="token punctuation">)</span>axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"中午11点--12点某城市温度变化图"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">"时间"</span><span class="token punctuation">)</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">"温度"</span><span class="token punctuation">)</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"中午11点--12点某城市温度变化图"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># # 2.4 图像保存</span>plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">"./test.png"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># # 2.5 添加图例</span><span class="token comment" spellcheck="true"># plt.legend(loc=0)</span>axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 3.图像显示</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="创建其他图像的api"><a href="#创建其他图像的api" class="headerlink" title="创建其他图像的api"></a>创建其他图像的api</h2><table><thead><tr><th>函数</th><th>函数的定义</th></tr></thead><tbody><tr><td>plt.plot(x, y)</td><td>创建折线图</td></tr><tr><td>plt.scatter(x, y)</td><td><strong>散点图</strong></td></tr><tr><td>plt.bar(x, width, align=’center’, **kwargs)</td><td><strong>柱状图</strong>：x : 需要传递的数据，width : 柱状图的宽度，align : 每个柱状图的位置对齐方式，**kwargs : color=:选择柱状图的颜色</td></tr><tr><td>matplotlib.pyplot.hist(x, bins=None)</td><td>直方图 ：    x : 需要传递的数据 ，bins : 组距</td></tr><tr><td>api：plt.pie(x, labels=,autopct=,colors)</td><td>饼图：  x:数量，自动算百分比， labels:每部分名称可以写成名字或者数据 的变量，autopct:占比显示指定%1.2f%% ，colors:每部分颜色</td></tr><tr><td></td><td></td></tr><tr><td><strong>形成柱状图</strong></td><td></td></tr><tr><td>plt.text(x, y, s, fontdict=None, withdash=False, **kwargs）</td><td><strong>x</strong>，<strong>y</strong>：显示内容的坐标位置                                                                                                              <strong>s</strong> ：显示内容                                                                                                                                            <strong>fontdict</strong>：一个定义s格式的dict                                                                                                                   <strong>fontsize</strong>：字体大小                                                                                                                                <strong>color</strong>：str or tuple, 设置字体颜色 ,单个字符候选项{‘b’, ‘g’, ‘r’, ‘c’, ‘m’, ‘y’, ‘k’, ‘w’}，也可以’black’,’red’等，tuple时用[0,1]之间的浮点型数据，RGB或者RGBA, 如: (0.1, 0.2, 0.5)、(0.1, 0.2, 0.5, 0.3)等                                                    <strong>backgroundcolor</strong>：字体背景颜色                                                                         <strong>horizontalalignment</strong>(ha)：设置垂直对齐方式，可选参数：left,right,center                                                                                         <strong>verticalalignment</strong>(va)：设置水平对齐方式 ，可选参数 ： ‘center’ , ‘top’ , ‘bottom’ ,‘baseline’                                                                                                             <strong>rotation</strong>(旋转角度)：可选参数为:vertical,horizontal 也可以为数字                            <strong>alpha</strong>：透明度，参数值0至1之间</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Matplotlib基本操作：&quot;&gt;&lt;a href=&quot;#Matplotlib基本操作：&quot; class=&quot;headerlink&quot; title=&quot;Matplotlib基本操作：&quot;&gt;&lt;/a&gt;Matplotlib基本操作：&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
</summary>
      
    
    
    
    <category term="Matplotlib" scheme="https://xiaoyvlongoing.github.io/categories/Matplotlib/"/>
    
    
    <category term="Matplotlib" scheme="https://xiaoyvlongoing.github.io/tags/Matplotlib/"/>
    
  </entry>
  
  <entry>
    <title>fasttext工具</title>
    <link href="https://xiaoyvlongoing.github.io/2020/02/10/fasttext%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>https://xiaoyvlongoing.github.io/2020/02/10/fasttext%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/</id>
    <published>2020-02-10T06:47:40.000Z</published>
    <updated>2021-06-24T17:39:00.171Z</updated>
    
    <content type="html"><![CDATA[<h1 id="fasttext工具的使用"><a href="#fasttext工具的使用" class="headerlink" title="fasttext工具的使用"></a>fasttext工具的使用</h1><p>作为NLP工程领域常用的工具包, fasttext有两大作用:</p><ul><li>进行文本分类</li><li>训练词向量</li></ul><h3 id="使用fasttext工具进行文本分类的过程"><a href="#使用fasttext工具进行文本分类的过程" class="headerlink" title="使用fasttext工具进行文本分类的过程"></a>使用fasttext工具进行文本分类的过程</h3><ul><li>第一步: 获取数据</li><li>第二步: 训练集与验证集的划分</li><li>第三步: 训练模型</li><li>第四步: 使用模型进行预测并评估</li><li>第五步: 模型调优</li><li>第六步: 模型保存与重加载 </li></ul><hr><table><thead><tr><th>函数</th><th>函数性质</th></tr></thead><tbody><tr><td>import fasttext</td><td>构建fasttext工具包</td></tr><tr><td></td><td></td></tr><tr><td>model=fasttext.<strong>train_supervised</strong>（(input=文件名，epoch=数值轮数表示，wordNgrams=关联，loss=’hs’，“ova”）</td><td>使用fasttext的train_supervised方法<strong>进行文本分类模型</strong>的训练，                                                                                <strong>wordNgrams</strong>：设置为2意味着添加2-gram特征, 这些特征帮助模型捕捉前后词汇之间的关联, 更好的提取分类规则用于模型分类, 当然这也会增加模型训时练占用的资源和时间，<strong>loss</strong>：来修改损失计算方式(等效于输出层的结构), 默认是softmax层结构，设置为’hs’, 代表层次softmax结构, 意味着输出层的结构(计算方式)发生了变化, 将以一种更低复杂度的方式来计算损失，“ova”：标签多分类问题的损失计算方式，</td></tr><tr><td></td><td></td></tr><tr><td>model.predict(“一句话”)</td><td>模型进行预测并评估</td></tr><tr><td>model.test（“需要评估的数据集”）</td><td>为了评估模型到底表现如何,元组中的每项分别代表, 验证集样本数量, 精度以及召回率</td></tr><tr><td></td><td></td></tr><tr><td>model.predict（“一句话”，k=-1, threshold=0.5）</td><td>模型进行预测并评估，k=-1：尽可能输出多个标签，threshold：阈值</td></tr><tr><td></td><td></td></tr><tr><td>model.save_model(“./模型名字.bin”)</td><td>保存模型</td></tr><tr><td></td><td></td></tr><tr><td>model = fasttext.load_model(“./模型名字.bin”)</td><td>模型重加载</td></tr></tbody></table><h2 id="词向量迁移"><a href="#词向量迁移" class="headerlink" title="词向量迁移"></a>词向量迁移</h2><table><thead><tr><th>函数</th><th>函数性质</th></tr></thead><tbody><tr><td>model = fasttext.load_model(“模型名字.bin”)</td><td>加载模型</td></tr><tr><td>model.words[：100]</td><td>查看前100个词汇(这里的词汇是广义的, 可以是中文符号或汉字))</td></tr><tr><td>model.get_word_vector（“词名”）</td><td>使用模型获得’词名’这个名词的词向量</td></tr><tr><td>model.get_nearest_neighbors（“词名”）</td><td>以’音乐’为例, 返回的邻近词基本上与音乐都有关系, 如乐曲, 音乐会, 声乐等.</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;fasttext工具的使用&quot;&gt;&lt;a href=&quot;#fasttext工具的使用&quot; class=&quot;headerlink&quot; title=&quot;fasttext工具的使用&quot;&gt;&lt;/a&gt;fasttext工具的使用&lt;/h1&gt;&lt;p&gt;作为NLP工程领域常用的工具包, fasttext有</summary>
      
    
    
    
    <category term="NLP" scheme="https://xiaoyvlongoing.github.io/categories/NLP/"/>
    
    
    <category term="NLP" scheme="https://xiaoyvlongoing.github.io/tags/NLP/"/>
    
  </entry>
  
  <entry>
    <title>Numpy基础</title>
    <link href="https://xiaoyvlongoing.github.io/2020/02/10/Numpy%E5%9F%BA%E7%A1%80/"/>
    <id>https://xiaoyvlongoing.github.io/2020/02/10/Numpy%E5%9F%BA%E7%A1%80/</id>
    <published>2020-02-10T06:47:40.000Z</published>
    <updated>2021-06-27T16:54:29.626Z</updated>
    
    <content type="html"><![CDATA[<h2 id="numpy数组"><a href="#numpy数组" class="headerlink" title="numpy数组"></a>numpy数组</h2><h4 id="numpy夹角运算"><a href="#numpy夹角运算" class="headerlink" title="numpy夹角运算"></a>numpy夹角运算</h4><table><thead><tr><th>函数</th><th>函数性质</th></tr></thead><tbody><tr><td>umpy.arctan2(<em>x1</em>, <em>x2</em>)</td><td>对应的可以算数夹角</td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><table><thead><tr><th>函数</th><th>函数性质</th></tr></thead><tbody><tr><td>numpy.clip( <em>a</em> , <em>a_min</em> , <em>a_max</em> , <em>out=None</em> , **<em>kwargs</em> )</td><td>给定一个区间，区间之外的值被 裁剪 为 <br/>区间边。 例如，如果间隔为 <code>[0, 1]</code>指定，小于 0 的值变为 0，而大于 0 的值<br/>比 1 变成 1。</td></tr><tr><td>例如</td><td>np.clip(a, 3, 6, out=a)                                                                                      array([3, 3, 3, 3, 4, 5, 6, 6, 6, 6])</td></tr><tr><td><a href="https://numpy.org/doc/stable/reference/generated/numpy.clip.html?highlight=clip#numpy.clip">https://numpy.org/doc/stable/reference/generated/numpy.clip.html?highlight=clip#numpy.clip</a></td><td></td></tr></tbody></table><h4 id="查看数组基本操作"><a href="#查看数组基本操作" class="headerlink" title="查看数组基本操作"></a>查看数组基本操作</h4><table><thead><tr><th>函数</th><th>函数定义</th></tr></thead><tbody><tr><td>np.array（【】，dtype=np.数组类型）</td><td>进行数据的存储的容器</td></tr><tr><td>存储数据容器的变量.shape</td><td>产看数组维度的元组，几行几列用（）写出</td></tr><tr><td>存储数据容器的变量.ndim</td><td>查看是几维的数组</td></tr><tr><td>存储数据容器的变量.size</td><td>查看数组里面有多少元素</td></tr><tr><td>存储数据容器的变量.itemsize</td><td>一个数组元素的长度（字节大小）</td></tr><tr><td>存储数据容器的变量.dtype</td><td>数组元素的类型</td></tr><tr><td>np.<strong>sum</strong>()</td><td>求和</td></tr><tr><td>np.<strong>polyfit</strong>（）</td><td>多项式拟合</td></tr></tbody></table><h4 id="生成创建数组的方法"><a href="#生成创建数组的方法" class="headerlink" title="生成创建数组的方法"></a>生成创建数组的方法</h4><table><thead><tr><th>函数</th><th>函数使用方法</th></tr></thead><tbody><tr><td>np.ones([])</td><td>创建里面都是1的二维数组，【】写上几行几列用逗号隔开</td></tr><tr><td>np.ones_like(存储数据容器的变量)</td><td>创建里面都是1的二维数组</td></tr><tr><td>np.zeros([])</td><td>创建里面都是0的二维数组，【】写上几行几列用逗号隔开</td></tr><tr><td>np.zeros_like(存储数据容器的变量)</td><td>创建里面都是0的二维数组</td></tr><tr><td></td><td></td></tr><tr><td>np.array(存储数据容器的变量)</td><td>对存储数据容器的变量的深拷贝</td></tr><tr><td>np.asarray(存储数据容器的变量)</td><td>对存储数据容器的变量的浅拷贝</td></tr><tr><td><strong>创建等比等差数列的数组</strong></td><td></td></tr><tr><td>np.linspace(start,stop,num,endpoint)</td><td>创建等差数组 — 指定数量 参数:                                                     start:序列的起始值                                                                                    stop:序列的终止值                                                                                               num:要生成的等间隔样例数量，默认为50                                             endpoint:序列中是否包含stop值，默认为ture</td></tr><tr><td>np.arange(start,stop,step,dtype)</td><td>创建等差数组 — 指定步长                                                                                   参数start:为开头，                                                                                                                   stop：为结尾                                                                                                       step:步长,默认值为1</td></tr><tr><td>np.logspace(start,stop,num)</td><td>创建等比数列 参数:                                                                                          start:表示用几位数开头，                                                                                stop：表示用几位数结束                                                                               num:要生成的等比数列数量的元素，默认为50</td></tr><tr><td><strong>正态分布</strong></td><td></td></tr><tr><td>np.random.normal（<strong>loc=0.0, scale=1.0, size=None</strong>）</td><td>生成正态分布的随机数，                                                                                loc：float 此概率分布的<strong>均值</strong>（对应着整个分布的中心centre）scale：float：此概率分布的<strong>标准差</strong>（对应于分布的宽度，scale越大越矮胖，scale越小，越瘦高）                                                              size：可以创建一个维度的多少数，也几行几列二维的随机数</td></tr><tr><td><strong>np.random.uniform(low=0.0, high=1.0, size=None)</strong></td><td>low: 采样下界，float类型，默认值为0；                                                              high: 采样上界，float类型，默认值为1；                                                                  size: 输出样本数目，为int或元组(tuple)类型，例如，size=(m,n,k), 则输出m<em>n</em>k个样本，缺省时输出1个值。</td></tr></tbody></table><h4 id="数组的索引，切片，形状改变"><a href="#数组的索引，切片，形状改变" class="headerlink" title="数组的索引，切片，形状改变"></a>数组的索引，切片，形状改变</h4><table><thead><tr><th>函数</th><th>函数定义</th></tr></thead><tbody><tr><td>存储数据容器的变量【】</td><td>要分清维度，想要几维的用逗号隔开，在想要的维度再用《：》提取</td></tr><tr><td>存储数据容器的变量.reshape([])</td><td>改变想要的几行几列，但是要与原来的总元素量相匹配，是用成法得到总元素相同</td></tr><tr><td>存储数据容器的变量.reshape(-1,1)</td><td>把每一个元素都形成一个维</td></tr><tr><td>存储数据容器的变量.resize([])</td><td></td></tr><tr><td>存储数据容器的变量.T</td><td>进行行与列进行互换</td></tr><tr><td></td><td></td></tr><tr><td>折叠成一维的数组</td><td></td></tr><tr><td>变量.<strong>flatten</strong>()</td><td>返回一个折叠成一维的数组。但是该函数只能适用于numpy对象，即array或者mat，普通的list列表是不行的。</td></tr><tr><td></td><td></td></tr></tbody></table><h4 id="数组的修改"><a href="#数组的修改" class="headerlink" title="数组的修改"></a>数组的修改</h4><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>stock_change.astype(np.int32)</td><td>数组的修类型</td></tr><tr><td>ndarray.tostring([order])</td><td></td></tr><tr><td></td><td></td></tr><tr><td>np.unique(存储数据容器的变量)</td><td>数组的去重</td></tr><tr><td></td><td></td></tr></tbody></table><h3 id="ndarray运算（逻辑）"><a href="#ndarray运算（逻辑）" class="headerlink" title="ndarray运算（逻辑）"></a>ndarray运算（逻辑）</h3><table><thead><tr><th>函数</th><th>函数定义</th></tr></thead><tbody><tr><td>np.random.seed()</td><td>确定随机数生成种子，用它后每次生成的数都是一样的</td></tr><tr><td>np.random.randn(几行，几列)</td><td>创建0到1之间的随机数</td></tr><tr><td>np.random.randit(开头,结尾,(几行,几列))</td><td>随机创建数组</td></tr><tr><td>np.all(存储数据容器的变量[取值范围]&gt;条件判断)</td><td>符合条件为True，不符合为：False,判断给定轴向上的所有元素是否都为True</td></tr><tr><td>np.any()</td><td>判断给定轴向上是否有一个元素为True</td></tr><tr><td>np.where(存储数据容器的变量[取值范围]&gt;条件判断,1,0)</td><td>符合条件为1，不符合为0</td></tr><tr><td>np.where(np.logical_and(temp &gt; 60,temp&lt;90),1,0)</td><td>np.logical_and:符合条件为1，不符合为0，</td></tr><tr><td>np.where(np.logical_or(temp &gt; 90, temp &lt; 60), 1, 0)</td><td>np.logical_or：大于90或小于60的换为1，否则为0</td></tr><tr><td></td><td></td></tr><tr><td><strong>统计函数</strong></td><td></td></tr><tr><td>np.max(存储数据容器的变量,axis=0或者1)</td><td>按照列（0）或者行（1）进行提取，</td></tr><tr><td>np.min(存储数据容器的变量,axis=0或者1)</td><td>按照列（0）或者行（1）进行提取，</td></tr><tr><td>np.median()</td><td>先排序在找中位数</td></tr><tr><td>np.mean()</td><td>均差</td></tr><tr><td>np.std()</td><td>标准差</td></tr><tr><td>np.var()</td><td>求解方差</td></tr><tr><td>np.argmax(axis=)</td><td>最大元素对应的下标</td></tr><tr><td>np.argmin(axis=)</td><td>最小元素对应的下标</td></tr><tr><td>axis(“off”)</td><td>不按行或列</td></tr><tr><td>np.square</td><td>每个元素的经行平方</td></tr><tr><td><strong>sqrt()</strong></td><td>方法返回数字x的平方根</td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td>np.maximum（【】，【】）</td><td>能选取最大的列表（向量）</td></tr><tr><td></td><td></td></tr></tbody></table><h2 id="广播机制：一个数组与另一个数组是否能不能运算"><a href="#广播机制：一个数组与另一个数组是否能不能运算" class="headerlink" title="广播机制：一个数组与另一个数组是否能不能运算"></a>广播机制：一个数组与另一个数组是否能不能运算</h2><p>横着为行。竖着为列，</p><p><strong>是否能相加</strong>：要从两个数组的后缘维度（从末尾开始算起的维度）的轴长度相符</p><p><strong>怎么查看维度</strong>：第一个是最外面的中括号有几个元素，后面进行递减查看</p><p><strong>矩阵的乘法遵循法则</strong>：第一横行乘于第一竖列再进行相加得出第一个相乘的数</p><h3 id="单位矩阵，逆，转置"><a href="#单位矩阵，逆，转置" class="headerlink" title="单位矩阵，逆，转置"></a><strong>单位矩阵</strong>，<strong>逆</strong>，<strong>转置</strong></h3><h6 id="单位矩阵：从-左上角到右下角的对角线（称为主对角线）上的元素均为-1-以外全都为-0"><a href="#单位矩阵：从-左上角到右下角的对角线（称为主对角线）上的元素均为-1-以外全都为-0" class="headerlink" title="单位矩阵：从 左上角到右下角的对角线（称为主对角线）上的元素均为 1 以外全都为 0"></a><strong>单位矩阵</strong>：<strong>从 左上角到右下角的对角线（称为主对角线）上的元素均为 1 以外全都为 0</strong></h6><p><strong>逆</strong>：两个数组相乘，称为了单位矩阵就算是一个数组是另一个数组的逆</p><p><strong>转置</strong>：行与列的互换</p><h2 id="NP的矩阵乘法要遵循下面的公式，也可以进过转至进行运算"><a href="#NP的矩阵乘法要遵循下面的公式，也可以进过转至进行运算" class="headerlink" title="NP的矩阵乘法要遵循下面的公式，也可以进过转至进行运算"></a>NP的矩阵乘法要遵循下面的公式，也可以进过转至进行运算</h2><table><thead><tr><th>函数</th><th>函数定义</th></tr></thead><tbody><tr><td>np.dot</td><td>矩阵进行相乘</td></tr><tr><td>np.matmul</td><td>矩阵进行相乘，单是不能矩阵与标量（一维）的相乘</td></tr><tr><td>.set_printoptions(<em>precision=None</em>, <em>threshold=None</em>, <em>edgeitems=None</em>, <em>linewidth=None</em>, <em>suppress=None</em>, <em>nanstr=None</em>, <em>infstr=None</em>, <em>formatter=None</em>, <em>sign=None</em>, <em>floatmode=None</em>, ***, <em>legacy=None</em>)</td><td><strong>precision</strong>：浮点精度可以设置，<strong>threshold</strong>：长数组可以总结为，<strong>suppress=True</strong>小结果可以被抑制，<strong>formatter={}<strong>自定义格式化程序可用于根据需要显示数组元素，</strong>要放回默认选项</strong>，可以使用(edgeitems=3, infstr=’inf’, linewidth=75, nanstr=’nan’, precision=8, suppress=False, threshold=1000, formatter=None)</td></tr></tbody></table><h3 id="按元素减去参数。"><a href="#按元素减去参数。" class="headerlink" title="按元素减去参数。"></a>按元素减去参数。</h3><h4 id="numpy-subtract"><a href="#numpy-subtract" class="headerlink" title="numpy.subtract"></a>numpy.subtract</h4><table><thead><tr><th>函数</th><th>函数性质</th></tr></thead><tbody><tr><td><code>numpy.subtract</code>(<em>x1</em>, <em>x2</em>, <em>/</em>, <em>out=None</em>, ***, <em>where=True</em>, <em>casting=’same_kind’</em>, <em>order=’K’</em>, <em>dtype=None</em>, <em>subok=True</em>[, <em>signature</em>, <em>extobj</em>])</td><td>参数 ：                                                                                                                                  <strong>x1, x2</strong>：要彼此相减的数组。如果 <code>x1.shape != x2.shape</code>，它们必须可以广播到一个普通的形状（将成为输出的形状，                                                                                          <strong>out</strong>：结果存储的位置。  如果提供，它必须具有输入广播到的形状。  如果未提供或没有，返回一个新分配的数组。  元组（只能作为关键字参数）的长度必须等于输出的数量</td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h3 id="例子："><a href="#例子：" class="headerlink" title="例子："></a>例子：</h3><pre class=" language-python"><code class="language-python">np<span class="token punctuation">.</span>subtract<span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">3.0</span>x1 <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">9.0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>x2 <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">3.0</span><span class="token punctuation">)</span>np<span class="token punctuation">.</span>subtract<span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2<span class="token punctuation">)</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span> <span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span> <span class="token number">6</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#这 -运算符可以用作 np.subtract上 数组。 </span>x1 <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">9.0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>x2 <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">3.0</span><span class="token punctuation">)</span>x1 <span class="token operator">-</span> x2array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;numpy数组&quot;&gt;&lt;a href=&quot;#numpy数组&quot; class=&quot;headerlink&quot; title=&quot;numpy数组&quot;&gt;&lt;/a&gt;numpy数组&lt;/h2&gt;&lt;h4 id=&quot;numpy夹角运算&quot;&gt;&lt;a href=&quot;#numpy夹角运算&quot; class=&quot;header</summary>
      
    
    
    
    <category term="Numpy" scheme="https://xiaoyvlongoing.github.io/categories/Numpy/"/>
    
    
    <category term="Numpy" scheme="https://xiaoyvlongoing.github.io/tags/Numpy/"/>
    
  </entry>
  
  <entry>
    <title>线程任务</title>
    <link href="https://xiaoyvlongoing.github.io/2020/02/10/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    <id>https://xiaoyvlongoing.github.io/2020/02/10/%E5%A4%9A%E7%BA%BF%E7%A8%8B/</id>
    <published>2020-02-10T06:47:40.000Z</published>
    <updated>2021-06-24T17:12:15.352Z</updated>
    
    <content type="html"><![CDATA[<h2 id="多线程任务"><a href="#多线程任务" class="headerlink" title="多线程任务"></a>多线程任务</h2><h3 id="一：多线程"><a href="#一：多线程" class="headerlink" title="一：多线程"></a>一：多线程</h3><table><thead><tr><th>函数名</th><th>使用的方法</th></tr></thead><tbody><tr><td>导入的函数包import multiprocessing</td><td>创建的进程导入的包名</td></tr><tr><td>multiprocessing.Process([group [, target [, name [, args：传入指定形参 [, kwargs：以字典的类型进行传参]]]]])</td><td>导入进程函数说明</td></tr><tr><td>target=方法名</td><td>执行的目标任务名（函数名，线程名）</td></tr><tr><td>name=进程的名字</td><td>进程名字</td></tr><tr><td>对象名=multiprocessing.Process(target=方法名)</td><td>启动进程的方法</td></tr><tr><td>子进程对象.start()</td><td>对象.start（）：启动子进程实例（创建子进程）</td></tr><tr><td>os.getpid</td><td>print(os.getpid)查看子进程编号</td></tr><tr><td>os.getppid</td><td>print(os.getppid)查看父进程编号</td></tr><tr><td>multiprocessing.current_process().name进程名字</td><td>查看当前进程编号</td></tr><tr><td>子进程对象.join()</td><td>加入jojn后主线程会等待子线程执行后再结束主线程，让线程可以形成串行，形成有顺序的，线性和进程的也可进行串行，结束前一个，进行下一个执行</td></tr><tr><td>子进程对象.terminate()</td><td>不管任务是否完成，立即终止子进程</td></tr><tr><td>子进程对象.daemom = True</td><td>不管任务是否完成，立即终止子进程</td></tr><tr><td>进程在ubuntu中 ps -aux|grep 要查找的线程的名字</td><td>过滤需要的进程来查看ID</td></tr><tr><td>os.kill(os.getpid(),9)  进程的id</td><td>强制杀死进程</td></tr><tr><td></td><td></td></tr></tbody></table><p>1：进程是操作系统资源分配的最小单位</p><p>2：进程之间执行也是无序的，它是由操作系统调度决定的，操作系统调度哪个进程，哪个进程就先执行，没有调度的进程不能执行</p><p>3：进程不共享全局变量</p><h3 id="二：线程和进程有什么区别："><a href="#二：线程和进程有什么区别：" class="headerlink" title="二：线程和进程有什么区别："></a>二：线程和进程有什么区别：</h3><p>1：进程是操作系统资源分配的最小单位，线程是cpu调度的最小单位</p><p>2：线程依附于进程，没有进程就没有线程，一个进程默认创造一个主线程，一个进程可以创造多个线程</p><p>3：进程不共享全局变量，而同一个进程的线程可以共享进程的全局变量</p><p>4：进程开销比较大，可以利用多核（并行），线程开销比较小不能利用多核（并发）</p><h3 id="三：什么是主进程："><a href="#三：什么是主进程：" class="headerlink" title="三：什么是主进程："></a>三：什么是主进程：</h3><p>主进程是：程序执行的入口，一个进程里默认带一个线程，主进程可以创建多个子线程，</p><h3 id="四：写出创造进程的步骤："><a href="#四：写出创造进程的步骤：" class="headerlink" title="四：写出创造进程的步骤："></a>四：写出创造进程的步骤：</h3><pre class=" language-python"><code class="language-python"><span class="token number">1</span>：导入进程包：​        <span class="token keyword">import</span>  multiprocessing<span class="token number">2</span>：创建进程函数（方法）​        <span class="token keyword">def</span> num（）：​                <span class="token keyword">pass</span><span class="token number">3</span>：创建进程，调用进程函数（方法）​        变量 <span class="token operator">=</span> multiprocessing<span class="token punctuation">.</span>Process<span class="token punctuation">(</span>target <span class="token operator">=</span> num<span class="token punctuation">)</span><span class="token number">4</span><span class="token punctuation">:</span>启动进程        变量<span class="token punctuation">.</span>start（）</code></pre><h3 id="五：怎么获得进程的pid"><a href="#五：怎么获得进程的pid" class="headerlink" title="五：怎么获得进程的pid"></a>五：怎么获得进程的pid</h3><pre class=" language-python"><code class="language-python"><span class="token number">1</span>：improre  os <span class="token number">2</span>：os<span class="token punctuation">.</span>getppid <span class="token punctuation">:</span>   <span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>getppid<span class="token punctuation">)</span>查看父进程id编号<span class="token number">3</span>：os<span class="token punctuation">.</span>getpid  ：   <span class="token keyword">print</span>（os<span class="token punctuation">.</span>getpid）查看当前进程id编号<span class="token number">4</span>：multiprocessing<span class="token punctuation">.</span>current_process<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name进程（线程）名字   ：查看当前进程（线程）的id编号    </code></pre><h3 id="六：怎么给进程函数传递参数："><a href="#六：怎么给进程函数传递参数：" class="headerlink" title="六：怎么给进程函数传递参数："></a>六：怎么给进程函数传递参数：</h3><p>1：通过元组进程传递参数</p><pre><code>multiprocessing.Process(target = coding , args = （参数，）)传入的是一个元组需要加上，传入的参数要保持一致</code></pre><h3 id="2：通过字典进程传参："><a href="#2：通过字典进程传参：" class="headerlink" title="2：通过字典进程传参："></a>2：通过字典进程传参：</h3><pre><code>multiprocessing.Process(target = coding , kwargs = &#123;传递的进程变量名：传入的参数&#125;)因为用的是字典的要与进程参数对住</code></pre><h3 id="七：在主进程中，怎么堵塞等待子进程完成后，才能继续运行"><a href="#七：在主进程中，怎么堵塞等待子进程完成后，才能继续运行" class="headerlink" title="七：在主进程中，怎么堵塞等待子进程完成后，才能继续运行"></a>七：在主进程中，怎么堵塞等待子进程完成后，才能继续运行</h3><p>1：把join加入到子进程中，子进程变量.join，形成串联运行完子进程在运行主线线程</p><p>八：Process创建的实例对象的常用的方法有什么？</p><p>1：start（）：启动子进程实例（创建子进程）</p><p>2：join（）：等待子进程执行结束，形成串联</p><p>3：terminate（）：不管任务是否完成，立即终止子进程</p><p>八《一》：    Process常用的属性：</p><p>1：name：当前进程的别名，默认为Process - n ，n为从1开始递增的整数</p><p>2：pid：当前进程的id</p><p>九：编写一个程序，实现创建一个子进程，子进程每一秒打印一次：这是子进程，循环的第n次，打印 的次数是由主进程传递给子进程。</p><pre><code>1：#利用args和kwargs传参import multiprocessingimport timedef ness(num):    for i in range(num):        time.sleep(1)        print(&quot;这个是一个线程&quot;)if __name__ == &#39;__main__&#39;:    # mues = multiprocessing.Process(target= ness,args=(6,))    mues = multiprocessing.Process(target=ness, kwargs=&#123;&quot;num&quot;:6&#125;)    mues.start()2：#利用类方法实现线程import multiprocessingimport timeclass nees():    def __init__(self,name):        super(nees, self).__init__()        self.name = name    def num(self):        for i in range(self.name):            time.sleep(1)            print(&quot;这个是一个子进程&quot;)if __name__ == &#39;__main__&#39;:    num_process = multiprocessing.Process(target=nees)    A=nees(3)    A.num()</code></pre><p>：线程资源竞争问题：</p><p>1：100万次加法，线程1和线程2谁先执行完</p><p>2：线程1计算的结果一定比线程2小吗？</p><p>3：某个线程计算的结果有没有可能小于100万？为什么：</p><p>​            1：不一定谁先执行完，因为线程是由cpu进行调度的，没有执行顺序那个先执行完都是不一定的</p><p>​            2：不一定，因为没办法知道那个线程能先执行完，所有没有办法知道执行的时间，没有办法知道执行的大小</p><p>​            3：有的，因为多线程共享全局变量，再赋予全局变量的时候，线程一和线程二计算的先后没有办法确定下来，当线程一计算的多时，线程二计算的少时，线程一又把线程二中的值共享过来这时就不安之前的顺序的，会小于100万</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;多线程任务&quot;&gt;&lt;a href=&quot;#多线程任务&quot; class=&quot;headerlink&quot; title=&quot;多线程任务&quot;&gt;&lt;/a&gt;多线程任务&lt;/h2&gt;&lt;h3 id=&quot;一：多线程&quot;&gt;&lt;a href=&quot;#一：多线程&quot; class=&quot;headerlink&quot; title=&quot;一：多</summary>
      
    
    
    
    <category term="python高级" scheme="https://xiaoyvlongoing.github.io/categories/python%E9%AB%98%E7%BA%A7/"/>
    
    
    <category term="python高级" scheme="https://xiaoyvlongoing.github.io/tags/python%E9%AB%98%E7%BA%A7/"/>
    
  </entry>
  
  <entry>
    <title>神经网络--猫狗分类</title>
    <link href="https://xiaoyvlongoing.github.io/2020/02/10/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%8C%AB%E7%8B%97%E5%88%86%E7%B1%BB/"/>
    <id>https://xiaoyvlongoing.github.io/2020/02/10/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%8C%AB%E7%8B%97%E5%88%86%E7%B1%BB/</id>
    <published>2020-02-10T06:47:40.000Z</published>
    <updated>2021-06-24T16:57:20.464Z</updated>
    
    <content type="html"><![CDATA[<h2 id="读取猫狗的图片矩阵数据，自实现神经元神经网络进行二分类"><a href="#读取猫狗的图片矩阵数据，自实现神经元神经网络进行二分类" class="headerlink" title="读取猫狗的图片矩阵数据，自实现神经元神经网络进行二分类"></a>读取猫狗的图片矩阵数据，自实现神经元神经网络进行二分类</h2><p>1：读取数据集<br>2：实现前向传播与反向传播<br>3：模型预测函数实现</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">import</span> h5py<span class="token comment" spellcheck="true">#这个读取</span><span class="token keyword">def</span> <span class="token function">load_dataset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    train_dataset <span class="token operator">=</span> h5py<span class="token punctuation">.</span>File<span class="token punctuation">(</span><span class="token string">'datasets/train_catvnoncat.h5'</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#从datasets中读取，从训练和测试两个文件中</span>    train_set_x_orig <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>train_dataset<span class="token punctuation">[</span><span class="token string">"train_set_x"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># your train set features</span>    train_set_y_orig <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>train_dataset<span class="token punctuation">[</span><span class="token string">"train_set_y"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># your train set labels</span>    test_dataset <span class="token operator">=</span> h5py<span class="token punctuation">.</span>File<span class="token punctuation">(</span><span class="token string">'datasets/test_catvnoncat.h5'</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span>    test_set_x_orig <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>test_dataset<span class="token punctuation">[</span><span class="token string">"test_set_x"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># your test set features</span>    test_set_y_orig <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>test_dataset<span class="token punctuation">[</span><span class="token string">"test_set_y"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># your test set labels</span>    classes <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>test_dataset<span class="token punctuation">[</span><span class="token string">"list_classes"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># the list of classes</span>    <span class="token comment" spellcheck="true">#对应的类别分别通过下边返回了</span>    train_set_y_orig <span class="token operator">=</span> train_set_y_orig<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> train_set_y_orig<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    test_set_y_orig <span class="token operator">=</span> test_set_y_orig<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> test_set_y_orig<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> train_set_x_orig<span class="token punctuation">,</span> train_set_y_orig<span class="token punctuation">,</span> test_set_x_orig<span class="token punctuation">,</span> test_set_y_orig<span class="token punctuation">,</span> classes    主体函数导入相关包<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">from</span> data <span class="token keyword">import</span> load_dataset<span class="token comment" spellcheck="true">#数据结构的包</span>主体逻辑<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 1、读取样本数据</span>    train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> test_x<span class="token punctuation">,</span> test_y<span class="token punctuation">,</span> classes <span class="token operator">=</span> load_dataset<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#读出训练集，测试集和训练的类别</span><span class="token comment" spellcheck="true">#打印出形状</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"训练集的样本数: "</span><span class="token punctuation">,</span> train_x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"测试集的样本数: "</span><span class="token punctuation">,</span> test_x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"train_x形状: "</span><span class="token punctuation">,</span> train_x<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"train_y形状: "</span><span class="token punctuation">,</span> train_y<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"test_x形状: "</span><span class="token punctuation">,</span> test_x<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"test_x形状: "</span><span class="token punctuation">,</span> test_y<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 输入数据的形状修改以及归一化</span>    train_x <span class="token operator">=</span> train_x<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>train_x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T    test_x <span class="token operator">=</span> test_x<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>test_x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T    train_x <span class="token operator">=</span> train_x <span class="token operator">/</span> <span class="token number">255</span><span class="token punctuation">.</span>    test_x <span class="token operator">=</span> test_x <span class="token operator">/</span> <span class="token number">255</span><span class="token punctuation">.</span>    <span class="token comment" spellcheck="true"># 2、模型训练以及预测，封装到model的中</span>    d <span class="token operator">=</span> model<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> test_x<span class="token punctuation">,</span> test_y<span class="token punctuation">,</span> num_iterations<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">,</span> learning_rate<span class="token operator">=</span><span class="token number">0.005</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#训练和测试的数据集还有迭代的步骤步数还有学习率</span><span class="token number">2</span>、模型预测函数实现模型函数<span class="token keyword">def</span> <span class="token function">model</span><span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> Y_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> Y_test<span class="token punctuation">,</span> num_iterations<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">,</span> learning_rate<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    """</span><span class="token comment" spellcheck="true">#先初始模型的参数，初始化单个的神经元一个逻辑回归,wb是某个神经元的参数</span>    <span class="token comment" spellcheck="true"># 初始化参数</span>    w<span class="token punctuation">,</span> b <span class="token operator">=</span> initialize_with_zeros<span class="token punctuation">(</span>X_train<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#下面进行优化通过optimize去实现模型的整个梯度下降的过程，每一次更新都要通过optimize函数去做</span><span class="token comment" spellcheck="true">#模型训练得出来的都是参数，损失的列表，每一次更新损失降了多少个，驯良的结果返回出来</span>    <span class="token comment" spellcheck="true"># 梯度下降</span>    <span class="token comment" spellcheck="true"># params:更新后的网络参数</span>    <span class="token comment" spellcheck="true"># grads:最后一次梯度</span>    <span class="token comment" spellcheck="true"># costs:每次更新的损失列表</span>    params<span class="token punctuation">,</span> grads<span class="token punctuation">,</span> costs <span class="token operator">=</span> optimize<span class="token punctuation">(</span>w<span class="token punctuation">,</span> b<span class="token punctuation">,</span> X_train<span class="token punctuation">,</span> Y_train<span class="token punctuation">,</span> num_iterations<span class="token punctuation">,</span> learning_rate<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#参数，每一次的梯度，损失</span>    <span class="token comment" spellcheck="true"># 获取训练的参数</span>    <span class="token comment" spellcheck="true"># 预测结果</span>    w <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token string">'w'</span><span class="token punctuation">]</span>    b <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true">#用你输出的进行预测</span>    <span class="token comment" spellcheck="true">#用你测试的进行预测得到测试集的效果</span>    Y_prediction_train <span class="token operator">=</span> predict<span class="token punctuation">(</span>w<span class="token punctuation">,</span> b<span class="token punctuation">,</span> X_train<span class="token punctuation">)</span>    Y_prediction_test <span class="token operator">=</span> predict<span class="token punctuation">(</span>w<span class="token punctuation">,</span> b<span class="token punctuation">,</span> X_test<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#预测出来的都是0,1的结果</span>    <span class="token comment" spellcheck="true"># 打印准确率</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"训练集准确率: &amp;#123;&amp;#125; "</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">-</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>np<span class="token punctuation">.</span>abs<span class="token punctuation">(</span>Y_prediction_train <span class="token operator">-</span> Y_train<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>#预测结果与真正的结果进行相减，abs：绝对值，mean：再求平均值，平均结果就是错误率，乘<span class="token number">100</span>，得到了多少，再用<span class="token number">100</span>减去就是准确率    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"测试集准确率: &amp;#123;&amp;#125; "</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">-</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>np<span class="token punctuation">.</span>abs<span class="token punctuation">(</span>Y_prediction_test <span class="token operator">-</span> Y_test<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    d <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"costs": costs,</span>         <span class="token string">"Y_prediction_test"</span><span class="token punctuation">:</span> Y_prediction_test<span class="token punctuation">,</span>         <span class="token string">"Y_prediction_train"</span><span class="token punctuation">:</span> Y_prediction_train<span class="token punctuation">,</span>         <span class="token string">"w"</span><span class="token punctuation">:</span> w<span class="token punctuation">,</span>         <span class="token string">"b"</span><span class="token punctuation">:</span> b<span class="token punctuation">,</span>         <span class="token string">"learning_rate"</span><span class="token punctuation">:</span> learning_rate<span class="token punctuation">,</span>         <span class="token string">"num_iterations"</span><span class="token punctuation">:</span> num_iterations<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span> <span class="token comment" spellcheck="true">#把预测的结果损失，还有权重参数，学习率，迭代的次数，返回出去</span>    <span class="token keyword">return</span> d其中涉及两个函数一个是sigmoid另一个是初始化函数：<span class="token keyword">def</span> <span class="token function">basic_sigmoid</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    计算sigmoid函数    """</span>    s <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> s<span class="token keyword">def</span> <span class="token function">initialize_with_zeros</span><span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    创建一个形状为 (shape, 1) 的w参数和b=0.    return:w, b    """</span>    w <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    b <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">return</span> w<span class="token punctuation">,</span> b<span class="token number">3</span>、前向传播与反向传播实现<span class="token keyword">def</span> <span class="token function">optimize</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> b<span class="token punctuation">,</span> X<span class="token punctuation">,</span> Y<span class="token punctuation">,</span> num_iterations<span class="token punctuation">,</span> learning_rate<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    参数：    w:权重,b:偏置,X特征,Y目标值,num_iterations总迭代次数,learning_rate学习率    Returns:    params:更新后的参数字典    grads:梯度    costs:损失结果    """</span>    costs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#每一次循环多少次，步数的迭代，计算出每一次更新的我w，b</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>num_iterations<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 梯度更新计算函数</span>        grads<span class="token punctuation">,</span> cost <span class="token operator">=</span> propagate<span class="token punctuation">(</span>w<span class="token punctuation">,</span> b<span class="token punctuation">,</span> X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 取出两个部分参数的梯度</span>        dw <span class="token operator">=</span> grads<span class="token punctuation">[</span><span class="token string">'dw'</span><span class="token punctuation">]</span>        db <span class="token operator">=</span> grads<span class="token punctuation">[</span><span class="token string">'db'</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true"># 按照梯度下降公式去计算</span>        w <span class="token operator">=</span> w <span class="token operator">-</span> learning_rate <span class="token operator">*</span> dw        b <span class="token operator">=</span> b <span class="token operator">-</span> learning_rate <span class="token operator">*</span> db        <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            costs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>cost<span class="token punctuation">)</span>        <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"损失结果 %i: %f"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> cost<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>    params <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"w": w,</span>              <span class="token string">"b"</span><span class="token punctuation">:</span> b<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>    grads <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"dw": dw,</span>             <span class="token string">"db"</span><span class="token punctuation">:</span> db<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span><span class="token comment" spellcheck="true">#更新出来的参数结果</span>    <span class="token keyword">return</span> params<span class="token punctuation">,</span> grads<span class="token punctuation">,</span> costs<span class="token keyword">def</span> <span class="token function">propagate</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> b<span class="token punctuation">,</span> X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#反向传播的过程</span>    <span class="token triple-quoted-string string">"""    参数：w,b,X,Y：网络参数和数据    Return:    损失cost、参数W的梯度dw、参数b的梯度db    """</span>    m <span class="token operator">=</span> X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 前向传播，计算</span>    <span class="token comment" spellcheck="true"># w (n,1), x (n, m)</span>    A <span class="token operator">=</span> basic_sigmoid<span class="token punctuation">(</span>np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>w<span class="token punctuation">.</span>T<span class="token punctuation">,</span> X<span class="token punctuation">)</span> <span class="token operator">+</span> b<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 计算损失</span>    cost <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">/</span> m <span class="token operator">*</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>Y <span class="token operator">*</span> np<span class="token punctuation">.</span>log<span class="token punctuation">(</span>A<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> Y<span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> A<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 反向传播</span>    dz <span class="token operator">=</span> A <span class="token operator">-</span> Y    dw <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> m <span class="token operator">*</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>X<span class="token punctuation">,</span> dz<span class="token punctuation">.</span>T<span class="token punctuation">)</span>    db <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> m <span class="token operator">*</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>dz<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#这一次更新的梯度</span>    grads <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"dw": dw,</span>             <span class="token string">"db"</span><span class="token punctuation">:</span> db<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>    <span class="token keyword">return</span> grads<span class="token punctuation">,</span> cost预测函数为：<span class="token keyword">def</span> <span class="token function">predict</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> b<span class="token punctuation">,</span> X<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">'''    利用训练好的参数预测    return：预测结果    '''</span>    m <span class="token operator">=</span> X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>    Y_prediction <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">)</span>    w <span class="token operator">=</span> w<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 计算结果</span>    A <span class="token operator">=</span> basic_sigmoid<span class="token punctuation">(</span>np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>w<span class="token punctuation">.</span>T<span class="token punctuation">,</span> X<span class="token punctuation">)</span> <span class="token operator">+</span> b<span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>A<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> A<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">0.5</span><span class="token punctuation">:</span>            Y_prediction<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            Y_prediction<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">assert</span> <span class="token punctuation">(</span>Y_prediction<span class="token punctuation">.</span>shape <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> Y_prediction运行结果显示：训练集的样本数<span class="token punctuation">:</span>  <span class="token number">209</span>测试集的样本数<span class="token punctuation">:</span>  <span class="token number">50</span>train_x形状<span class="token punctuation">:</span>  <span class="token punctuation">(</span><span class="token number">209</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>train_y形状<span class="token punctuation">:</span>  <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">209</span><span class="token punctuation">)</span>test_x形状<span class="token punctuation">:</span>  <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>test_x形状<span class="token punctuation">:</span>  <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>损失结果 <span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">0.693147</span><span class="token operator">-</span><span class="token number">0.000777511961722488</span>损失结果 <span class="token number">100</span><span class="token punctuation">:</span> <span class="token number">0.584508</span><span class="token operator">-</span><span class="token number">0.004382762341768198</span>损失结果 <span class="token number">200</span><span class="token punctuation">:</span> <span class="token number">0.466949</span><span class="token operator">-</span><span class="token number">0.006796745374030192</span>损失结果 <span class="token number">300</span><span class="token punctuation">:</span> <span class="token number">0.376007</span><span class="token operator">-</span><span class="token number">0.008966216045043067</span>损失结果 <span class="token number">400</span><span class="token punctuation">:</span> <span class="token number">0.331463</span><span class="token operator">-</span><span class="token number">0.010796335272035083</span>损失结果 <span class="token number">500</span><span class="token punctuation">:</span> <span class="token number">0.303273</span><span class="token operator">-</span><span class="token number">0.012282447313396519</span>损失结果 <span class="token number">600</span><span class="token punctuation">:</span> <span class="token number">0.279880</span><span class="token operator">-</span><span class="token number">0.013402386273819053</span>损失结果 <span class="token number">700</span><span class="token punctuation">:</span> <span class="token number">0.260042</span><span class="token operator">-</span><span class="token number">0.014245091216970799</span>损失结果 <span class="token number">800</span><span class="token punctuation">:</span> <span class="token number">0.242941</span><span class="token operator">-</span><span class="token number">0.014875420165524832</span>损失结果 <span class="token number">900</span><span class="token punctuation">:</span> <span class="token number">0.228004</span><span class="token operator">-</span><span class="token number">0.015341288386626626</span>损失结果 <span class="token number">1000</span><span class="token punctuation">:</span> <span class="token number">0.214820</span><span class="token operator">-</span><span class="token number">0.015678788375442378</span>损失结果 <span class="token number">1100</span><span class="token punctuation">:</span> <span class="token number">0.203078</span><span class="token operator">-</span><span class="token number">0.015915536343924556</span>损失结果 <span class="token number">1200</span><span class="token punctuation">:</span> <span class="token number">0.192544</span><span class="token operator">-</span><span class="token number">0.01607292624287493</span>损失结果 <span class="token number">1300</span><span class="token punctuation">:</span> <span class="token number">0.183033</span><span class="token operator">-</span><span class="token number">0.016167692508505707</span>损失结果 <span class="token number">1400</span><span class="token punctuation">:</span> <span class="token number">0.174399</span><span class="token operator">-</span><span class="token number">0.016213022073676534</span>损失结果 <span class="token number">1500</span><span class="token punctuation">:</span> <span class="token number">0.166521</span><span class="token operator">-</span><span class="token number">0.016219364232163875</span>损失结果 <span class="token number">1600</span><span class="token punctuation">:</span> <span class="token number">0.159305</span><span class="token operator">-</span><span class="token number">0.01619503271238927</span>损失结果 <span class="token number">1700</span><span class="token punctuation">:</span> <span class="token number">0.152667</span><span class="token operator">-</span><span class="token number">0.016146661324349904</span>损失结果 <span class="token number">1800</span><span class="token punctuation">:</span> <span class="token number">0.146542</span><span class="token operator">-</span><span class="token number">0.01607955397736277</span>损失结果 <span class="token number">1900</span><span class="token punctuation">:</span> <span class="token number">0.140872</span><span class="token operator">-</span><span class="token number">0.015997956805040348</span>训练集准确率<span class="token punctuation">:</span> <span class="token number">99.04306220095694</span> 测试集准确率<span class="token punctuation">:</span> <span class="token number">70.0</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;读取猫狗的图片矩阵数据，自实现神经元神经网络进行二分类&quot;&gt;&lt;a href=&quot;#读取猫狗的图片矩阵数据，自实现神经元神经网络进行二分类&quot; class=&quot;headerlink&quot; title=&quot;读取猫狗的图片矩阵数据，自实现神经元神经网络进行二分类&quot;&gt;&lt;/a&gt;读取猫狗的</summary>
      
    
    
    
    <category term="神经网络案例" scheme="https://xiaoyvlongoing.github.io/categories/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E6%A1%88%E4%BE%8B/"/>
    
    
    <category term="猫狗分类" scheme="https://xiaoyvlongoing.github.io/tags/%E7%8C%AB%E7%8B%97%E5%88%86%E7%B1%BB/"/>
    
  </entry>
  
  <entry>
    <title>pytorch架构基础</title>
    <link href="https://xiaoyvlongoing.github.io/2020/02/10/pytorch%E5%9F%BA%E7%A1%80/"/>
    <id>https://xiaoyvlongoing.github.io/2020/02/10/pytorch%E5%9F%BA%E7%A1%80/</id>
    <published>2020-02-10T06:47:40.000Z</published>
    <updated>2021-06-27T16:48:57.151Z</updated>
    
    <content type="html"><![CDATA[<h2 id="pytorch架构基础"><a href="#pytorch架构基础" class="headerlink" title="pytorch架构基础"></a>pytorch架构基础</h2><h4 id="创建固定，"><a href="#创建固定，" class="headerlink" title="创建固定，"></a>创建固定，</h4><table><thead><tr><th>函数</th><th>函数性质</th></tr></thead><tbody><tr><td>torch.tensor([],[])</td><td>创建固定张量      类型为torch.float32类型</td></tr><tr><td>toch.tensor(np.array([]))</td><td>用np创建张量</td></tr><tr><td></td><td></td></tr><tr><td><strong>张量进行拼接</strong></td><td></td></tr><tr><td>torch.cat((变量张量1,变量张量2, 变量张量3), 0)</td><td>张量进行拼接：                                                                                             张量拼接，                                                                                                                    0：代表竖列拼接，1代表横向拼接</td></tr><tr><td></td><td></td></tr><tr><td>numpy.mgrid（）</td><td>回一个密集的多维“ meshgrid”，以便每个返回的参数具有相同的形状。  输出数组的尺寸和数量等于索引尺寸的数量。  如果步长不是复数，则停止不包括在内</td></tr><tr><td></td><td></td></tr><tr><td>np.<strong>dstack</strong>()</td><td>沿深度方向（沿第三轴）按顺序堆叠数组。                                                                              阵列的序列: 除第三个轴外，所有阵列的形状都必须相同。  一维或二维阵列必须具有相同的形状。</td></tr><tr><td><strong>创建64的类型</strong></td><td></td></tr><tr><td>torch.set_default_tensor_type(torch.DoubleTensor)</td><td>创建64的类型</td></tr><tr><td></td><td></td></tr><tr><td><strong>恢复32的类型</strong></td><td></td></tr><tr><td>torch.set_default_tensor_type(torch.FloatTensor)</td><td>创建32的类型</td></tr><tr><td></td><td></td></tr></tbody></table><pre class=" language-python"><code class="language-python">np<span class="token punctuation">.</span>mgrid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>np<span class="token punctuation">.</span>mgrid<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">5j</span><span class="token punctuation">]</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span> <span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">.</span> <span class="token punctuation">,</span>  <span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">.</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>np<span class="token punctuation">.</span>dstack<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>a <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>b <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>np<span class="token punctuation">.</span>dstack<span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><h4 id="np-vstack-和np-hstack"><a href="#np-vstack-和np-hstack" class="headerlink" title="np.vstack()和np.hstack()"></a>np.vstack()和np.hstack()</h4><p>在这里我们介绍两个拼接数组的方法：</p><p>np.vstack():在竖直方向上堆叠</p><p>np.hstack():在水平方向上平铺</p><pre><code>import numpy as nparr1=np.array([1,2,3])arr2=np.array([4,5,6])print np.vstack((arr1,arr2)) print np.hstack((arr1,arr2)) a1=np.array([[1,2],[3,4],[5,6]])a2=np.array([[7,8],[9,10],[11,12]])print a1print a2print np.hstack((a1,a2))</code></pre><p>结果如下：</p><pre><code>[[1 2 3] [4 5 6]][1 2 3 4 5 6][[1 2] [3 4] [5 6]][[ 7  8] [ 9 10] [11 12]][[ 1  2  7  8] [ 3  4  9 10] [ 5  6 11 12]]</code></pre><h4 id="数组创建"><a href="#数组创建" class="headerlink" title="数组创建"></a>数组创建</h4><table><thead><tr><th>函数</th><th>函数性质</th></tr></thead><tbody><tr><td>numpy.<strong>eye</strong>(<em>N</em>, <em>M=None</em>, <em>k=0</em>, <em>dtype=&lt;class ‘float’&gt;</em>, <em>order=’C’</em>, ***, <em>like=None</em>)</td><td><strong>参数                                                                                                                                                                             N：</strong>int：输出中的行数                                                                                                                                 <strong>M</strong>：int：输出中的列数。 如果没有，默认为 <em>N</em> 。                                                                                                   <strong>k</strong>：int ：对角线的索引：0（默认）是指主对角线，正值表示上对角线，负值表示到较低的对角线。</td></tr><tr><td><strong>返回</strong>：</td><td>返回一个二维数组，对角线上为 1，其他地方为 0。</td></tr></tbody></table><pre class=" language-python"><code class="language-python">np<span class="token punctuation">.</span>eye<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>int<span class="token punctuation">)</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>np<span class="token punctuation">.</span>eye<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>int<span class="token punctuation">)</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>np<span class="token punctuation">.</span>eye<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><h3 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h3><table><thead><tr><th>函数</th><th>函数性质</th></tr></thead><tbody><tr><td>torch.LongTensor（）</td><td>构建一个多少*多少的 <code>Long</code>类型的张量，</td></tr><tr><td>Variable(torch.LongTensor([2, 1, 0]))</td><td>加上Variable后可以表示标签</td></tr><tr><td></td><td></td></tr><tr><td>torch.Variable（）</td><td>int变量，required_grad=True是会更新参数，默认为False它是一种可以变化的变量，这正好就符合了反向传播，参数更新的属性。<code>Variable API</code> 几乎和 <code>Tensor API</code>一致 (除了一些<code>in-place</code>方法，这些<code>in-place</code>方法会修改 <code>required_grad=True</code>的 <code>input</code> 的值)。多数情况下，将<code>Tensor</code>替换为<code>Variable</code>，代码一样会正常的工作。由于这个原因，我们不会列出<code>Variable</code>的所有方法，你可以通过<code>torch.Tensor</code>的文档来获取相关知识。</td></tr><tr><td></td><td></td></tr><tr><td>.long()</td><td>形成torch.int64</td></tr><tr><td>.int()</td><td>形成torch.32</td></tr><tr><td>.float()</td><td>形成float32</td></tr><tr><td></td><td></td></tr><tr><td><strong>获取默认的数据类型</strong></td><td></td></tr><tr><td>torch.get_default_dtype()</td><td>默认的数据类型</td></tr><tr><td></td><td></td></tr><tr><td><strong>扩展数组</strong></td><td></td></tr><tr><td>np.expand_dims(<em>a</em>, <em>axis</em>)</td><td><strong>参数</strong>                                                                                                                          a：输入数组。                                                                                                       axis ：在第几维度增加一维，axis=0，就在第1维增加，axis=-1就在最后一维增加，可以为（第几维，第几维）一次增加2个</td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h4 id="创建张量"><a href="#创建张量" class="headerlink" title="创建张量"></a>创建张量</h4><table><thead><tr><th>函数</th><th>函数性质.</th></tr></thead><tbody><tr><td>.shape（）</td><td>张量的维度</td></tr><tr><td>.size()</td><td>得到张量的尺寸，几行几列</td></tr><tr><td>.dim()</td><td>得到是张量的阶数</td></tr><tr><td>.view(行，列)</td><td>不改变内存里面的顺序的，改变形状，如2行,3列，可以转换为3行，2列</td></tr><tr><td>torch.rand（行，列）</td><td>创建一个<strong>有初始化</strong>的矩阵，</td></tr><tr><td>torch.empty(行，列)</td><td>创建一个<strong>没有初始化</strong>的矩阵，<strong>float32</strong></td></tr><tr><td>torch.tensor（[数据1，数据2]）</td><td>直接通过数据创建张量</td></tr><tr><td>变量.new_ones（行，列，dtype=torch.double）</td><td>通过已有的一个张量创建相同尺寸的新张量，<strong>float64</strong></td></tr><tr><td>torch.randn_like(变量,dtype = torch.float)</td><td>利用randn_like方法得到相同张量尺寸的一个新张量, 并且采用随机初始化来对其赋值，<strong>float32</strong></td></tr><tr><td>torch.ones()</td><td>创建全为1的张量</td></tr><tr><td>torch.zeros（行，列，dtype=torch.long）</td><td>创建一个全0矩阵并可指定数据元素的类型为long，<strong>int64</strong></td></tr><tr><td>torch.long</td><td>将此存储空间转换为 长 型</td></tr><tr><td></td><td></td></tr><tr><td><strong>创建一定范围的序列张量</strong></td><td></td></tr><tr><td>torch.<strong>ones_like</strong>(tensor)</td><td></td></tr><tr><td>torch.arange（起始，末尾，步长）</td><td>创建以步长等差，为开始结束的张量</td></tr><tr><td>torch.logspace()</td><td>等比数列</td></tr><tr><td>torch.rand(行，列)</td><td>创建以范围（0到1）的区间的随机张量</td></tr><tr><td>torch.randint（范围1，范围2，（行，列））</td><td>在这范围的进行随机生成几行几列</td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h4 id="pytorch中tensor的属性，"><a href="#pytorch中tensor的属性，" class="headerlink" title="pytorch中tensor的属性，"></a>pytorch中tensor的属性，</h4><table><thead><tr><th>函数</th><th>函数性质</th></tr></thead><tbody><tr><td>torch.tensor(np.array(1))</td><td>创建为tensor(1, dtype=torch.int32)</td></tr><tr><td>.item()</td><td>把上面的tensor(1, dtype=torch.int32)创建的数值提取出来</td></tr><tr><td></td><td></td></tr></tbody></table><h4 id="类型转换-1"><a href="#类型转换-1" class="headerlink" title="类型转换"></a>类型转换</h4><table><thead><tr><th>函数</th><th>函数性质</th></tr></thead><tbody><tr><td>numpy.ascontiguousarray( <em>a</em> , <em>dtype=None</em> , *** , <em>like=None</em> )</td><td>参数</td></tr><tr><td><strong>返回：</strong>内存中的连续数组（ndim &gt;= 1）（C 顺序）。</td><td><strong>一个</strong> array_like 输入数组。   <strong>dtype</strong> str 或 dtype 对象，可选 返回数组的数据类型。   <strong>像</strong> array_like 允许创建非数组的引用对象  NumPy 数组。  如果一个类似数组的传入作为 <code>like</code>支持  这 <code>__array_function__</code>协议，结果将被定义  通过它。  在这种情况下，它确保创建一个数组对象  与通过此参数传入的兼容。</td></tr><tr><td></td><td></td></tr></tbody></table><h3 id="pytorch基本的运算操作"><a href="#pytorch基本的运算操作" class="headerlink" title="pytorch基本的运算操作"></a>pytorch基本的运算操作</h3><table><thead><tr><th>函数</th><th>函数性质</th></tr></thead><tbody><tr><td>torch.add（变量1，变量2，alpha=10）先用alpha数值去乘于变量2在变量1相加</td><td>加法操作</td></tr><tr><td>变量2.add_(变量1)</td><td>加法方式:把和的总数给了变量2</td></tr><tr><td>torch.add(变量1, 变量2, out=空张量)</td><td>将空的张量作为加法的结果存储张量</td></tr><tr><td>torch.randn（【行，列】）</td><td>创建均值为0方差为1的随机数列（高斯分布）</td></tr><tr><td>变量2.sub(变量1)</td><td>进行相减</td></tr><tr><td>变量1.mm(变量2)</td><td>进行矩阵相乘，矩阵相乘法则，</td></tr><tr><td>变量1.max()</td><td>找到最大的值</td></tr><tr><td>变量.max(dim=可以写0,1,2)</td><td>在那个维度上上找到最大的值</td></tr><tr><td></td><td></td></tr><tr><td>特殊张量运算</td><td></td></tr><tr><td>torch.bmm（变量1张量3维，变量2张量3维）</td><td>进后两维进行运算</td></tr><tr><td># 如果参数1形状是(b × n × m), 参数2形状是(b × m × p), 则输出为(b × n × p) &gt;&gt;&gt; input = torch.randn(10, 3, 4) &gt;&gt;&gt; mat2 = torch.randn(10, 4, 5) &gt;&gt;&gt; res = torch.bmm(input, mat2) &gt;&gt;&gt; res.size() torch.Size([10, 3, 5])</td><td></td></tr></tbody></table><h4 id="pytorch改变性状-转置，正加（填充）维度，减少（压缩）维度"><a href="#pytorch改变性状-转置，正加（填充）维度，减少（压缩）维度" class="headerlink" title="pytorch改变性状,转置，正加（填充）维度，减少（压缩）维度"></a>pytorch改变性状,转置，正加（填充）维度，减少（压缩）维度</h4><table><thead><tr><th>函数</th><th>函数性质</th></tr></thead><tbody><tr><td>.view(行，列)</td><td>不改变内存里面的顺序的，改变形状，如2行,3列，可以转换为3行，2列</td></tr><tr><td>变量1.view(-1, 一行多少个)</td><td>-1代表自动匹配个数，改变行列</td></tr><tr><td>.t()</td><td>进制转置</td></tr><tr><td>.transpose(第几维度,第几维度)</td><td>维度颠倒，内存也进行的乱序，第几维度与另一个设置的第几维度可以进行转置</td></tr><tr><td>.transpose</td><td>经过这个来进行转置的时候还原原来的维度需要进行.contiguous()函数的操作</td></tr><tr><td>.permute(维度几,维度几,维度几)</td><td>可以让多个维度（不只是3维是多维）进行互换转置</td></tr><tr><td>.squeeze(数值)</td><td>压缩维度，可以添加数值，压缩第数值上的维度，</td></tr><tr><td>.unsqueeze(数值)</td><td>增加维度，增添数值的维度</td></tr><tr><td>.reshape(几行,几列)</td><td>改变形状</td></tr><tr><td>.sum()</td><td>求和</td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h4 id="方向翻转"><a href="#方向翻转" class="headerlink" title="方向翻转"></a>方向翻转</h4><table><thead><tr><th>函数</th><th>函数性质</th></tr></thead><tbody><tr><td>numpy.<strong>fliplr</strong>( <em>m</em> )</td><td>参数：<strong>m</strong> 数组类似 输入数组，必须至少是二维的。</td></tr><tr><td>返回：例子</td><td><strong>原来数组</strong>：A = [[1.,  0.,  0.],        [0.,  2.,  0.],        [0.,  0.,  3.]                                                                                         np.<strong>fliplr</strong>(A)                                                                                                                                                <strong>打印</strong>：array([[0.,  0.,  1.],        [0.,  2.,  0.],        [3.,  0.,  0.]])</td></tr></tbody></table><pre class=" language-python"><code class="language-python">A <span class="token operator">=</span> np<span class="token punctuation">.</span>diag<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>Aarray<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>np<span class="token punctuation">.</span>fliplr<span class="token punctuation">(</span>A<span class="token punctuation">)</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><h3 id="关于Torch-Tensor和Numpy-array之间的相互转换"><a href="#关于Torch-Tensor和Numpy-array之间的相互转换" class="headerlink" title="关于Torch Tensor和Numpy array之间的相互转换"></a>关于Torch Tensor和Numpy array之间的相互转换</h3><p>Torch Tensor和Numpy array共享底层的内存空间, 因此改变其中一个的值, 另一个也会随之被改变.</p><table><thead><tr><th>函数</th><th>函数性质</th></tr></thead><tbody><tr><td>torch.from_numpy(变量1)</td><td>将Numpy array转换为Torch Tensor</td></tr><tr><td>b = 变量1.numpy()</td><td>将Torch Tensor转换为Numpy array</td></tr><tr><td>【：，取数值竖列的数字】</td><td></td></tr><tr><td>tensor.detach().numpy()</td><td>require_grad=True不能够直接转换，调用，tensor.detach().numpy()才能进行转换</td></tr><tr><td></td><td></td></tr><tr><td>torch.<strong>FloatTensor</strong>()</td><td>类型转换, 将list ,numpy转化为tensor。 以list -&gt; tensor为例</td></tr><tr><td></td><td></td></tr></tbody></table><h4 id="autograd-package-自动求导工具包"><a href="#autograd-package-自动求导工具包" class="headerlink" title="autograd package(自动求导工具包)"></a>autograd package(自动求导工具包)</h4><ul><li>autograd package提供了一个对Tensors上所有的操作进行自动微分的功能.</li><li></li></ul><table><thead><tr><th>函数</th><th>函数性质</th></tr></thead><tbody><tr><td><strong>torch.Tensor</strong></td><td><strong>package中的核心类</strong></td></tr><tr><td>.grad</td><td>在这个Tensor上的所有梯度将被累加</td></tr><tr><td>.detach()</td><td>可以将该Tensor从计算图中撤下, 在未来的回溯计算中也不会再计算该Tensor.</td></tr><tr><td>with torch.no_grad()</td><td>非常适用于对模型进行预测的时候, 因为预测阶段不再需要对梯度进行计算.</td></tr><tr><td><strong>torch.Function</strong></td><td><strong>和Tensor类同等重要的一个核心类</strong></td></tr><tr><td></td><td></td></tr><tr><td>torch.rand([行，列])</td><td>定义数据</td></tr><tr><td>tensor.detach().numpy()</td><td>require_grad=True不能够直接转换，调用，tensor.detach().numpy()</td></tr><tr><td>(变量,requires_grad=True)</td><td>加上这个来运算，后面对它进行加减乘除的时候都可以来执行自动求导，与后面的都进行了关联，将追踪在这个类上定义的所有操作</td></tr><tr><td>.requires_grad_()</td><td>该方法可以原地改变Tensor的属性.requires_grad的值. 如果没有主动设定默认为False.</td></tr><tr><td>变量1.requires_grad_=True</td><td>这个也可以进行就地加上，等于True的时候加入了求导的运行</td></tr><tr><td>.grad_fn</td><td>每次计算都会修改其grad_fn属性，用来记录做过的操作</td></tr><tr><td>optim.<strong>SGD</strong>(model.parameters(), lr=1e-3)</td><td>实现：SGD优化参数</td></tr><tr><td>nn.<strong>MSELoss</strong>()</td><td>损失函数</td></tr><tr><td><strong>net.zero_grad()</strong></td><td>Pytorch中执行梯度清零的代码</td></tr><tr><td><strong>loss</strong>.<strong>backward</strong>()：反向传播的时候要先进行上一步的操作梯度清零：net.zero_grad()，所有的属性都为：requires_grad=True时就参与梯度求导的运算</td><td>计算图可以通过链式法则求导。计算梯度，反向传播实现的.</td></tr><tr><td>optimizer.step（）</td><td>进行单次优化 (参数更新).</td></tr><tr><td>with torch.no_gard():</td><td>不进行求导的这个是在测试集上进行</td></tr><tr><td>.data()：直接提取里面的数字（浅拷贝）</td><td>在tensor的require_grad=False，tensor.data和tensor等价 require_grad=True时，tensor.data仅仅是获取tensor中的数据</td></tr><tr><td>net.<strong>parameters</strong>()</td><td>模型中所有的可训练参数, 可以通过net.parameters()来获得.equire_grad=True时的参数取出</td></tr><tr><td><strong>在训练和评估模型中进行写入</strong></td><td></td></tr><tr><td>model.train()：在训练模块中进行写入</td><td>启用 BatchNormalization 和 Dropout，将BatchNormalization和Dropout置为True</td></tr><tr><td>model.eval()：在评估（或测试）模块进行写入</td><td>不启用 BatchNormalization 和 Dropout，将BatchNormalization和Dropout置为False，在评估测试中进行使用</td></tr><tr><td>x.data.numpy()：</td><td>直接进行提取数值在进行转换成np类型，可以进行绘图</td></tr><tr><td>.datach</td><td>直接提取里面的数字（深拷贝）</td></tr><tr><td><strong>创建模型</strong></td><td></td></tr><tr><td>import torch.nn as nn</td><td>创建的神经网络的包</td></tr><tr><td>import torch.nn.<strong>functional</strong> as F</td><td>创建</td></tr><tr><td>nn.Conv2d（）</td><td>创建一个卷积</td></tr><tr><td>F.max_pool2d(F.relu(self.conv2(x)), 2)</td><td>创建最大池化</td></tr><tr><td>nn.Linear（<code>in_features</code>，<code>out_features</code>）</td><td><strong>可以进行定义对象，在括号内进行输入变量： **  <strong>in_features</strong>：指的是输入的二维张量的大小，即</strong>输入的**<code>[batch_size, size]</code>中的size  <strong>out_features</strong>:指的是输出的二维张量的大小，即<strong>输出的</strong>二维张量的形状为<code>[batch_size，output_size]</code>，当然，它也代表了<strong>该全连接层的神经元个数</strong>。</td></tr><tr><td><strong>nn.Sequential</strong>（nn.Linear,(),nn.Linear()）</td><td>构建模型可以创建多个全连接层可以自动完成forward函数来创建</td></tr><tr><td></td><td></td></tr><tr><td><strong>创建优化器</strong></td><td><strong>torch.optim</strong>函数下的：</td></tr><tr><td>torch.optim.SGD(参数，学习率)</td><td>以SGD优化器执行</td></tr><tr><td>torch.optim.Adam(参数，学习率)</td><td>以Adam优化器来执行</td></tr><tr><td></td><td></td></tr><tr><td>nn.<strong>functional</strong>.avg_pool1d</td><td>在由多个输入平面组成的输入信号上应用一维平均池。</td></tr><tr><td>`torch.nn.functional.<strong>avg_pool1d</strong>（<em>输入</em>，<em>kernel_size</em>，<em>stride = None</em>，<em>padding = 0</em>，<em>ceil_mode = False</em>，<em>count_include_pad = True</em> ）</td><td><strong>输入</strong>–输入张量的形状（\ text {minibatch}，\ text {in \ _channels}，iW）（小批量，in_channels，<em>我**W</em> ） <strong>kernel_size</strong> –窗口的大小。可以是单个数字或元组（kW，） <strong>步幅</strong>–窗口的步幅。可以是单个数字或元组 （sW，）。默认：<code>kernel_size</code> <strong>padding</strong> –输入两侧的隐式零填充。可以是一个数字或一个元组（padW，）。默认值：0 <strong>ceil_mode</strong> –为True时，将使用ceil而不是floor来计算输出形状。默认：<code>False</code> <strong>count_include_pad</strong> –为True时，将在平均计算中包括零填充。默认：<code>True</code></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h4 id="保存模型"><a href="#保存模型" class="headerlink" title="保存模型"></a>保存模型</h4><table><thead><tr><th>函数</th><th>函数性质</th><th>函数解释</th></tr></thead><tbody><tr><td><code>state_dict</code>（ ）</td><td>将缩放器的状态返回为  <a href="https://docs.python.org/3/library/stdtypes.html#dict"><code>dict</code></a>。  它包含五个条目：                                             <code>&quot;scale&quot;</code> -包含当前比例的Python浮点数                                    <code>&quot;growth_factor&quot;</code> -包含当前增长因子的Python浮点数                               <code>&quot;backoff_factor&quot;</code> -包含当前退避因子的Python浮点数                                                                          <code>&quot;growth_interval&quot;</code> -包含当前增长间隔的Python int                                                                <code>&quot;_growth_tracker&quot;</code> -包含最近连续未跳过步骤数的Python int。                                                                                                                            如果未启用此实例，则返回一个空字典。</td><td>如果您希望在特定迭代后检查定标器的状态，  <a href="https://pytorch.org/docs/stable/amp.html?highlight=state_dict#torch.cuda.amp.GradScaler.state_dict"><code>state_dict()</code></a><br/>应该在之后  <a href="https://pytorch.org/docs/stable/amp.html?highlight=state_dict#torch.cuda.amp.GradScaler.update"><code>update()</code></a>.</td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></tbody></table><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 首先设定模型的保存路径</span>PATH <span class="token operator">=</span> <span class="token string">'./cifar_net.pth'</span><span class="token comment" spellcheck="true"># 保存模型的状态字典</span>torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>模型名字<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> PATH<span class="token punctuation">)</span></code></pre><h4 id="优化器的创建"><a href="#优化器的创建" class="headerlink" title="优化器的创建"></a>优化器的创建</h4><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 首先导入优化器的包, optim中包含若干常用的优化算法, 比如SGD, Adam等</span><span class="token keyword">import</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">as</span> optim<span class="token comment" spellcheck="true"># 通过optim创建优化器对象</span>optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>net<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 将优化器执行梯度清零的操作</span>optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>output <span class="token operator">=</span> net<span class="token punctuation">(</span>input<span class="token punctuation">)</span>loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>output<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 对损失值执行反向传播的操作</span>loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 参数的更新通过一行标准代码来执行</span>optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h4 id="损失函数系列"><a href="#损失函数系列" class="headerlink" title="损失函数系列"></a>损失函数系列</h4><table><thead><tr><th>函数</th><th>函数性质</th></tr></thead><tbody><tr><td>zero_grad()</td><td>把梯度置零，也就是把loss关于weight的导数变成0，就是每一批次进行清零操作</td></tr><tr><td>nn.MSELoss</td><td>均方误差：常用于回归问题</td></tr><tr><td>nn.CrassEntropyLoss(，预测值，真实值)</td><td>交叉熵损失：分类问题，</td></tr><tr><td></td><td></td></tr><tr><td>class torch.nn.Parameter()</td><td>模型中所有的可训练参数,</td></tr><tr><td>view(1, -1)</td><td>view()函数作用是将一个多行的Tensor,拼接成一行。返回一个有相同数据但大小不同的tensor。返回的tensor必须有与原tensor相同的数据和相同数目的元素，但可以有不同的大小。一个tensor必须是连续的<code>contiguous()</code>才能被查看。</td></tr></tbody></table><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn<span class="token keyword">from</span> torch <span class="token keyword">import</span> optim<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt<span class="token comment" spellcheck="true"># 1. 定义数据</span>x <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>y <span class="token operator">=</span> x<span class="token operator">*</span><span class="token number">3</span> <span class="token operator">+</span> <span class="token number">0.8</span><span class="token comment" spellcheck="true">#2 .定义模型</span><span class="token keyword">class</span> <span class="token class-name">Lr</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    super<span class="token punctuation">(</span>Lr<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>linear <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span>）<span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>    out <span class="token operator">=</span> self<span class="token punctuation">.</span>linear<span class="token punctuation">(</span>x<span class="token punctuation">)</span>    <span class="token keyword">return</span> out                            <span class="token comment" spellcheck="true"># 2. 实例化模型，损失loss，和优化器，</span>model <span class="token operator">=</span> Lr<span class="token punctuation">(</span><span class="token punctuation">)</span>criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>MSELoss<span class="token punctuation">(</span><span class="token punctuation">)</span>optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span>里面的参数都进行固定不动<span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#3. 训练模型</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">30000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    out <span class="token operator">=</span> model<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#3.1 获取预测值</span>    loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>y<span class="token punctuation">,</span>out<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#3.2 计算损失</span>    optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#3.3 梯度归零</span>    loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#3.4 计算梯度</span>    optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 3.5 更新梯度</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">20</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Epoch[&amp;#123;&amp;#125;/&amp;#123;&amp;#125;], loss: &amp;#123;:.6f&amp;#125;'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">30000</span><span class="token punctuation">,</span>loss<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#4. 模型评估</span>model<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#设置模型为评估模式，即预测模式，将model.parameters()里面的参数都进行固定不动，预测的时候固定不变，才能预测，就把requires_grad=False了</span>predict <span class="token operator">=</span> model<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#把x进去得到我们的预测</span>predict <span class="token operator">=</span> predict<span class="token punctuation">.</span>data<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#真实的值拿出来</span>plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>x<span class="token punctuation">.</span>data<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>y<span class="token punctuation">.</span>data<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c<span class="token operator">=</span><span class="token string">"r"</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">.</span>data<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>predict<span class="token punctuation">)</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;pytorch架构基础&quot;&gt;&lt;a href=&quot;#pytorch架构基础&quot; class=&quot;headerlink&quot; title=&quot;pytorch架构基础&quot;&gt;&lt;/a&gt;pytorch架构基础&lt;/h2&gt;&lt;h4 id=&quot;创建固定，&quot;&gt;&lt;a href=&quot;#创建固定，&quot; class</summary>
      
    
    
    
    <category term="pytorch" scheme="https://xiaoyvlongoing.github.io/categories/pytorch/"/>
    
    
    <category term="pytorch" scheme="https://xiaoyvlongoing.github.io/tags/pytorch/"/>
    
  </entry>
  
  <entry>
    <title>机器学习，神经网络 -- 上</title>
    <link href="https://xiaoyvlongoing.github.io/2020/02/10/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80%E7%90%86%E8%AE%BA--%E4%B8%8A/"/>
    <id>https://xiaoyvlongoing.github.io/2020/02/10/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80%E7%90%86%E8%AE%BA--%E4%B8%8A/</id>
    <published>2020-02-10T06:47:40.000Z</published>
    <updated>2021-06-24T17:45:35.512Z</updated>
    
    <content type="html"><![CDATA[<h2 id="什么是机器学习"><a href="#什么是机器学习" class="headerlink" title="什么是机器学习"></a>什么是机器学习</h2><p>——-先观察后照做<br> ——-机器学习算法都试图以某种它可以的方式来模拟两个数据之间存在的模式，从而做到用一个数据集来预测另一个数据集<br> ——-机器学习的大部分工作都是训练某种监督分类器</p><ul><li>机器学习：<br> 机器学习是计算机科学的的一个分支，机器学习观察某个任务中存在的模式，并试图以某种直接或者间接的方式模仿它。</li></ul><h2 id="机器学习理论基础"><a href="#机器学习理论基础" class="headerlink" title="机器学习理论基础"></a>机器学习理论基础</h2><p><strong>机器学习工作流程的总结</strong></p><ul><li><p>获取数据集：<br> 要有多少的样本每个样本的特征，根据特征再进行归类成相应的目标值</p><pre><code> 1：数据要有代表性，否者会过拟合，（数据集尽量差异大，提取会更好）。 2：对数据的分类问题，数据偏斜不能过严重，不同类别的数据数量不要有数量级的差距。 3：对数据集的量级做一个评估，多少个样本，多少个特征，可以估算出内存的消耗，     太大放不下就要考虑改进算法和做一些降维的技巧，如果数据集太大，就要考虑做分布式的处理方式。</code></pre></li><li><p>数据集的基本处理：</p><pre><code> 1：数据的清洗很关键的一步，能够使算法效果和性能显著的提高：     如归一化，离散化，因子化，缺失值的处理，去除共线性等，数据的挖掘过程就花在他们上面。 2：数据的增强操作：翻转。</code></pre></li><li><p>特征工程的提取：</p><pre><code> 1：良好的数据能过提取良好的特征才能发挥作用。 2：筛选出显著的特征，放弃非显著的特征，非常简单的算法也能有不错的结果。 3：需要运用有效性的分析相关的技术，相关的系数，卡方检验，平均互信息，条件熵，后验概率，逻辑回归权重等方法。</code></pre></li><li><p>机器学习（构建模型训练）：<br> 训练的数据（70%-80%）测试数据集（20%-30%）</p><pre><code> 1：怎样才能把这些算法的（超参数）使得变得更加优良，理解越深才能更有效的提出优化的方案。</code></pre></li><li><p>模型的评估：</p><pre><code> 没有达到要求，从新上面的步骤 达到一定的要求，上线服务</code></pre></li></ul><h2 id="机器学习的算法分类"><a href="#机器学习的算法分类" class="headerlink" title="机器学习的算法分类"></a>机器学习的算法分类</h2><p><strong>两种机器学习的主要类型：</strong><br> 数据集的组成不同，算法就有所不同</p><pre><code>    监督和无监督主要关注被学习的模式的类型    无监督学习和监督学习都是将一个数据集转化为另一个数据集</code></pre><ul><li><p>监督学习：你知道的—–》监督学习—-》你想知道的</p></li><li><p>监督机器学习：创建能接收可观察，可记录的，输入数据的方法，他能将转换为所需要再进行逻辑分析的有价值的输出数据。</p><pre><code> 他可以直接模仿两个数据集之间的模式，尝试获取一个输入数据集并将其转换为     对应的输出数据集：如使用像素来检测猫存在与否</code></pre></li><li><p>监督学习对数据集进行转换</p></li><li><p>监督学习是一种将一个数据集转换为另一个数据集的方法</p><pre><code> 1：输入数据是由输入特征和目标值所组成的：      （一）：函数的输出可以是一个连续的值（称为回归）      （二）：或是输出是个有限的离散值（称为分类）</code></pre></li><li><p>无监督学习：一系列的数据点—–》无监督学习—–》一系列的数据聚类标签。</p></li><li><p>将数据集进行聚类就是一种无监督学习： 聚类算法：将一系列数据点转换为对应的一系列类别的标签。</p></li><li><p>无监督学习对数据集进行分组</p><pre><code> 1：输入数据是由输入特征值组成，没有目标值：     （一）：输入数据没有被标记，也没有确定的结果，数据类别未知     （二）：需要根据样本间的相似性对样本进行类别的分类</code></pre></li><li><p>半监督学习</p><pre><code> 1：训练集同时含有标记的数据和未标记的数据样本</code></pre></li><li><p>强化学习：</p><pre><code> 1：实质是make decisions 问题，即自动进行决策，并且可以做练习决策   （一）：五个元素：代理品，行动，奖励，环境，观察情况   （二）：强化学习目标是获取最多的累计奖励</code></pre><h2 id="四种不同类型的算法：监督或者无监督，参数或者无参数"><a href="#四种不同类型的算法：监督或者无监督，参数或者无参数" class="headerlink" title="四种不同类型的算法：监督或者无监督，参数或者无参数"></a>四种不同类型的算法：监督或者无监督，参数或者无参数</h2></li><li><p>监督和无监督的特性是：主要关注被学习的模式的类型</p></li><li><p>参数和非参数类型：主要关注存储学习参数的方式</p><h1 id="参数学习和非参数学习"><a href="#参数学习和非参数学习" class="headerlink" title="参数学习和非参数学习"></a>参数学习和非参数学习</h1></li><li><p>参数学习和非参数学习：试错学习和计数和概率<br> 参数是一种通用的术语，所指的仅是用于识别模式的-组数字–并不影响限制我们我们第一这些数字的正常使用，<br> 技术的参数权重是参数</p><pre><code> 主要关注存储学习参数的方式，更进一步说是关注学习的方法 参数模型的特征是具有固定的数量的参数，而非参数的参数数量是无限的（由数据决定）     1：参数模型倾向于试错法     2：非参数模型倾向于计数法</code></pre><h2 id="监督学习和强化学习的对比"><a href="#监督学习和强化学习的对比" class="headerlink" title="监督学习和强化学习的对比"></a>监督学习和强化学习的对比</h2><pre><code> 反馈映射:          监督学习：输出的是之间的关系，可以告诉算法什么样的输入对应着什么样的输出。          强化学习：输出的是给机器的反馈 reward function，即用来判断这个行为是好是坏。 反馈时间          监督学习：做了比较坏的选择会立刻反馈给算法。          强化学习：结果反馈有延时，有时候可能需要走了很多步以后才知道以前的某一步的选择是好还是坏。 输入特征          监督学习：输入是独立同分布的。          强化学习：面对的输入总是在变化，每当算法做出一个行为，它影响下一次决策的输入，一直在变化的  拓展概念：什么是独立同分布：</code></pre></li></ul><h2 id="监督参数学习：使用旋钮进行试错学习"><a href="#监督参数学习：使用旋钮进行试错学习" class="headerlink" title="监督参数学习：使用旋钮进行试错学习"></a>监督参数学习：使用旋钮进行试错学习</h2><ul><li>机器根据旋钮的角度对输入数据进行处理，并转换为预测结果</li></ul><p>预测—与真值进行比较—-学习模式<br> 通过调节参数来达到最好的预判结果</p><h2 id="无监督参数学习"><a href="#无监督参数学习" class="headerlink" title="无监督参数学习"></a>无监督参数学习</h2><p>无监督参数学习就是就是使用旋钮对数据经行分组，每个类别都设置了几个旋钮，每个旋钮都反映了输入数据到那个特等类别的相似度</p><h2 id="非参数学习：基于计数的方法"><a href="#非参数学习：基于计数的方法" class="headerlink" title="非参数学习：基于计数的方法"></a>非参数学习：基于计数的方法</h2><ul><li>参数算法有固定数量的参数，而非参数算法会根据数据集调整参数个数</li></ul><h2 id="神经网络：它将输入乘以权重，将输入“缩放”一定比例"><a href="#神经网络：它将输入乘以权重，将输入“缩放”一定比例" class="headerlink" title="神经网络：它将输入乘以权重，将输入“缩放”一定比例"></a>神经网络：它将输入乘以权重，将输入“缩放”一定比例</h2><p><strong>数据——-机器——预测</strong><br> <strong>预测——比较——学习—&gt;模式</strong><br> 神经网络做了：</p><pre><code> 将输入乘于权重 将输入缩放一定比例</code></pre><p><strong>神经网络的交互：</strong></p><pre><code>  接受输入变量，作为信息来源，   拥有权重变量，以此作为知识，  然后融入信息和知识，输出预测结果</code></pre><p><strong>理解神经网络权重：</strong></p><pre><code>是将它作为网络的输入和预测之间敏感度的度量，权重非常的高，即使最小的输入也会对预测结果产生非常大的影响，权重非常小时再大的输入也只能对预测产生很小的扰动</code></pre><p><strong>多种输入</strong></p><pre><code>将三个输入或更多输入乘于三项权重，并使他们求和得到加权后的权和</code></pre><p><strong>加权和（点积）</strong></p><pre><code>将每个输入乘于其各自的权重，然后对所有的局部预测结果进行求和则成为输入的加权和，简称点积</code></pre><p><strong>点积</strong></p><pre><code> 点积让你了解两个向量之间的相似性， 最大的加权和：出现在完全相同的向量之间 向量之间没有重合的权重，点积为0 重合的权重值为负数，这个会抵消掉他们之间的正相似性</code></pre><p><strong>点积的属性</strong></p><pre><code>点积的属性类比作逻辑上的AND（与）操作，向量中没有相同的，最终得分为0负权重值往往意味着逻辑上的NOT（非）运算符，因为任何正权值与负权值配对都会导致得分下降，两个为负的就会得正值</code></pre><p>OR（或）如果任何一行的权重不为0，分数就会受到影响</p><p><strong>简单的神经网络</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np存储的维度元素数组weights <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#数值为权重</span><span class="token comment" spellcheck="true">#array:为NP中的存储元组的维度</span><span class="token keyword">def</span> <span class="token function">neural_network</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span>weights<span class="token punctuation">)</span>    pred <span class="token operator">=</span> input<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>weights<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#dot:为Numpy中的乘</span>    returu predtoes <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8.5</span><span class="token punctuation">,</span><span class="token number">9.5</span><span class="token punctuation">,</span><span class="token number">9.9</span><span class="token punctuation">,</span><span class="token number">9.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#数值为输入信息数据</span>wlrec <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.65</span><span class="token punctuation">,</span><span class="token number">0.8</span><span class="token punctuation">,</span><span class="token number">0.8</span><span class="token punctuation">,</span><span class="token number">0.9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>nfans <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.2</span><span class="token punctuation">,</span><span class="token number">1.3</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>input <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>toes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>wlerc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>nfans<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>pred <span class="token operator">=</span> neural_network<span class="token punctuation">(</span>input<span class="token punctuation">,</span>weights<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>pred<span class="token punctuation">)</span></code></pre><h2 id="误差"><a href="#误差" class="headerlink" title="误差"></a>误差</h2><p>预测出来的结果与实际中的结果存在着多少的误差</p><ul><li>均方误差：是评估神经网络准确性的众多方法之一</li><li>比较是在逻辑上的输出是“冷/热”这一类信号</li><li>提升权重：up_prediction = input*(weight+step_amount)#step_amount=0.001(增加权重值)</li></ul><h2 id="学习"><a href="#学习" class="headerlink" title="学习"></a>学习</h2><ul><li><strong>学习</strong>：就是告诉权重应该如何改变以及降低误差，深度学习最流行的方法为：梯度下降，在预测步骤结束时：学习这一步会为每项权重计算一个数字，这个数字告诉我们，减少误差，权重应该向那个方向变化，然后，我们根据这个数字对权重做出相应的调节，直到达到目的。</li><li><strong>学习</strong>：学习就是调整权重，将误差减小到0</li></ul><h2 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h2><p>这一步会让你知道自己的模型错了多少</p><ul><li>比较：你是的神经网络是否做好的预测</li></ul><h2 id="测量误差"><a href="#测量误差" class="headerlink" title="测量误差"></a>测量误差</h2><ul><li>训练神经网络的目的是做出正确的预测</li><li>纯误差：（（权重<em>输入数据）-  真实数据） -均方误差：（（权重</em>输入数据）-  真实数据）**2 将误差进行平方，进负数的误差进行正值，和将更大的误差更大，更小的误差更小（小于1的数更小，大于1的数更大）</li><li>冷热学习：就是通过扰动权重从新确定向那个方向调整可以使得误差的降低幅度最大，基于此将权重值向那个方向移动<br> 权重实际进行调节取决于那个方向所得到的误差更小</li><li>执行缩放，负值翻转和停止调节对纯误差进行修正以及更新权重（（权重*输入）- 真实数据）× 输入数据</li><li>缩放，停止，负值反转：三个属性作用进纯误差转换为我们需要的权重调节的绝对幅度</li></ul><pre class=" language-python"><code class="language-python">weight <span class="token operator">=</span> <span class="token number">0.5</span><span class="token comment" spellcheck="true">#权重</span>input <span class="token operator">=</span> <span class="token number">0.5</span><span class="token comment" spellcheck="true">#数据</span>goal_prediction <span class="token operator">=</span> <span class="token number">0.8</span><span class="token comment" spellcheck="true">#真实的值（goal_pred:真值）</span>step_amount <span class="token operator">=</span> <span class="token number">0.001</span><span class="token comment" spellcheck="true">#权重增加的值</span><span class="token keyword">for</span> iteration <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1101</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#循环迭代预测</span>predidction <span class="token operator">=</span> input <span class="token operator">*</span> weight <span class="token comment" spellcheck="true">#预测出来的值</span>weight_delta<span class="token punctuation">(</span>误差增量就是你的导数<span class="token punctuation">)</span>error <span class="token operator">=</span> <span class="token punctuation">(</span>predidction <span class="token operator">-</span> goal_prediction<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token comment" spellcheck="true">#误差值进行平方</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Error:"</span><span class="token operator">+</span> str<span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"predidction:"</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>predidction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#</span>up_prediction <span class="token operator">=</span> input <span class="token operator">*</span> <span class="token punctuation">(</span>weight <span class="token operator">+</span> srep_amount<span class="token punctuation">)</span>up_error <span class="token operator">=</span> goal_prediction <span class="token operator">-</span> up_prediction<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span>down_predicton <span class="token operator">=</span> input <span class="token operator">*</span> <span class="token punctuation">(</span>weight <span class="token operator">-</span> dtep_amount<span class="token punctuation">)</span>down_error <span class="token operator">=</span><span class="token punctuation">(</span>goal_prediction <span class="token operator">-</span> down_prediction<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token keyword">if</span> <span class="token punctuation">(</span>down_error <span class="token operator">&lt;</span> up_error<span class="token punctuation">)</span><span class="token punctuation">:</span>    weight <span class="token operator">=</span> weight <span class="token operator">-</span> step_amount<span class="token keyword">if</span> <span class="token punctuation">(</span>down_error <span class="token operator">></span> up_error<span class="token punctuation">)</span><span class="token punctuation">:</span>    weight <span class="token operator">=</span> weight <span class="token operator">+</span> step_amount</code></pre><h2 id="梯度下降"><a href="#梯度下降" class="headerlink" title="梯度下降:"></a>梯度下降:</h2><h3 id="更新出来的新权重的值-weight-：（（（权重-×-输入）-真实数据）×-输入）×-训练之前确定的权重增量的值（alpha）"><a href="#更新出来的新权重的值-weight-：（（（权重-×-输入）-真实数据）×-输入）×-训练之前确定的权重增量的值（alpha）" class="headerlink" title="**更新出来的新权重的值(weight)**：（（（权重 × 输入）- 真实数据）× 输入）× 训练之前确定的权重增量的值（alpha）"></a>**更新出来的新权重的值(weight)**：（（（权重 × 输入）- 真实数据）× 输入）× 训练之前确定的权重增量的值（alpha）</h3><p><strong>alpha</strong>：调节控制网络学习的速度。<br> 测量误差，找出权重调节的方向和幅度，对方向和幅度的计算，对权重进行调整以减少错误<br> direction_and_amount = (pred - goal_pred) * input<br> #纯误差，<br> #与输入相乘，用于执行缩放，负值反转和停止调节，对纯误差进行修正以更新权重</p><ul><li><strong>预测的数据（pred）</strong>：权重*输入</li><li><strong>输出节点（delta）</strong>：（权重*输入）- 真实数据（delta）<br> ：当前节点的变化以便完美第预测结果</li><li><strong>误差的增量（weight_delta</strong>）：（（权重*输入）- 真实数据）× 输入数据：将权重的输出节点增加（delta）乘以权重的输入，进行权重缩放操作<br> ：基于导数对权重移动的方向和数量的估计</li><li>原始权重 - 权重的增量</li><li>**更新出来的新权重的值(weight)*<em>：（（（权重</em>输入）- 真实数据）× 输入）× 训练之前确定的权重增量的值（alpha）<br> <strong>纯误差</strong>：预测值和真实值的差值，表示当前的错误的原始方向和幅度，如果是一个正值，那么预测就太高了，反之亦然，如果很大的数字那么就错了很多<br> <strong>停止调节</strong>：例子CD碟片插入立体播放机，把音量调到最大，但是CD播放器是关着的，就是输入为0时，模型就不会进行学习，所有的权重值都会产生相同的误差，对其进行调节没有什么区别，预测的一直为0，<br> <strong>负值翻转</strong>：当输入为负值时纯误差也为负值，再进与输入相乘，权重向着正值方向前进<br> <strong>缩放</strong>：是对纯误差进行第三项修正，是输入引起，如果输入很大，则权重更新也会变得更大，就相当于副作用，进程可能失去控制，<br> <strong>权重修改</strong>：权重的修改，能够使预测的值之间的误差逐渐接近于0，达到预测值和真实值无限接近</li></ul><pre class=" language-python"><code class="language-python">weight<span class="token punctuation">,</span>goal_pred<span class="token punctuation">,</span>input <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.8</span><span class="token punctuation">,</span><span class="token number">1.1</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#权重， 真实值，  输入</span><span class="token keyword">for</span> iteration <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"----\nWeight:"</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>weight<span class="token punctuation">)</span><span class="token punctuation">)</span>    pred <span class="token operator">=</span> input<span class="token operator">*</span>weight  <span class="token comment" spellcheck="true">#输入乘权重预测值</span>    error <span class="token operator">=</span> <span class="token punctuation">(</span>pred <span class="token operator">-</span> goal_pred<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token comment" spellcheck="true">#预测值-真实值的平方：均方误差</span>    delta <span class="token operator">=</span> pred <span class="token operator">-</span> goal_pred<span class="token comment" spellcheck="true">#纯误差</span>    weight_delta <span class="token operator">=</span> delta <span class="token operator">*</span> input<span class="token comment" spellcheck="true">#反转预测后的值数</span>    weight <span class="token operator">=</span> weight <span class="token operator">-</span> weight_delta<span class="token comment" spellcheck="true">#节点delta值，实际误差与反转后判定的进行相互补</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Error:"</span><span class="token operator">+</span>str<span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"prediction:"</span><span class="token operator">+</span>str<span class="token punctuation">(</span>pred<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"delta:"</span><span class="token operator">+</span>str<span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"weight delta:"</span><span class="token operator">+</span>str<span class="token punctuation">(</span>weight_delta<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h2 id="误差减小"><a href="#误差减小" class="headerlink" title="误差减小"></a>误差减小</h2><p>为了使误差减小，我们尽力去寻求权重应该变化的方向和幅度，导数给出了函数中任意两个变量之间的关系，我们可以用导数来确定权重和误差之间的关系，然后把权重的值向导数的反方向移动，就能得到使误差更小的权重值。</p><h2 id="学习就是减少误差"><a href="#学习就是减少误差" class="headerlink" title="学习就是减少误差"></a>学习就是减少误差</h2><ol><li>可以修改权重减少误差：就是找到正确的方向和幅度来改变权重，使误差减小</li><li>原始权重 - 权重的增量</li><li>用斜率来帮助神经网络减少的误差：不管你在碗型曲线的那个位置，斜率都指向碗的底部（此时误差最小）</li></ol><h2 id="学习就是调整权重将误差减小到0"><a href="#学习就是调整权重将误差减小到0" class="headerlink" title="学习就是调整权重将误差减小到0"></a>学习就是调整权重将误差减小到0</h2><ol><li>改变权重值误差的变化就是变化量</li><li>给定一个函数，如果你改变其中一个变量，则它的导数代表了另一个变量发生变化的方向和幅度</li><li>导数是直线或者曲线上的一点斜率</li><li>画出U型曲线：曲线的斜率是正值，这个点就在右边，曲线的斜率为负值</li><li>斜率的符号表示方向，斜率的坡度表示量你可以使这两个方法来帮助我们找到目标权重</li><li>导数代表着，某个函数中两个变量之间的关系</li><li>误差的增量就是你的导数（weight_delta*<em>）：（（权重</em>输入）- 真实数据）× 输入数据：将权重的输出节点增加（delta）乘以权重的输入，进行权重缩放操作，</li><li>画出来的虚色直线是斜率，也是导数，当改变权重时误差会跟着变化多少，如果方向是朝下的，也就说斜率就是负的</li><li>直线或曲线的斜率总是与error最低点的方向相反，所以斜率是负的就增加weight寻求最小的error</li></ol><h2 id="深度学习的目标"><a href="#深度学习的目标" class="headerlink" title="深度学习的目标"></a>深度学习的目标</h2><ol><li>就是误差的减小，尽力寻求权重应该变化的方向和幅度，可以用导数来确定权重和误差之间的关系，然后再把权重的值再向导数的反方向移动，就能得到使误差更小的权重值</li></ol><h2 id="引用α"><a href="#引用α" class="headerlink" title="引用α"></a>引用α</h2><ol><li>α又名alpha：能够减少权重的增量，取值范围0到1之间<br> 把 weight_delta 变量名替换成derivative<br> 2.*更新出来的新权重的值： weight  = weight - (alpha * derivative)</li></ol><p><strong>引用α变量</strong></p><pre class=" language-bash"><code class="language-bash">weight <span class="token operator">=</span> 0.5<span class="token comment" spellcheck="true">#权重</span>goal_pred <span class="token operator">=</span> 0.8<span class="token comment" spellcheck="true">#真实值</span>input <span class="token operator">=</span> 2.0<span class="token comment" spellcheck="true">#输入值</span>alpha <span class="token operator">=</span> 0.1<span class="token comment" spellcheck="true">#α值</span><span class="token keyword">for</span> iteration <span class="token keyword">in</span> range<span class="token punctuation">(</span>20<span class="token punctuation">)</span>:    pred <span class="token operator">=</span> input * weight<span class="token comment" spellcheck="true">#预测值</span>    error <span class="token operator">=</span> <span class="token punctuation">(</span>pred - goal_pred<span class="token punctuation">)</span>**2<span class="token comment" spellcheck="true">#误差值（均方误差）</span>    derivative <span class="token operator">=</span> input * <span class="token punctuation">(</span>pred - goal_pred<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#误差增量:输入数据乘（预测值减去真实值）</span>    weight <span class="token operator">=</span> weight - <span class="token punctuation">(</span>alpha * derivative <span class="token punctuation">)</span><span class="token comment" spellcheck="true">#更新后的权重：权重值减去（误差增量乘a值）</span>    print<span class="token punctuation">(</span><span class="token string">"Error:"</span> +str<span class="token punctuation">(</span>error<span class="token punctuation">)</span> + <span class="token string">"Predicton:"</span> + str<span class="token punctuation">(</span>pred<span class="token punctuation">))</span></code></pre><h2 id="一直更新的权重值"><a href="#一直更新的权重值" class="headerlink" title="一直更新的权重值"></a>一直更新的权重值</h2><p>weight（一直更新权重值） =初始权重值   – [ {（【<strong>预测值：</strong>（输入值×权重值）】减去–【真实值】）×【输入值】} × 【α】]</p><ol><li>预测值 = 输入值×权重值</li><li>误差增量 = （预测值 – 真实值）× 输入值</li><li>更新权重值 = 权重值 - （α × 误差增量）</li></ol><pre class=" language-bash"><code class="language-bash">def w_sum<span class="token punctuation">(</span>a,b<span class="token punctuation">)</span>:    assert <span class="token punctuation">(</span>len<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> len<span class="token punctuation">(</span>b<span class="token punctuation">))</span><span class="token comment" spellcheck="true">#断言:assert:如不相等则抛出异常</span>    output <span class="token operator">=</span> 0<span class="token comment" spellcheck="true">#建立一个空变量</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>a<span class="token punctuation">))</span>:        output +<span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> * b <span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#权重与输入的数据</span>        <span class="token keyword">return</span> outputweights <span class="token operator">=</span> <span class="token punctuation">[</span>0.1,0.2,-1<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#权重a</span>def neural_network<span class="token punctuation">(</span>input,weights<span class="token punctuation">)</span>:    pred <span class="token operator">=</span> w_sum<span class="token punctuation">(</span>input,weights<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#调用了上例的方法</span>    <span class="token keyword">return</span> pred<span class="token comment" spellcheck="true">#返回了预测的值</span><span class="token comment" spellcheck="true">#预测和比较：做出预测，计算误差和增量</span>toes <span class="token operator">=</span> <span class="token punctuation">[</span>8.5,9.5,9.9,9.0<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#踢进去的球</span>wlrec <span class="token operator">=</span> <span class="token punctuation">[</span>0.65,0.8,0.8,0.9<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#胜率的百分比</span>nfans <span class="token operator">=</span> <span class="token punctuation">[</span>1.2,1.3,0.5,1.0<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#粉丝的数量</span>win_or_lose_binary <span class="token operator">=</span> <span class="token punctuation">[</span>1,1,0,1<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#四队的真实值</span><span class="token boolean">true</span> <span class="token operator">=</span> win_or_lose_binary<span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#遍历调用列表值</span>input <span class="token operator">=</span> <span class="token punctuation">[</span>toes<span class="token punctuation">[</span>0<span class="token punctuation">]</span>,wlrec<span class="token punctuation">[</span>0<span class="token punctuation">]</span>,nfans<span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#输入遍历的值</span>pred <span class="token operator">=</span>neural_network<span class="token punctuation">(</span>input,weights<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#调用方法</span>error <span class="token operator">=</span> <span class="token punctuation">(</span>pred - true<span class="token punctuation">)</span> ** 2<span class="token comment" spellcheck="true">#误差值</span>delta <span class="token operator">=</span> pred - <span class="token boolean">true</span><span class="token comment" spellcheck="true">#纯误差，预测值-真实值</span><span class="token comment" spellcheck="true">#学习计算权重增量，将它应用对应的权重上</span>def ele_mul<span class="token punctuation">(</span>number,vector<span class="token punctuation">)</span>:<span class="token comment" spellcheck="true">#误差的增量，权重误差乘于输入值</span>    output <span class="token operator">=</span> <span class="token punctuation">[</span>0,0,0<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#值的增量</span>    assert <span class="token punctuation">(</span>len<span class="token punctuation">(</span>output<span class="token punctuation">)</span> <span class="token operator">==</span> len<span class="token punctuation">(</span>vector<span class="token punctuation">))</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>output<span class="token punctuation">))</span>:        output<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> number * vector<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#更新权重的误差值，纯误差乘于输入值</span>    <span class="token keyword">return</span> outputinput <span class="token operator">=</span> <span class="token punctuation">[</span>toes<span class="token punctuation">[</span>0<span class="token punctuation">]</span>,wlrec<span class="token punctuation">[</span>0<span class="token punctuation">]</span>,nfans<span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#输入值</span>pred <span class="token operator">=</span><span class="token punctuation">(</span>pred - true<span class="token punctuation">)</span> ** 2<span class="token comment" spellcheck="true">#均方误差</span>delta <span class="token operator">=</span> pred - <span class="token boolean">true</span><span class="token comment" spellcheck="true">#纯误差</span>weight_deltas <span class="token operator">=</span> ele_mul<span class="token punctuation">(</span>delta,input<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#调用方法</span><span class="token comment" spellcheck="true">#学习:更新权重</span>input <span class="token operator">=</span> <span class="token punctuation">[</span>toes<span class="token punctuation">[</span>0<span class="token punctuation">]</span>,wlrec<span class="token punctuation">[</span>0<span class="token punctuation">]</span>,nfans<span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token punctuation">]</span>pred <span class="token operator">=</span> neural_network<span class="token variable"><span class="token punctuation">((</span>input<span class="token punctuation">,</span>weights<span class="token punctuation">))</span></span>error <span class="token operator">=</span> <span class="token punctuation">(</span>pred - true<span class="token punctuation">)</span> ** 2delta <span class="token operator">=</span> pred - <span class="token boolean">true</span>weight_deltas <span class="token operator">=</span> ele_mul<span class="token punctuation">(</span>delta,input<span class="token punctuation">)</span>alpha <span class="token operator">=</span> 0.1<span class="token comment" spellcheck="true">#alpha防止权重过度修正</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>weights<span class="token punctuation">))</span>:    weights<span class="token punctuation">[</span>i<span class="token punctuation">]</span> -<span class="token operator">=</span> alpha*weight_deltas<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    print<span class="token punctuation">(</span><span class="token string">"weights:"</span>+str<span class="token punctuation">(</span>weights<span class="token punctuation">))</span>    print<span class="token punctuation">(</span><span class="token string">"weights Deltas:"</span>+str<span class="token punctuation">(</span>weight_deltas<span class="token punctuation">))</span><span class="token comment" spellcheck="true">#先用方法构成预测数值</span>def neursl_network<span class="token punctuation">(</span>input,weights<span class="token punctuation">)</span>:    out <span class="token operator">=</span> 0    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>input<span class="token punctuation">))</span>:        out +<span class="token operator">=</span> <span class="token punctuation">(</span>input<span class="token punctuation">[</span>i<span class="token punctuation">]</span>*weights<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#预测的值</span>    <span class="token keyword">return</span> out<span class="token comment" spellcheck="true">#预测值乘于输入值，</span>def ele_mul<span class="token punctuation">(</span>scalar,vector<span class="token punctuation">)</span>:    out <span class="token operator">=</span> <span class="token punctuation">[</span>0,0,0<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#有4队但是只有测出来的三个类型</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>out<span class="token punctuation">))</span>:        out<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> vector<span class="token punctuation">[</span>i<span class="token punctuation">]</span> * scalar    <span class="token keyword">return</span> out<span class="token comment" spellcheck="true"># 输入数据</span>toes <span class="token operator">=</span> <span class="token punctuation">[</span>8.5,9.5,9.9,9.0<span class="token punctuation">]</span>wlrec <span class="token operator">=</span> <span class="token punctuation">[</span>0.65,0.8,0.8,0.9<span class="token punctuation">]</span>nfans <span class="token operator">=</span> <span class="token punctuation">[</span>1.2,1.3,0.5,1.0<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># 真实数据</span>win_or_lose_binary <span class="token operator">=</span> <span class="token punctuation">[</span>1,1,0,1<span class="token punctuation">]</span><span class="token boolean">true</span> <span class="token operator">=</span> win_or_lose_binary <span class="token punctuation">[</span>0<span class="token punctuation">]</span>alpha <span class="token operator">=</span> 0.01weights <span class="token operator">=</span> <span class="token punctuation">[</span>0.1,0.2,-0.1<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#权重值</span>input <span class="token operator">=</span> <span class="token punctuation">[</span>toes<span class="token punctuation">[</span>0<span class="token punctuation">]</span>,wlrec<span class="token punctuation">[</span>0<span class="token punctuation">]</span>,nfans<span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token keyword">for</span> iter <span class="token keyword">in</span> range<span class="token punctuation">(</span>3<span class="token punctuation">)</span>:    pred <span class="token operator">=</span> neursl_network<span class="token punctuation">(</span>input,weights<span class="token punctuation">)</span>    error <span class="token operator">=</span> <span class="token punctuation">(</span>pred - true<span class="token punctuation">)</span>**2<span class="token comment" spellcheck="true">#均方误差值</span>    delta <span class="token operator">=</span> pred - <span class="token boolean">true</span><span class="token comment" spellcheck="true">#纯误差值</span>    weight_deltas <span class="token operator">=</span> ele_mul<span class="token punctuation">(</span>delta,input<span class="token punctuation">)</span>    print<span class="token punctuation">(</span><span class="token string">"Iteration:"</span> + str<span class="token punctuation">(</span>iter+1<span class="token punctuation">))</span>    print<span class="token punctuation">(</span><span class="token string">"pred:"</span>+ str<span class="token punctuation">(</span>pred<span class="token punctuation">))</span>    print<span class="token punctuation">(</span><span class="token string">"eeore"</span>+ str<span class="token punctuation">(</span>error<span class="token punctuation">))</span>    print<span class="token punctuation">(</span><span class="token string">"delta:"</span>+ str<span class="token punctuation">(</span>delta<span class="token punctuation">))</span>    print<span class="token punctuation">(</span><span class="token string">"weights:"</span>,str<span class="token punctuation">(</span>weights<span class="token punctuation">))</span>    print<span class="token punctuation">(</span><span class="token string">"weight_deltas"</span>,weight_deltas<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#更新权重值</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>weights<span class="token punctuation">))</span>:        weights<span class="token punctuation">[</span>i<span class="token punctuation">]</span> -<span class="token operator">=</span> alpha*weight_deltas<span class="token punctuation">[</span>i<span class="token punctuation">]</span></code></pre><h2 id="具有多个输入和输出的梯度下降"><a href="#具有多个输入和输出的梯度下降" class="headerlink" title="具有多个输入和输出的梯度下降"></a>具有多个输入和输出的梯度下降</h2><h3 id="一次学习多个权重值"><a href="#一次学习多个权重值" class="headerlink" title="一次学习多个权重值"></a>一次学习多个权重值</h3><p>每个单独权重对于全局误差所产生的影响的度量，因此，因为误差是共享的，当一项权重达到U型曲线的底部时，所有的权重都会达到U型的底部</p><p>权重A可能对应着重要的数据，对预测有着举足轻重的影响，但如果网络在训练中意外的找到一种不需要它也可能准确推断预测的情况，那么权重A则不将对预测结果产生任何影响。</p><p>误差由训练数据决定，任何网络的权重都可以任意取值，但给定任意特定权重的设置后，则误差值百分百由数据决定。</p><h2 id="具有多输入的梯度下降学习"><a href="#具有多输入的梯度下降学习" class="headerlink" title="具有多输入的梯度下降学习"></a>具有多输入的梯度下降学习</h2><p><strong>神经网络也可以用一个输入做多个预测</strong></p><p>一张图片（28×28）的像素矩阵输入到一维的神经网络中—-》把图片的压成一个1×784的向量，抽出第一行的像素值，再首尾相连，得到一个一维的像素列表（784像素长）</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;什么是机器学习&quot;&gt;&lt;a href=&quot;#什么是机器学习&quot; class=&quot;headerlink&quot; title=&quot;什么是机器学习&quot;&gt;&lt;/a&gt;什么是机器学习&lt;/h2&gt;&lt;p&gt;——-先观察后照做&lt;br&gt; ——-机器学习算法都试图以某种它可以的方式来模拟两个数据之间存在的模式，</summary>
      
    
    
    
    <category term="机器学习，神经网络" scheme="https://xiaoyvlongoing.github.io/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%EF%BC%8C%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/"/>
    
    
    <category term="机器学习，神经网络" scheme="https://xiaoyvlongoing.github.io/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%EF%BC%8C%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>网络编程</title>
    <link href="https://xiaoyvlongoing.github.io/2020/02/10/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8BTC/"/>
    <id>https://xiaoyvlongoing.github.io/2020/02/10/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8BTC/</id>
    <published>2020-02-10T06:47:40.000Z</published>
    <updated>2021-06-10T00:50:38.943Z</updated>
    
    <content type="html"><![CDATA[<h2 id="网络编程TC"><a href="#网络编程TC" class="headerlink" title="网络编程TC"></a>网络编程TC</h2><p>[TOC]</p><h2 id="P客户端"><a href="#P客户端" class="headerlink" title="P客户端"></a>P客户端</h2><table><thead><tr><th align="center">变量名称</th><th>变量使用方法</th></tr></thead><tbody><tr><td align="center">ifconfig</td><td>查看网络的ip</td></tr><tr><td align="center">ping</td><td>查看网络是否连通</td></tr><tr><td align="center">socket</td><td>网络编程包</td></tr><tr><td align="center">socket.AF_INET</td><td>ip地址</td></tr><tr><td align="center">socket.SOCK_STREAM</td><td>端口</td></tr><tr><td align="center">tcp_clien_socket.connect</td><td>客户端：传入ip和端口，用于建立与指定指定socket的连接</td></tr><tr><td align="center">tcp_clien_socket.send（字符串.encode(encoding=”utf-8”)）</td><td>send（）：把数据组转换成二进制，encode：写入编辑的字符串和要转成数据组的函数：encode（encoding = “”）</td></tr><tr><td align="center">字符串.encode(encoding=”utf-8”)）</td><td>encode：把字符串转换成数据组</td></tr><tr><td align="center">tcp_clien_socket.recv(数值)</td><td>套接字最大传入数据数值，接收来自socket缓存区对字节数据，当缓存区没有数值时会一直进行阻塞</td></tr><tr><td align="center">.decode()</td><td>对服务端发来的数据进行解码</td></tr><tr><td align="center">conn_socket.close()</td><td>关闭套接字</td></tr></tbody></table><h2 id="网络编程TCP服务端"><a href="#网络编程TCP服务端" class="headerlink" title="网络编程TCP服务端"></a>网络编程TCP服务端</h2><table><thead><tr><th>变量名称</th><th>变量使用方法</th></tr></thead><tbody><tr><td>socket</td><td>网络编程包</td></tr><tr><td>bind</td><td>服务端：创建ip和端口</td></tr><tr><td>tcp_evens_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, True)</td><td>端口的复用</td></tr><tr><td>tcp_sever_socket.listen（数值）</td><td>设置端口监听功能监听多少个数值上限</td></tr><tr><td>tcp_server_socket.accept()</td><td><code>accept()</code>接受一个客户端的连接请求，接收的数据用于recv，并返回一个新的套接字，用于了send分开数据和ip不同于以上<code>socket()</code>返回的用于监听和接受客户端的连接请求的套接字；，</td></tr></tbody></table><h2 id="扩展函数："><a href="#扩展函数：" class="headerlink" title="扩展函数："></a>扩展函数：</h2><table><thead><tr><th>函数</th><th>函数表达意思</th></tr></thead><tbody><tr><td>client_socket.recv(1024).<strong>decode()</strong></td><td>decode()：将查询的值翻译成其他的值，以其他形式表现出来</td></tr><tr><td><strong>os.listdir</strong></td><td>方法用于返回指定的文件夹包含的文件或文件夹的名字的列表。</td></tr><tr><td><strong>os.path.getsize()</strong></td><td><strong>获得文件的大小（字节）</strong></td></tr><tr><td>f.read（）</td><td>从文件指针所在的位置开始读</td></tr><tr><td>isdigit</td><td></td></tr></tbody></table><pre><code></code></pre><h2 id="静态服务器："><a href="#静态服务器：" class="headerlink" title="静态服务器："></a>静态服务器：</h2><table><thead><tr><th>函数</th><th>函数定义</th></tr></thead><tbody><tr><td>.open（“地址”，“要读或写”）</td><td>用于打开一个文件，创建一个 file 对象，相关的方法才可以调用它进行读写。</td></tr><tr><td>.read()</td><td>读取文件信息内容</td></tr><tr><td>英文：response</td><td>翻译：相应</td></tr><tr><td>英文：Server</td><td>翻译：服务器</td></tr><tr><td>localhost:8080</td><td>浏览器查看</td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h2 id="使用多线程多客户端连接服务器，多发送信息"><a href="#使用多线程多客户端连接服务器，多发送信息" class="headerlink" title="使用多线程多客户端连接服务器，多发送信息"></a>使用多线程多客户端连接服务器，多发送信息</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> socket<span class="token keyword">import</span> threading<span class="token keyword">def</span> <span class="token function">duoe_sock</span><span class="token punctuation">(</span>code_sock<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        recv_data <span class="token operator">=</span> code_sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>        data <span class="token operator">=</span> recv_data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>        code_sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"niaho1"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> data <span class="token operator">==</span> <span class="token string">"quit"</span> <span class="token operator">or</span> <span class="token operator">not</span> data<span class="token punctuation">:</span>            <span class="token keyword">break</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"连接关闭"</span><span class="token punctuation">)</span>    code_sock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    tcp_evelt_socket <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span>socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>    tcp_evelt_socket<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span>socket<span class="token punctuation">.</span>SO_REUSEADDR<span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">)</span>    tcp_evelt_socket<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    tcp_evelt_socket<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        code_sock<span class="token punctuation">,</span>ip_lies <span class="token operator">=</span> tcp_evelt_socket<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ip:"</span><span class="token punctuation">,</span>ip_lies<span class="token punctuation">)</span>        smeus_pskd <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>duoe_sock<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span>code_sock<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        smeus_pskd<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    code_sock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="静态服务器返回固态页面："><a href="#静态服务器返回固态页面：" class="headerlink" title="静态服务器返回固态页面："></a>静态服务器返回固态页面：</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> socket<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    tcp_serer_sock <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span>socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>    tcp_serer_sock<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SO_REUSEADDR<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>    tcp_serer_sock<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    tcp_serer_sock<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">)</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        clien_sock<span class="token punctuation">,</span>client_abbr <span class="token operator">=</span> tcp_serer_sock<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>        clien_request_data <span class="token operator">=</span> clien_sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">10230</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>clien_request_data<span class="token punctuation">)</span>        <span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">"./nksld.html"</span><span class="token punctuation">,</span><span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span><span class="token comment" spellcheck="true">#打开文件夹有会报错，异常处理</span>            <span class="token comment" spellcheck="true"># f = open("当前文件夹","rb")</span>            file_data <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 应答行</span>        response_line <span class="token operator">=</span> <span class="token string">"HTTP/1.1 200 OK\r\n"</span>        <span class="token comment" spellcheck="true"># 头</span>        response_header <span class="token operator">=</span> <span class="token string">"Server:pwd\r\n"</span>        <span class="token comment" spellcheck="true"># 体</span>        response_body <span class="token operator">=</span> file_data<span class="token comment" spellcheck="true">#界面的数据</span>        <span class="token comment" spellcheck="true">#应答数据</span>        response_data<span class="token operator">=</span> <span class="token punctuation">(</span>response_line <span class="token operator">+</span> response_header <span class="token operator">+</span> <span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> response_body        clien_sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span>response_data<span class="token punctuation">)</span>        clien_sock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="静态服务器返回指定页面"><a href="#静态服务器返回指定页面" class="headerlink" title="静态服务器返回指定页面"></a>静态服务器返回指定页面</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> socket<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    tcp_server_sock <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span>socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>    tcp_server_sock<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span>socket<span class="token punctuation">.</span>SO_REUSEADDR<span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">)</span>    tcp_server_sock<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    tcp_server_sock<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        tcp_sock<span class="token punctuation">,</span>ip_sock <span class="token operator">=</span> tcp_server_sock<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ip"</span><span class="token punctuation">,</span>ip_sock<span class="token punctuation">)</span>        recv_data <span class="token operator">=</span> tcp_sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        spli_dat <span class="token operator">=</span> recv_data<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> len<span class="token punctuation">(</span>spli_dat<span class="token punctuation">)</span> <span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">:</span>            tcp_sock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"浏览器关闭"</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            data <span class="token operator">=</span> spli_dat<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>            <span class="token keyword">if</span> data <span class="token operator">==</span> <span class="token string">"/"</span><span class="token punctuation">:</span>                data <span class="token operator">=</span> <span class="token string">"/001.jpg"</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                <span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">"."</span><span class="token operator">+</span> data<span class="token punctuation">,</span><span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>                    f_data <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                tecponse_hine <span class="token operator">=</span> <span class="token string">"HTTP/1.1 404 NG\r\n"</span>                tecponse_toue <span class="token operator">=</span> <span class="token string">"Server : long\r\n"</span>                tecponse_toes <span class="token operator">=</span> <span class="token string">"404 NG\r\n"</span>                tecponse_zhen <span class="token operator">=</span> <span class="token punctuation">(</span>tecponse_hine<span class="token operator">+</span>tecponse_toue<span class="token operator">+</span><span class="token string">"\r\n"</span><span class="token operator">+</span>tecponse_toes<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>                tcp_sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span>tecponse_zhen<span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                tecponse_hine <span class="token operator">=</span> <span class="token string">"HTTP/1.1 200 OK\r\n"</span>                tecponse_toue <span class="token operator">=</span> <span class="token string">"Server : long\r\n"</span>                tecponse_toes <span class="token operator">=</span> f_data                tecponse_zhen <span class="token operator">=</span> <span class="token punctuation">(</span>tecponse_hine  <span class="token operator">+</span> tecponse_toue<span class="token operator">+</span> <span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span> tecponse_toes                tcp_sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span>tecponse_zhen<span class="token punctuation">)</span>            <span class="token keyword">finally</span><span class="token punctuation">:</span>                tcp_sock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="静态服务器多线程任务"><a href="#静态服务器多线程任务" class="headerlink" title="静态服务器多线程任务"></a>静态服务器多线程任务</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> threading<span class="token keyword">import</span> socket<span class="token keyword">def</span> <span class="token function">nuws_sock</span><span class="token punctuation">(</span>tcp_sock<span class="token punctuation">)</span><span class="token punctuation">:</span>    recv_data <span class="token operator">=</span> tcp_sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>    spli_dat <span class="token operator">=</span> recv_data<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> len<span class="token punctuation">(</span>spli_dat<span class="token punctuation">)</span> <span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">:</span>        tcp_sock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"浏览器关闭"</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        data <span class="token operator">=</span> spli_dat<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> data <span class="token operator">==</span> <span class="token string">"/"</span><span class="token punctuation">:</span>            data <span class="token operator">=</span> <span class="token string">"/001.jpg"</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">"."</span><span class="token operator">+</span> data<span class="token punctuation">,</span><span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>                f_data <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            tecponse_hine <span class="token operator">=</span> <span class="token string">"HTTP/1.1 404 NG\r\n"</span>            tecponse_toue <span class="token operator">=</span> <span class="token string">"Server : long\r\n"</span>            tecponse_toes <span class="token operator">=</span> <span class="token string">"404 NG\r\n"</span>            tecponse_zhen <span class="token operator">=</span> <span class="token punctuation">(</span>tecponse_hine<span class="token operator">+</span>tecponse_toue<span class="token operator">+</span><span class="token string">"\r\n"</span><span class="token operator">+</span>tecponse_toes<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>            tcp_sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span>tecponse_zhen<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            tecponse_hine <span class="token operator">=</span> <span class="token string">"HTTP/1.1 200 OK\r\n"</span>            tecponse_toue <span class="token operator">=</span> <span class="token string">"Server : long\r\n"</span>            tecponse_toes <span class="token operator">=</span> f_data            tecponse_zhen <span class="token operator">=</span> <span class="token punctuation">(</span>tecponse_hine  <span class="token operator">+</span> tecponse_toue<span class="token operator">+</span> <span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span> tecponse_toes            tcp_sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span>tecponse_zhen<span class="token punctuation">)</span>        <span class="token keyword">finally</span><span class="token punctuation">:</span>            tcp_sock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    tcp_server_sock <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span>socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>    tcp_server_sock<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span>socket<span class="token punctuation">.</span>SO_REUSEADDR<span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">)</span>    tcp_server_sock<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    tcp_server_sock<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        tcp_sock<span class="token punctuation">,</span>ip_sock <span class="token operator">=</span> tcp_server_sock<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ip"</span><span class="token punctuation">,</span>ip_sock<span class="token punctuation">)</span>        nues_sock <span class="token operator">=</span>  threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>nuws_sock<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span>tcp_sock<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        nues_sock<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="静态服务器对象调用"><a href="#静态服务器对象调用" class="headerlink" title="静态服务器对象调用"></a>静态服务器对象调用</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> threading<span class="token keyword">import</span> socket<span class="token keyword">class</span> <span class="token class-name">Pues_sock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>tcp_server_sock <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>tcp_server_sock<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SO_REUSEADDR<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>tcp_server_sock<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>tcp_server_sock<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">nuws_sock</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>tcp_sock<span class="token punctuation">)</span><span class="token punctuation">:</span>        recv_data <span class="token operator">=</span> tcp_sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        spli_dat <span class="token operator">=</span> recv_data<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> len<span class="token punctuation">(</span>spli_dat<span class="token punctuation">)</span> <span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">:</span>            tcp_sock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"浏览器关闭"</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            data <span class="token operator">=</span> spli_dat<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>            <span class="token keyword">if</span> data <span class="token operator">==</span> <span class="token string">"/"</span><span class="token punctuation">:</span>                data <span class="token operator">=</span> <span class="token string">"/001.jpg"</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                <span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">"."</span><span class="token operator">+</span> data<span class="token punctuation">,</span><span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>                    f_data <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                tecponse_hine <span class="token operator">=</span> <span class="token string">"HTTP/1.1 404 NG\r\n"</span>                tecponse_toue <span class="token operator">=</span> <span class="token string">"Server : long\r\n"</span>                tecponse_toes <span class="token operator">=</span> <span class="token string">"404 NG\r\n"</span>                tecponse_zhen <span class="token operator">=</span> <span class="token punctuation">(</span>tecponse_hine<span class="token operator">+</span>tecponse_toue<span class="token operator">+</span><span class="token string">"\r\n"</span><span class="token operator">+</span>tecponse_toes<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>                tcp_sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span>tecponse_zhen<span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                tecponse_hine <span class="token operator">=</span> <span class="token string">"HTTP/1.1 200 OK\r\n"</span>                tecponse_toue <span class="token operator">=</span> <span class="token string">"Server : long\r\n"</span>                tecponse_toes <span class="token operator">=</span> f_data                tecponse_zhen <span class="token operator">=</span> <span class="token punctuation">(</span>tecponse_hine  <span class="token operator">+</span> tecponse_toue<span class="token operator">+</span> <span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span> tecponse_toes                tcp_sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span>tecponse_zhen<span class="token punctuation">)</span>            <span class="token keyword">finally</span><span class="token punctuation">:</span>                tcp_sock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">nuse_sock</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>            tcp_sock<span class="token punctuation">,</span> ip_sock <span class="token operator">=</span> self<span class="token punctuation">.</span>tcp_server_sock<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ip"</span><span class="token punctuation">,</span> ip_sock<span class="token punctuation">)</span>            nues_sock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>self<span class="token punctuation">.</span>nuws_sock<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>tcp_sock<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            nues_sock<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    nues <span class="token operator">=</span> Pues_sock<span class="token punctuation">(</span><span class="token punctuation">)</span>    nues<span class="token punctuation">.</span>nuse_sock<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="静态服务器变换端口号"><a href="#静态服务器变换端口号" class="headerlink" title="静态服务器变换端口号"></a>静态服务器变换端口号</h2><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> socket<span class="token keyword">import</span> threading<span class="token keyword">import</span> sys<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 获取执行python程序的终端命令行参数</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>    <span class="token keyword">if</span> len<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"格式错误 python3 xxx.py 9090"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span>    <span class="token comment" spellcheck="true"># 判断参数的类型，设置端口号必须是整型</span>    <span class="token keyword">if</span> <span class="token operator">not</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"格式错误 python3 xxx.py 9090"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span>    port <span class="token operator">=</span> int<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 创建服务器对象</span>    <span class="token comment" spellcheck="true"># 给Web服务器类的初始化方法添加一个端口号参数，用于绑定端口号</span>    my_web_server <span class="token operator">=</span> HttpWebServer<span class="token punctuation">(</span>port<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 启动服务器</span>    my_web_server<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="TCP协议是什么？提示：TCP定义及特点"><a href="#TCP协议是什么？提示：TCP定义及特点" class="headerlink" title="TCP协议是什么？提示：TCP定义及特点"></a>TCP协议是什么？提示：TCP定义及特点</h2><h4 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h4><p>传输控制协议，是一种面向连接，可靠的，基于字节流的传输层通讯协议</p><h5 id="特点："><a href="#特点：" class="headerlink" title="特点："></a>特点：</h5><p>面向连接：通信双方必须先建立好连接才能进行数据的传输，数据传输完成后，双方必须断开连接，以释放系统资源</p><p>可靠的通信方式</p><p>基于字节流</p><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="2-TCP特点是什么？"><a href="#2-TCP特点是什么？" class="headerlink" title="2. TCP特点是什么？"></a>2. TCP特点是什么？</h2><p>提示：TCP特点及解释说明</p><p>基于字节流的</p><p>面向连接</p><p>可靠通信</p><p>在网络状况不佳的时候尽量降低系统由于重传带来的宽开销</p><p>通信连接维护是面向通信的两个端点，而不考虑中间网段和节点</p><h2 id="-1"><a href="#-1" class="headerlink" title=""></a></h2><h2 id="3-在TCP客户端使用connect的作用是什么？"><a href="#3-在TCP客户端使用connect的作用是什么？" class="headerlink" title="3. 在TCP客户端使用connect的作用是什么？"></a>3. 在TCP客户端使用connect的作用是什么？</h2><p>提示：connect的作用及connect()函数的参数形式</p><p>connenct：用于建立与指定指定socket的连接，对于流类套接口（SOCK—STREAMl类型），利用名字来与一个远程主机建立连接，一但套用接口调用成功，他就能收发数据，对于数据报类套接口（SOCK—STREAMl类型），则设置成一个缺省的目的并用它来进行后序的send与recv调用</p><h3 id="4-在TCP服务器中listen的作用是什么？"><a href="#4-在TCP服务器中listen的作用是什么？" class="headerlink" title="4. 在TCP服务器中listen的作用是什么？"></a>4. 在TCP服务器中listen的作用是什么？</h3><p>提示：listen()函数的作用及参数含义、</p><p>在网络中服务端是被动的，客户是主动的，被动要用listen来监听，listen（）作用是将socket（）得到一个sockfd被动监听的套接字，来通知内核来完成连接</p><h2 id="-2"><a href="#-2" class="headerlink" title=""></a></h2><h2 id="5-简述tcp客户端创建的流程。"><a href="#5-简述tcp客户端创建的流程。" class="headerlink" title="5. 简述tcp客户端创建的流程。"></a>5. 简述tcp客户端创建的流程。</h2><p>提示：参考课件代码说出客户端创建步骤</p><p>创建一个套接字协议用：connenct赖建立连接</p><p>导入IP地址可端口</p><p>创建发送的数据用send（数据encode），先把字符串转换成数据组，在把数据组装换成二进制</p><p>设置最大字节数据：recv（）</p><p>接收客户端发来的数据用decode来解码</p><p>关闭套接字用close</p><h2 id="-3"><a href="#-3" class="headerlink" title=""></a></h2><h2 id="6-recv函数的参数表示什么含义？"><a href="#6-recv函数的参数表示什么含义？" class="headerlink" title="6. recv函数的参数表示什么含义？"></a>6. recv函数的参数表示什么含义？</h2><p>提示：recv()函数的作用及参数含义</p><p>接收来自socket缓存区对字节数据，当缓存区没有数值时会一直进行阻塞，直到有数据时进行读取，远程关闭并读取所有数据之后会返回空字符串</p><h2 id="7-简述TCP服务器创建的流程、"><a href="#7-简述TCP服务器创建的流程、" class="headerlink" title="7. 简述TCP服务器创建的流程、"></a>7. 简述TCP服务器创建的流程、</h2><p>提示：参考课件代码，说出服务器创建流程</p><p>1：创建套接字，进行网络协议</p><p>2：进行端口复用</p><p>3：进行bind进行套接字协议</p><p>4：进行与服务端监听连接的最大数值，listen</p><p>5：accept（）接收数据再返回一个新的socket字，接收的数据用于recv，返回客户端的数据用于了send分开数据和ip，</p><p>6：进行设置recv进行数据的阻塞，</p><p>7：给客户端发送一个数据用send（encode）来转成二进制</p><p>8：接收客户端发来的数据，用decode来进行解码</p><h2 id="8-accept的返回值分别代表的什么？"><a href="#8-accept的返回值分别代表的什么？" class="headerlink" title="8. accept的返回值分别代表的什么？"></a>8. accept的返回值分别代表的什么？</h2><p>提示：accept()函数的作用，及返回值的形式和返回值的含义</p><p>accept（）接收数据再返回一个新的socket字，接收的数据用于recv，返回客户端的数据用于了send分开数据和ip，</p><h2 id="9-完成TCP客户端的编写。"><a href="#9-完成TCP客户端的编写。" class="headerlink" title="9. 完成TCP客户端的编写。"></a>9. 完成TCP客户端的编写。</h2><p>服务器的ip和端口号需手动输入</p><p>要发送的信息需要手动输入</p><p>接收服务器返回的数据，并打印。</p><p>请在下方的注释下补充代码：</p><p>​       # 导入socket模块</p><pre><code>import socketif __name__ == &#39;__main__&#39;:    tcp_codne_socket = socket.socket(socket.AF_INET,socket.SOCK_STREAM)    tcp_codne_socket.connect((&quot;&quot;,8080))    tcp_codne_socket.send(&quot;&quot;.encode())    cone_recv = tcp_codne_socket.recv(1024)    print(cone_recv.decode())    tcp_codne_socket.close()</code></pre><h2 id="-4"><a href="#-4" class="headerlink" title=""></a></h2><h2 id="10-完成TCP服务的的编写"><a href="#10-完成TCP服务的的编写" class="headerlink" title="10. 完成TCP服务的的编写"></a>10. 完成TCP服务的的编写</h2><p>请在下方注释下补充代码：</p><p>  # 导入socket模块</p><pre><code>import socketif __name__ == &#39;__main__&#39;:    tcp_evens_socket = socket.socket(socket.AF_INET,socket.SOCK_STREAM)    tcp_evens_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, True)    tcp_evens_socket.bind((&quot;&quot;,8080))    tcp_evens_socket.listen(138)    coet_socket,ip_mes = tcp_evens_socket.accept()    recv_data = coet_socket.recv(1025)    print(recv_data.decode())    coet_socket.send(&quot;&quot;.encode())    coet_socket.close()</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;网络编程TC&quot;&gt;&lt;a href=&quot;#网络编程TC&quot; class=&quot;headerlink&quot; title=&quot;网络编程TC&quot;&gt;&lt;/a&gt;网络编程TC&lt;/h2&gt;&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h2 id=&quot;P客户端&quot;&gt;&lt;a href=&quot;#P客户端&quot; class=&quot;headerl</summary>
      
    
    
    
    <category term="python高级" scheme="https://xiaoyvlongoing.github.io/categories/python%E9%AB%98%E7%BA%A7/"/>
    
    
    <category term="python高级" scheme="https://xiaoyvlongoing.github.io/tags/python%E9%AB%98%E7%BA%A7/"/>
    
  </entry>
  
  <entry>
    <title>文本摘要项目</title>
    <link href="https://xiaoyvlongoing.github.io/2020/02/10/%E6%96%87%E6%9C%AC%E6%91%98%E8%A6%81%E9%A1%B9%E7%9B%AE/"/>
    <id>https://xiaoyvlongoing.github.io/2020/02/10/%E6%96%87%E6%9C%AC%E6%91%98%E8%A6%81%E9%A1%B9%E7%9B%AE/</id>
    <published>2020-02-10T06:47:40.000Z</published>
    <updated>2021-06-27T16:50:46.131Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1：文本摘要项目理论"><a href="#1：文本摘要项目理论" class="headerlink" title="1：文本摘要项目理论"></a><strong>1：文本摘要项目理论</strong></h2><h4 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h4><p><strong>文本摘要思想</strong>：就是一个长文本把重要的摘要出来</p><h5 id="1：NLP角度来看文本摘要任务，主流的概括两大方法："><a href="#1：NLP角度来看文本摘要任务，主流的概括两大方法：" class="headerlink" title="1：NLP角度来看文本摘要任务，主流的概括两大方法："></a>1：NLP角度来看文本摘要任务，主流的概括两大方法：</h5><ul><li><p>抽取式摘要：Extraction-based（从文本中抽取）：直接从原文中选择若干条重要的句子, 并对它们进行排序和重组, 以形成摘要的方法.</p><ul><li><strong>无监督抽取</strong>：不需要平行语料, 节省了人工标记的成本. 大体上有如下几种:<ul><li>Lead</li><li>Centroid</li><li>ClusterCMRW</li><li>TextRank：最经典</li></ul></li><li><strong>有监督抽取：</strong>将文本摘要抽象成二分类问题, 通过神经网络来学习句子及其标签之间的对应关系. 需要平行语料, 需要人工标记的成本. 常见方法有如下几种<ul><li>R2N2</li><li>NeuralSum</li><li>SummaRuNNer</li><li><strong>BertSum</strong>：原本用来计算网页之间的关联性，后来被应用在句子上，句子之间反复传播，选出最关键的语句进行排序。因为文章总有中心句，而textrank就试图找出这个中心句。</li></ul></li><li>取式<strong>缺点</strong>：主要考虑单词词频，没有过多的语义信息，所以无法建立段落中的完整语义信息</li></ul></li><li><p><strong>生成式摘要: Abstraction-based：</strong>需要通过<strong>转述、同义替换、句子缩写</strong>等生成。</p><ul><li>生成式神经网络模型的基本结构主要由<strong>编码器（encoder）和解码器（decoder）</strong>组成，编码和解码都由神经网络实现。<ul><li><strong>编码器</strong>负责将输入的原文本编码成一个<strong>向量C（context），</strong></li><li><strong>而解码器</strong>负责从这个<strong>向量C</strong>提取<strong>重要信息、加工剪辑，生成文本摘要。</strong></li><li><strong>Sequence-to-Sequence</strong>（以下简称Seq2Seq），被广泛应用于存在输入序列和输出序列的场景，比如机器翻译（一种语言序列到另一种语言序列）、image captioning（图片像素序列到语言序列）、对话机器人（如问题到回答）等</li></ul></li></ul></li></ul><h4 id="2：数据的处理："><a href="#2：数据的处理：" class="headerlink" title="2：数据的处理："></a>2：数据的处理：</h4><p>一般来说, 在任何项目中, 面对原始数据都要进行接下来的几点工作:</p><ul><li>删除空值.</li><li>删除”脏”数据.<ul><li>在这个数据集中的脏数据为：<ul><li>有很多的技师说和，车主说</li><li>文本中有很多的图片字样和语音字样</li><li>有很多进口，车型，还有一些符号</li></ul></li></ul></li><li>删除特定字符的集合.</li><li>分词.</li><li>完成字符到id的映射.</li><li>完成padding, cutting的工作.</li></ul><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pdtrain_path <span class="token operator">=</span> <span class="token string">'train.csv'</span>test_path <span class="token operator">=</span> <span class="token string">'test.csv'</span>df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>train_path<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>df<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'**********************'</span><span class="token punctuation">)</span>df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>test_path<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>df<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h4 id="打印："><a href="#打印：" class="headerlink" title="打印："></a>打印：</h4><pre class=" language-python"><code class="language-python"><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'pandas.core.frame.DataFrame'</span><span class="token operator">></span>RangeIndex<span class="token punctuation">:</span> <span class="token number">82943</span> entries<span class="token punctuation">,</span> <span class="token number">0</span> to <span class="token number">82942</span>Data columns <span class="token punctuation">(</span>total <span class="token number">6</span> columns<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">#   Column    Non-Null Count  Dtype </span> <span class="token number">0</span>   QID       <span class="token number">82943</span> non<span class="token operator">-</span>null  object <span class="token number">1</span>   Brand     <span class="token number">81642</span> non<span class="token operator">-</span>null  object <span class="token number">2</span>   Model     <span class="token number">81642</span> non<span class="token operator">-</span>null  object <span class="token number">3</span>   Question  <span class="token number">82943</span> non<span class="token operator">-</span>null  object <span class="token number">4</span>   Dialogue  <span class="token number">82941</span> non<span class="token operator">-</span>null  object <span class="token number">5</span>   Report    <span class="token number">82873</span> non<span class="token operator">-</span>null  objectdtypes<span class="token punctuation">:</span> object<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>memory usage<span class="token punctuation">:</span> <span class="token number">3.8</span><span class="token operator">+</span> MB<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'pandas.core.frame.DataFrame'</span><span class="token operator">></span>RangeIndex<span class="token punctuation">:</span> <span class="token number">20000</span> entries<span class="token punctuation">,</span> <span class="token number">0</span> to <span class="token number">19999</span>Data columns <span class="token punctuation">(</span>total <span class="token number">5</span> columns<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">#   Column    Non-Null Count  Dtype </span> <span class="token number">0</span>   QID       <span class="token number">20000</span> non<span class="token operator">-</span>null  object <span class="token number">1</span>   Brand     <span class="token number">19987</span> non<span class="token operator">-</span>null  object <span class="token number">2</span>   Model     <span class="token number">19987</span> non<span class="token operator">-</span>null  object <span class="token number">3</span>   Question  <span class="token number">20000</span> non<span class="token operator">-</span>null  object <span class="token number">4</span>   Dialogue  <span class="token number">20000</span> non<span class="token operator">-</span>null  objectdtypes<span class="token punctuation">:</span> object<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>memory usage<span class="token punctuation">:</span> <span class="token number">781.4</span><span class="token operator">+</span> KB</code></pre><h4 id="3：TextRank：算法理论基础"><a href="#3：TextRank：算法理论基础" class="headerlink" title="3：TextRank：算法理论基础"></a>3：TextRank：算法理论基础</h4><p>对比于衡量网页重要性的PageRank算法, TextRank算法用于衡量哪些单词是关键词, 类比之下的算法思想也就很好理解了:</p><ul><li>如果一个单词出现在很多单词的后面, 就是它和很多单词有关联, 那么说明这个单词比较重要.</li><li>如果一个TextRank值很高的单词后面跟着另一个单词, 那么后面这个单词的TextRank值也会相应的被提高.</li></ul><h4 id="3-1：TextRank算法代码实践"><a href="#3-1：TextRank算法代码实践" class="headerlink" title="3.1：TextRank算法代码实践"></a>3.1：TextRank算法代码实践</h4><ul><li>在本小节中, 我们仅以示例代码跑通几段小程序, 让同学们掌握如何具体在代码层面用TextRank.<ul><li>关键词抽取(keyword extraction)：是指从文本中确定一些能够描述文档含义的关键术语的过程<ul><li>对关键词抽取而言, 用于构建顶点集的文本单元可以使句子中的一个或多个字. 根据这些字之间的关系构建边.</li><li>根据任务的需要, 可以使用语法过滤器(syntactic filters)对顶点集进行优化. 语法过滤器的主要作用是将某一类或者某几类词性的字过滤出来作为顶点集.</li></ul></li><li>关键短语抽取(keyphrase extraction)</li><li>关键句抽取(sentence extraction)</li></ul></li></ul><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># coding=utf-8</span><span class="token comment" spellcheck="true"># 导入textrank4zh的相关工具包</span><span class="token keyword">from</span> textrank4zh <span class="token keyword">import</span> TextRank4Keyword<span class="token punctuation">,</span> TextRank4Sentence<span class="token keyword">import</span> os<span class="token keyword">import</span> sys<span class="token comment" spellcheck="true"># 导入常用工具包</span><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token comment" spellcheck="true">#关键词抽取</span><span class="token keyword">def</span> <span class="token function">keywords_extraction</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># allow_speech_tags : 词性列表, 用于过滤某些词性的词</span>    tr4w <span class="token operator">=</span> TextRank4Keyword<span class="token punctuation">(</span>allow_speech_tags<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'n'</span><span class="token punctuation">,</span> <span class="token string">'nr'</span><span class="token punctuation">,</span> <span class="token string">'nrfg'</span><span class="token punctuation">,</span> <span class="token string">'ns'</span><span class="token punctuation">,</span> <span class="token string">'nt'</span><span class="token punctuation">,</span> <span class="token string">'nz'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># text: 文本内容, 字符串</span>    <span class="token comment" spellcheck="true"># window: 窗口大小, int, 用来构造单词之间的边, 默认值为2</span>    <span class="token comment" spellcheck="true"># lower: 是否将英文文本转换为小写, 默认值为False</span>    <span class="token comment" spellcheck="true"># vertex_source: 选择使用words_no_filter, words_no_stop_words, words_all_filters中的>哪一个来构造pagerank对应的图中的节点</span>    <span class="token comment" spellcheck="true">#默认值为'all_filters', 可选值为'no_filter', 'no_stop_words', 'all_filters'</span>    <span class="token comment" spellcheck="true"># edge_source: 选择使用words_no_filter, words_no_stop_words, words_all_filters中的哪>一个来构造pagerank对应的图中的节点之间的边</span>    <span class="token comment" spellcheck="true">#默认值为'no_stop_words', 可选值为'no_filter', 'no_stop_words', 'all_filters', 边的构造要结合window参数</span>    <span class="token comment" spellcheck="true"># pagerank_config: pagerank算法参数配置, 阻尼系数为0.85</span>    tr4w<span class="token punctuation">.</span>analyze<span class="token punctuation">(</span>text<span class="token operator">=</span>text<span class="token punctuation">,</span> window<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> lower<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> vertex_source<span class="token operator">=</span><span class="token string">'all_filters'</span><span class="token punctuation">,</span>                 edge_source<span class="token operator">=</span><span class="token string">'no_stop_words'</span><span class="token punctuation">,</span> pagerank_config<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'alpha': 0.85, &amp;#125;)</span>    <span class="token comment" spellcheck="true"># num: 返回关键词数量</span>    <span class="token comment" spellcheck="true"># word_min_len: 词的最小长度, 默认值为1    </span>    keywords <span class="token operator">=</span> tr4w<span class="token punctuation">.</span>get_keywords<span class="token punctuation">(</span>num<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> word_min_len<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>         <span class="token comment" spellcheck="true">#提取重要关键短句</span>    <span class="token comment" spellcheck="true"># keywords_num: 抽取的关键词数量</span>    <span class="token comment" spellcheck="true"># min_occur_num: 关键短语在文中的最少出现次数</span>    <span class="token comment" spellcheck="true">#keyphrases = tr4w.get_keyphrases(keywords_num=6, min_occur_num=1)</span>        <span class="token comment" spellcheck="true">#提取关键句</span>    <span class="token comment" spellcheck="true">#tr4s = TextRank4Sentence()</span>        <span class="token comment" spellcheck="true"># text: 文本内容, 字符串</span>    <span class="token comment" spellcheck="true"># lower: 是否将英文文本转换为小写, 默认值为False</span>    <span class="token comment" spellcheck="true"># source: 选择使用words_no_filter, words_no_stop_words, words_all_filters中的哪一个来                生成句子之间的相似度</span>    <span class="token comment" spellcheck="true">#默认值为'all_filters', 可选值为'no_filter', 'no_stop_words', 'all_filters'</span>    <span class="token comment" spellcheck="true">#tr4s.analyze(text, lower=True, source='all_filters')</span>    <span class="token comment" spellcheck="true"># 获取最重要的num个长度大于等于sentence_min_len的句子用来生成摘要</span>    <span class="token comment" spellcheck="true">#keysentences = tr4s.get_key_sentences(num=3, sentence_min_len=6)</span>                <span class="token comment" spellcheck="true"># 返回关键词</span>    <span class="token keyword">return</span> keywords<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    text <span class="token operator">=</span> <span class="token string">"来源：中国科学报本报讯（记者肖洁）又有一位中国科学家喜获小行星命名殊荣！4月19日下午，中国科学院国家天文台在京举行“周又元星”颁授仪式，"</span> \           <span class="token string">"我国天文学家、中国科学院院士周又元的弟子与后辈在欢声笑语中济济一堂。国家天文台党委书记、"</span> \           <span class="token string">"副台长赵刚在致辞一开始更是送上白居易的诗句：“令公桃李满天下，何须堂前更种花。”"</span> \           <span class="token string">"据介绍，这颗小行星由国家天文台施密特CCD小行星项目组于1997年9月26日发现于兴隆观测站，"</span> \           <span class="token string">"获得国际永久编号第120730号。2018年9月25日，经国家天文台申报，"</span> \           <span class="token string">"国际天文学联合会小天体联合会小天体命名委员会批准，国际天文学联合会《小行星通报》通知国际社会，"</span> \           <span class="token string">"正式将该小行星命名为“周又元星”。"</span>    <span class="token comment" spellcheck="true">#关键词抽取</span>    keywords<span class="token operator">=</span>keywords_extraction<span class="token punctuation">(</span>text<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>keywords<span class="token punctuation">)</span></code></pre><h5 id="打印：-1"><a href="#打印：-1" class="headerlink" title="打印："></a>打印：</h5><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#关键词抽取</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'word': '小行星', 'weight': 0.05808441467341854&amp;#125;,</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'word': '天文台', 'weight': 0.05721653775742513&amp;#125;, </span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'word': '命名', 'weight': 0.0485177005159723&amp;#125;,</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'word': '中国', 'weight': 0.045716478124251815&amp;#125;, </span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'word': '中国科学院', 'weight': 0.037818937836996636&amp;#125;, </span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'word': '国家', 'weight': 0.03438059254484016&amp;#125;]</span><span class="token comment" spellcheck="true">#提取重要关键短句</span><span class="token punctuation">[</span><span class="token string">'小行星命名'</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#提取关键句</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'index': 4, 'sentence': '2018年9月25日，经国家天文台申报，国际天文学联合会小天体联合会小天体命名委员会批准，国际天文学联合会《小行星通报》通知国际社会，正式将该小行星命名为“周又元星”', 'weight': 0.2281040325096452&amp;#125;,</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'index': 3, 'sentence': '”据介绍，这颗小行星由国家天文台施密特CCD小行星项目组于1997年9月26日发现于兴隆观测站，获得国际永久编号第120730号', 'weight': 0.2106246105971721&amp;#125;,</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'index': 1, 'sentence': '4月19日下午，中国科学院国家天文台在京举行“周又元星”颁授仪式，我国天文学家、中国科学院院士周又元的弟子与后辈在欢声笑语中济济一堂', 'weight': 0.2020923401661083&amp;#125;]</span></code></pre><h4 id="3-2：基于jieba的TextRank算法"><a href="#3-2：基于jieba的TextRank算法" class="headerlink" title="3.2：基于jieba的TextRank算法"></a>3.2：基于jieba的TextRank算法</h4><ul><li>jieba工具不仅仅可以用来分词, 进行词性分析. 也可以用来完成TextRank.</li></ul><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> jieba<span class="token punctuation">.</span>analyse<span class="token keyword">def</span> <span class="token function">jieba_keywords_textrank</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>    keywords <span class="token operator">=</span> jieba<span class="token punctuation">.</span>analyse<span class="token punctuation">.</span>textrank<span class="token punctuation">(</span>text<span class="token punctuation">,</span> topK<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> keywords<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    text <span class="token operator">=</span> <span class="token string">"来源：中国科学报本报讯（记者肖洁）又有一位中国科学家喜获小行星命名殊荣！4月19日下午，中国科学院国家天文台在京举行“周又元星”颁授仪式，"</span> \           <span class="token string">"我国天文学家、中国科学院院士周又元的弟子与后辈在欢声笑语中济济一堂。国家天文台党委书记、"</span> \           <span class="token string">"副台长赵刚在致辞一开始更是送上白居易的诗句：“令公桃李满天下，何须堂前更种花。”"</span> \           <span class="token string">"据介绍，这颗小行星由国家天文台施密特CCD小行星项目组于1997年9月26日发现于兴隆观测站，"</span> \           <span class="token string">"获得国际永久编号第120730号。2018年9月25日，经国家天文台申报，"</span> \           <span class="token string">"国际天文学联合会小天体联合会小天体命名委员会批准，国际天文学联合会《小行星通报》通知国际社会，"</span> \           <span class="token string">"正式将该小行星命名为“周又元星”。"</span>    <span class="token comment" spellcheck="true"># 基于jieba的textrank算法实现</span>    keywords <span class="token operator">=</span> jieba_keywords_textrank<span class="token punctuation">(</span>text<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>keywords<span class="token punctuation">)</span></code></pre><ul><li><h6 id="输出结果"><a href="#输出结果" class="headerlink" title="输出结果:"></a>输出结果:</h6></li></ul><pre class=" language-python"><code class="language-python"><span class="token punctuation">[</span><span class="token string">'小行星'</span><span class="token punctuation">,</span> <span class="token string">'命名'</span><span class="token punctuation">,</span> <span class="token string">'国际'</span><span class="token punctuation">,</span> <span class="token string">'中国'</span><span class="token punctuation">,</span> <span class="token string">'国家'</span><span class="token punctuation">,</span> <span class="token string">'天文学家'</span><span class="token punctuation">]</span></code></pre><h2 id="2：-TextRank实现baseline-0模型"><a href="#2：-TextRank实现baseline-0模型" class="headerlink" title="2： TextRank实现baseline-0模型"></a><strong>2： TextRank实现baseline-0模型</strong></h2><h4 id="数据预处理："><a href="#数据预处理：" class="headerlink" title="数据预处理："></a>数据预处理：</h4><ul><li><p>我们在第一章的1.2小节曾经讨论过原始数据存在的各种问题, 这些问题都需要在数据预处理的这个环节一一解决. 接下来按照如下步骤进行处理:</p><ul><li><p>第一步: 提取特定的文本.</p></li><li><p>第二步: 删除”脏”数据.</p></li><li><p>第三步: 删除特定的字符集合.</p></li><li><p>第四步: 删除特殊位置的特定字符.</p></li></ul></li></ul><h4 id="第一步-提取特定的文本"><a href="#第一步-提取特定的文本" class="headerlink" title="第一步: 提取特定的文本."></a>第一步: 提取特定的文本.</h4><p>面对原始语料, 并不是说我们必须要全部纳入模型中, 可以根据业务需求, 或者程序员的项目经验, 或许出于尝试的态度, 只选取一部分出来作为我们后续模型的输入数据.</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">clean_sentence</span><span class="token punctuation">(</span>sentence<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 1. 将sentence按照'|'分句，并只提取技师的话</span>    sub_jishi <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 按照'|'字符将车主和用户的对话分离</span>    sub <span class="token operator">=</span> sentence<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 遍历每个子句</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 如果不是以句号结尾, 增加一个句号</span>        <span class="token keyword">if</span> <span class="token operator">not</span> sub<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'。'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            sub<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token string">'。'</span>        <span class="token comment" spellcheck="true"># 只使用技师说的句子</span>        <span class="token keyword">if</span> sub<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'技师'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            sub_jishi<span class="token punctuation">.</span>append<span class="token punctuation">(</span>sub<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 拼接成字符串并返回</span>    sentence <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>sub_jishi<span class="token punctuation">)</span>    <span class="token keyword">return</span> sentence<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 读取数据, 并指定编码格式为'utf-8'</span>    df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'train.csv'</span><span class="token punctuation">,</span> engine<span class="token operator">=</span><span class="token string">'python'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    texts <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'Dialogue'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'预处理前的第一条句子：'</span><span class="token punctuation">,</span> texts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'********************************'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 数据预处理</span>    res <span class="token operator">=</span> clean_sentence<span class="token punctuation">(</span>texts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'预处理后的第一条句子: '</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span></code></pre><ul><li><h6 id="输出结果-1"><a href="#输出结果-1" class="headerlink" title="输出结果:"></a>输出结果:</h6></li></ul><pre class=" language-python"><code class="language-python">预处理前的第一条句子： 技师说：<span class="token punctuation">[</span>语音<span class="token punctuation">]</span><span class="token operator">|</span>车主说：新的都换了<span class="token operator">|</span>车主说：助力泵，方向机<span class="token operator">|</span>技师说：<span class="token punctuation">[</span>语音<span class="token punctuation">]</span><span class="token operator">|</span>车主说：换了方向机带的有<span class="token operator">|</span>车主说：<span class="token punctuation">[</span>图片<span class="token punctuation">]</span><span class="token operator">|</span>技师说：<span class="token punctuation">[</span>语音<span class="token punctuation">]</span><span class="token operator">|</span>车主说：有助力就是重，这车要匹配吧<span class="token operator">|</span>技师说：不需要<span class="token operator">|</span>技师说：你这是更换的部件有问题<span class="token operator">|</span>车主说：跑快了还好点，就倒车重的很。<span class="token operator">|</span>技师说：是非常重吗<span class="token operator">|</span>车主说：是的，累人<span class="token operator">|</span>技师说：<span class="token punctuation">[</span>语音<span class="token punctuation">]</span><span class="token operator">|</span>车主说：我觉得也是，可是车主是以前没这么重，选吧助理泵换了不行，又把放向机换了，现在还这样就不知道咋和车主解释。<span class="token operator">|</span>技师说：<span class="token punctuation">[</span>语音<span class="token punctuation">]</span><span class="token operator">|</span>技师说：<span class="token punctuation">[</span>语音<span class="token punctuation">]</span>预处理后的第一条句子<span class="token punctuation">:</span>  技师说：<span class="token punctuation">[</span>语音<span class="token punctuation">]</span>。技师说：<span class="token punctuation">[</span>语音<span class="token punctuation">]</span>。技师说：<span class="token punctuation">[</span>语音<span class="token punctuation">]</span>。技师说：不需要。技师说：你这是更换的部件有问题。技师说：是非常重吗。技师说：<span class="token punctuation">[</span>语音<span class="token punctuation">]</span>。技师说：<span class="token punctuation">[</span>语音<span class="token punctuation">]</span>。技师说：<span class="token punctuation">[</span>语音<span class="token punctuation">]</span>。</code></pre><ul><li><h5 id="数据进行分割形成小型数据"><a href="#数据进行分割形成小型数据" class="headerlink" title="数据进行分割形成小型数据"></a>数据进行分割形成小型数据</h5></li></ul><pre class=" language-python"><code class="language-python">nf <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5000</span><span class="token punctuation">]</span>nf<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">"dev.csv"</span><span class="token punctuation">,</span>mode<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">)</span>dfa  <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"dev.csv"</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>dfa<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>打印结果</p><h4 id="第二步-删除”脏”数据"><a href="#第二步-删除”脏”数据" class="headerlink" title="第二步: 删除”脏”数据."></a>第二步: 删除”脏”数据.</h4><ul><li>关于什么是”脏”数据是个千人千面的问题, 我们在第一章中也讨论过. 这一步也仅仅处理一个baseline的级别.</li></ul><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 导入正则表达式工具包, 用来删除特定模式的数据</span><span class="token keyword">import</span> re<span class="token keyword">def</span> <span class="token function">clean_sentence</span><span class="token punctuation">(</span>sentence<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 1. 将sentence按照'|'分句，并只提取技师的话</span>    sub_jishi <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 按照'|'字符将车主和用户的对话分离</span>    sub <span class="token operator">=</span> sentence<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 遍历每个子句</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 如果不是以句号结尾, 增加一个句号</span>        <span class="token keyword">if</span> <span class="token operator">not</span> sub<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'。'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            sub<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token string">'。'</span>        <span class="token comment" spellcheck="true"># 只使用技师说的句子</span>        <span class="token keyword">if</span> sub<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'技师'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            sub_jishi<span class="token punctuation">.</span>append<span class="token punctuation">(</span>sub<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 拼接成字符串并返回</span>    sentence <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>sub_jishi<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 第二步中添加的两个处理, 利用正则表达式re工具</span>    <span class="token comment" spellcheck="true"># 2. 删除1. 2. 3. 这些标题</span>    r <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span><span class="token string">"\D(\d\.)\D"</span><span class="token punctuation">)</span>    sentence <span class="token operator">=</span> r<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> sentence<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 3. 删除一些无关紧要的词以及语气助词</span>    r <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">"车主说|技师说|语音|图片|呢|吧|哈|啊|啦"</span><span class="token punctuation">)</span>    sentence <span class="token operator">=</span> r<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> sentence<span class="token punctuation">)</span>    <span class="token keyword">return</span> sentence<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 读取数据, 并指定编码格式为'utf-8'</span>    df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'dev.csv'</span><span class="token punctuation">,</span> engine<span class="token operator">=</span><span class="token string">'python'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    texts <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'Dialogue'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'预处理前的第一条句子：'</span><span class="token punctuation">,</span> texts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'********************************'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 数据预处理</span>    res <span class="token operator">=</span> clean_sentence<span class="token punctuation">(</span>texts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'预处理后的第一条句子: '</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span></code></pre><ul><li><h5 id="处理后的数据"><a href="#处理后的数据" class="headerlink" title="处理后的数据"></a>处理后的数据</h5></li></ul><pre><code>预处理前的第一条句子： 技师说：[语音]|车主说：新的都换了|车主说：助力泵，方向机|技师说：[语音]|车主说：换了方向机带的有|车主说：[图片]|技师说：[语音]|车主说：有助力就是重，这车要匹配吧|技师说：不需要|技师说：你这是更换的部件有问题|车主说：跑快了还好点，就倒车重的很。|技师说：是非常重吗|车主说：是的，累人|技师说：[语音]|车主说：我觉得也是，可是车主是以前没这么重，选吧助理泵换了不行，又把放向机换了，现在还这样就不知道咋和车主解释。|技师说：[语音]|技师说：[语音]预处理后的第一条句子:  ：[]。：[]。：[]。：不需要。：你这是更换的部件有问题。：是非常重吗。：[]。：[]。：[]</code></pre><h4 id="第三步-删除特定的字符集合"><a href="#第三步-删除特定的字符集合" class="headerlink" title="第三步: 删除特定的字符集合."></a>第三步: 删除特定的字符集合.</h4><ul><li>1: 我们发现原始数据文件中有若干的”进口”, “海外”字样, 可认为是需要删除的特定字符.</li><li>2: 为了后续处理文本容易, 除了汉字还有数字, 英文字母, 特定的几个标点符号, 其他都删除.</li><li>3: 将标点符号的半角格式, 转变成全角格式.</li><li>4: 将问号, 感叹号, 转变成句号.</li></ul><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 导入正则表达式工具包, 用来删除特定模式的数据</span><span class="token keyword">import</span> re<span class="token keyword">def</span> <span class="token function">clean_sentence</span><span class="token punctuation">(</span>sentence<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 第一步要处理的代码</span>    <span class="token comment" spellcheck="true"># 1. 将sentence按照'|'分句，并只提取技师的话</span>    sub_jishi <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 按照'|'字符将车主和用户的对话分离</span>    sub <span class="token operator">=</span> sentence<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 遍历每个子句</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 如果不是以句号结尾, 增加一个句号</span>        <span class="token keyword">if</span> <span class="token operator">not</span> sub<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'。'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            sub<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token string">'。'</span>        <span class="token comment" spellcheck="true"># 只使用技师说的句子</span>        <span class="token keyword">if</span> sub<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'技师'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            sub_jishi<span class="token punctuation">.</span>append<span class="token punctuation">(</span>sub<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 拼接成字符串并返回</span>    sentence <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>sub_jishi<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 第二步中添加的两个处理, 利用正则表达式re工具</span>    <span class="token comment" spellcheck="true"># 2. 删除1. 2. 3. 这些标题</span>    r <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span><span class="token string">"\D(\d\.)\D"</span><span class="token punctuation">)</span>    sentence <span class="token operator">=</span> r<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> sentence<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 3. 删除一些无关紧要的词以及语气助词</span>    r <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">"车主说|技师说|语音|图片|呢|吧|哈|啊|啦"</span><span class="token punctuation">)</span>    sentence <span class="token operator">=</span> r<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> sentence<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 第三步中添加的4个处理</span>    <span class="token comment" spellcheck="true"># 4. 删除带括号的 进口 海外</span>    r <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">"[(（]进口[)）]|\(海外\)"</span><span class="token punctuation">)</span>    sentence <span class="token operator">=</span> r<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> sentence<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 5. 删除除了汉字数字字母和，！？。.- 以外的字符</span>    r <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span><span class="token string">"[^，！？。\.\-\u4e00-\u9fa5_a-zA-Z0-9]"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 6. 半角变为全角</span>    sentence <span class="token operator">=</span> sentence<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">,</span> <span class="token string">"，"</span><span class="token punctuation">)</span>    sentence <span class="token operator">=</span> sentence<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"!"</span><span class="token punctuation">,</span> <span class="token string">"！"</span><span class="token punctuation">)</span>    sentence <span class="token operator">=</span> sentence<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"?"</span><span class="token punctuation">,</span> <span class="token string">"？"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 7. 问号叹号变为句号</span>    sentence <span class="token operator">=</span> sentence<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"？"</span><span class="token punctuation">,</span> <span class="token string">"。"</span><span class="token punctuation">)</span>    sentence <span class="token operator">=</span> sentence<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"！"</span><span class="token punctuation">,</span> <span class="token string">"。"</span><span class="token punctuation">)</span>    sentence <span class="token operator">=</span> r<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> sentence<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 第四步添加的删除特定位置的特定字符</span>    <span class="token comment" spellcheck="true"># 8. 删除句子开头的逗号</span>    <span class="token keyword">if</span> sentence<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'，'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        sentence <span class="token operator">=</span> sentence<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> sentence<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 读取数据, 并指定编码格式为'utf-8'</span>    df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'dev.csv'</span><span class="token punctuation">,</span> engine<span class="token operator">=</span><span class="token string">'python'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    texts <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'Dialogue'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'预处理前的第一条句子：'</span><span class="token punctuation">,</span> texts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'********************************'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 数据预处理</span>    res <span class="token operator">=</span> clean_sentence<span class="token punctuation">(</span>texts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'预处理后的第一条句子: '</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span></code></pre><h5 id="打印操作"><a href="#打印操作" class="headerlink" title="打印操作"></a>打印操作</h5><pre class=" language-python"><code class="language-python">预处理前的第一条句子： 技师说：<span class="token punctuation">[</span>语音<span class="token punctuation">]</span><span class="token operator">|</span>车主说：新的都换了<span class="token operator">|</span>车主说：助力泵，方向机<span class="token operator">|</span>技师说：<span class="token punctuation">[</span>语音<span class="token punctuation">]</span><span class="token operator">|</span>车主说：换了方向机带的有<span class="token operator">|</span>车主说：<span class="token punctuation">[</span>图片<span class="token punctuation">]</span><span class="token operator">|</span>技师说：<span class="token punctuation">[</span>语音<span class="token punctuation">]</span><span class="token operator">|</span>车主说：有助力就是重，这车要匹配吧<span class="token operator">|</span>技师说：不需要<span class="token operator">|</span>技师说：你这是更换的部件有问题<span class="token operator">|</span>车主说：跑快了还好点，就倒车重的很。<span class="token operator">|</span>技师说：是非常重吗<span class="token operator">|</span>车主说：是的，累人<span class="token operator">|</span>技师说：<span class="token punctuation">[</span>语音<span class="token punctuation">]</span><span class="token operator">|</span>车主说：我觉得也是，可是车主是以前没这么重，选吧助理泵换了不行，又把放向机换了，现在还这样就不知道咋和车主解释。<span class="token operator">|</span>技师说：<span class="token punctuation">[</span>语音<span class="token punctuation">]</span><span class="token operator">|</span>技师说：<span class="token punctuation">[</span>语音<span class="token punctuation">]</span>预处理后的第一条句子<span class="token punctuation">:</span>  。。。不需要。你这是更换的部件有问题。是非常重吗。。。。</code></pre><h3 id="2-1：TextRank模型代码实现：进行数数的机器学习模型"><a href="#2-1：TextRank模型代码实现：进行数数的机器学习模型" class="headerlink" title="2.1：TextRank模型代码实现：进行数数的机器学习模型"></a>2.1：TextRank模型代码实现：进行数数的机器学习模型</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 导入正则表达式工具包, 用来删除特定模式的数据</span><span class="token keyword">import</span> re<span class="token keyword">def</span> <span class="token function">clean_sentence</span><span class="token punctuation">(</span>sentence<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 第一步要处理的代码</span>    <span class="token comment" spellcheck="true"># 1. 将sentence按照'|'分句，并只提取技师的话</span>    sub_jishi <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 按照'|'字符将车主和用户的对话分离</span>    sub <span class="token operator">=</span> sentence<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 遍历每个子句</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 如果不是以句号结尾, 增加一个句号</span>        <span class="token keyword">if</span> <span class="token operator">not</span> sub<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'。'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            sub<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token string">'。'</span>        <span class="token comment" spellcheck="true"># 只使用技师说的句子</span>        <span class="token keyword">if</span> sub<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'技师'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            sub_jishi<span class="token punctuation">.</span>append<span class="token punctuation">(</span>sub<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 拼接成字符串并返回</span>    sentence <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>sub_jishi<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 第二步中添加的两个处理, 利用正则表达式re工具</span>    <span class="token comment" spellcheck="true"># 2. 删除1. 2. 3. 这些标题</span>    r <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span><span class="token string">"\D(\d\.)\D"</span><span class="token punctuation">)</span>    sentence <span class="token operator">=</span> r<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> sentence<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 3. 删除一些无关紧要的词以及语气助词</span>    r <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">"车主说|技师说|语音|图片|呢|吧|哈|啊|啦"</span><span class="token punctuation">)</span>    sentence <span class="token operator">=</span> r<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> sentence<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 第三步中添加的4个处理</span>    <span class="token comment" spellcheck="true"># 4. 删除带括号的 进口 海外</span>    r <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">"[(（]进口[)）]|\(海外\)"</span><span class="token punctuation">)</span>    sentence <span class="token operator">=</span> r<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> sentence<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 5. 删除除了汉字数字字母和，！？。.- 以外的字符</span>    r <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span><span class="token string">"[^，！？。\.\-\u4e00-\u9fa5_a-zA-Z0-9]"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 6. 半角变为全角</span>    sentence <span class="token operator">=</span> sentence<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">,</span> <span class="token string">"，"</span><span class="token punctuation">)</span>    sentence <span class="token operator">=</span> sentence<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"!"</span><span class="token punctuation">,</span> <span class="token string">"！"</span><span class="token punctuation">)</span>    sentence <span class="token operator">=</span> sentence<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"?"</span><span class="token punctuation">,</span> <span class="token string">"？"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 7. 问号叹号变为句号</span>    sentence <span class="token operator">=</span> sentence<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"？"</span><span class="token punctuation">,</span> <span class="token string">"。"</span><span class="token punctuation">)</span>    sentence <span class="token operator">=</span> sentence<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"！"</span><span class="token punctuation">,</span> <span class="token string">"。"</span><span class="token punctuation">)</span>    sentence <span class="token operator">=</span> r<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> sentence<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 第四步添加的删除特定位置的特定字符</span>    <span class="token comment" spellcheck="true"># 8. 删除句子开头的逗号</span>    <span class="token keyword">if</span> sentence<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'，'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        sentence <span class="token operator">=</span> sentence<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> sentence<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 读取数据, 并指定编码格式为'utf-8'</span>    df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'dev.csv'</span><span class="token punctuation">,</span> engine<span class="token operator">=</span><span class="token string">'python'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    texts <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'Dialogue'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>texts<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        texts<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> clean_sentence<span class="token punctuation">(</span>texts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">500</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"i="</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 初始化结果存放的列表</span>    results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 初始化textrank4zh类对象</span>    tr4s <span class="token operator">=</span> TextRank4Sentence<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>texts<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        text <span class="token operator">=</span> texts<span class="token punctuation">[</span>i<span class="token punctuation">]</span>        tr4s<span class="token punctuation">.</span>analyze<span class="token punctuation">(</span>text <span class="token operator">=</span> text<span class="token punctuation">,</span>lower <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>source <span class="token operator">=</span> <span class="token string">"all_filters"</span><span class="token punctuation">)</span>        result <span class="token operator">=</span> <span class="token string">""</span>        <span class="token comment" spellcheck="true"># 直接调用函数获取关键语句</span>        <span class="token comment" spellcheck="true"># num=3: 获取重要性最高的3个句子.</span>        <span class="token comment" spellcheck="true"># sentence_min_len=2: 句子的长度最小等于2.</span>        <span class="token keyword">for</span> item <span class="token keyword">in</span> tr4s<span class="token punctuation">.</span>get_key_sentences<span class="token punctuation">(</span>num<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> sentence_min_len<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            result <span class="token operator">+=</span> item<span class="token punctuation">.</span>sentence            result <span class="token operator">+=</span> <span class="token string">'。'</span>        results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 间隔100次打印结果</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'result length: '</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 保存结果</span>    df<span class="token punctuation">[</span><span class="token string">'Prediction'</span><span class="token punctuation">]</span> <span class="token operator">=</span> results    <span class="token comment" spellcheck="true"># 提取ID, Report, 和预测结果这3列</span>    df <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'QID'</span><span class="token punctuation">,</span> <span class="token string">'Report'</span><span class="token punctuation">,</span> <span class="token string">'Prediction'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 保存结果，这里自动生成一个结果名</span>    df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'textrank_result_.csv'</span><span class="token punctuation">,</span> index<span class="token operator">=</span>None<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 将空行置换为随时联系, 文件保存格式指定为utf-8</span>    df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'textrank_result_.csv'</span><span class="token punctuation">,</span> engine<span class="token operator">=</span><span class="token string">'python'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    df <span class="token operator">=</span> df<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">'随时联系。'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 将处理后的文件保存起来</span>    df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'textrank_result_final_.csv'</span><span class="token punctuation">,</span> index<span class="token operator">=</span>None<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span></code></pre><p><strong>打印结果</strong></p><pre class=" language-python"><code class="language-python">i<span class="token operator">=</span> <span class="token number">0</span>i<span class="token operator">=</span> <span class="token number">500</span>i<span class="token operator">=</span> <span class="token number">1000</span>i<span class="token operator">=</span> <span class="token number">1500</span>i<span class="token operator">=</span> <span class="token number">2000</span>i<span class="token operator">=</span> <span class="token number">2500</span>i<span class="token operator">=</span> <span class="token number">3000</span>i<span class="token operator">=</span> <span class="token number">3500</span>i<span class="token operator">=</span> <span class="token number">4000</span>i<span class="token operator">=</span> <span class="token number">4500</span><span class="token number">100</span> 这个故障一般是转向系统的故障，需要重点检查一下车辆的转向灯泡，是否有不亮的。换了就可以解决问题。你好，车辆故障信息代码标识。<span class="token number">200</span> 主要是找到发动机和变速器连接部位的支架以及底盘上的各个胶套，是否存在松旷，造成硬性的接触共振。你好，这种情况主要考虑检查底盘是否存在共振区域。这个需要全面检查，如果之前没有这种问题，可以试驾其他同款车辆，确认是否都有这种问题。<span class="token number">300</span> 您好出厂的时候变速箱油是正常的，在刻度线以内，流出半升之后还是在刻度线以内，所以不用加，亲。加不进去了。顶进去的。<span class="token number">400</span> 那就要去检查一下皮带轮了。如果高于<span class="token number">1200</span>还有，就要检查一下皮带轮。这款发动机在<span class="token number">900</span><span class="token operator">-</span><span class="token number">1100</span>转时确实有一点嗡嗡声。<span class="token number">500</span> 这种单边积水的情况基本上不是泡水的原因，而是有地方密封不严，下雨漏水进去，这个一般是门边密封条老化，或者是防风玻璃漏水，需要关上车门，在车外冲水，在车内慢慢找漏水的地方。海绵积水可以用洗车的泡沫海绵放在上面挤压，能把大部的水吸出来，然后大太阳的时候打开车门得晒一个星期左右，差不多就会干了，主要还是得找出进水的原因，不然弄干水了，下次又进水了，时间长了，海绵会发霉发臭的。我知道是地板上积水，空调管堵塞也是会造成这种情况的，也是需要检查的。<span class="token number">600</span> 您好，需要更换加油管和碳罐，加油时气体排不出去导致跳枪。估计外面找不到改款配件。加油管是改款双管的，原车是单管的。<span class="token number">700</span> 找领导处理，更换新件并赔偿。送保养次数。投诉厂家，欺骗消费者。<span class="token number">800</span> 用T10170和百分表，转曲轴看百分表指针，指针转到顺时针的最顶端是一缸上止点。把曲轴转到一缸上止点，然后挂链条就可以了。直接量一缸的上止点不就可以了，不用管其他缸。</code></pre><h1 id="3：-seq2seq实现baseline-1模型：文本摘要"><a href="#3：-seq2seq实现baseline-1模型：文本摘要" class="headerlink" title="3： seq2seq实现baseline-1模型：文本摘要"></a>3： seq2seq实现baseline-1模型：文本摘要</h1><h3 id="seq2seq实现文本摘要的架构"><a href="#seq2seq实现文本摘要的架构" class="headerlink" title="seq2seq实现文本摘要的架构"></a>seq2seq实现文本摘要的架构</h3><ul><li>首选回顾一下在英译法任务中的经典seq2seq架构图</li></ul><blockquote><ul><li>编码器端负责将输入数据进行编码, 得到中间语义张量.</li><li>解码器端负责一次次的循环解析中间语义张量, 得到最终的结果语句.</li><li>一般来说, 我们将注意力机制添加在解码器端.</li></ul></blockquote><h4 id="对比于英译法任务-我们再来看文本摘要任务下的seq2seq架构图"><a href="#对比于英译法任务-我们再来看文本摘要任务下的seq2seq架构图" class="headerlink" title="对比于英译法任务, 我们再来看文本摘要任务下的seq2seq架构图:"></a>对比于英译法任务, 我们再来看文本摘要任务下的seq2seq架构图:</h4><blockquote><ul><li>编码器端负责进行原始文本的编码.</li><li>注意力层结合编码张量和解码器端的当前输入, 得到总体上的内容张量.</li><li>最后在注意力机制的指导下, 解码器端得到完整的单词分布, 解码出当前时间步的单词.</li></ul></blockquote><h3 id="seq2seq实现文本摘要的架构代码实践"><a href="#seq2seq实现文本摘要的架构代码实践" class="headerlink" title="seq2seq实现文本摘要的架构代码实践"></a>seq2seq实现文本摘要的架构代码实践</h3><h4 id="若干工具函数的实现"><a href="#若干工具函数的实现" class="headerlink" title="若干工具函数的实现"></a>若干工具函数的实现</h4><ul><li><p>在这一部分中我们要实现如下几个工具函数:</p><ul><li>第一步: 实现配置函数config.py</li><li>第二步: 实现多核并行处理的函数multi_proc_utils.py</li><li>第三步: 实现参数配置函数params_utils.py</li><li>第四步: 实现保存字典的函数word2vec_utils.py</li><li>第五步: 实现数据加载的函数data_loader.py</li></ul></li><li><h4 id="第一步-实现配置函数config-py"><a href="#第一步-实现配置函数config-py" class="headerlink" title="第一步: 实现配置函数config.py"></a>第一步: 实现配置函数config.py</h4><ul><li>代码文件路径: /home/ec2-user/text_summary/seq2seq/utils/config.py</li></ul></li></ul><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 导入os工具包</span><span class="token keyword">import</span> os<span class="token keyword">import</span> sys<span class="token comment" spellcheck="true"># 设置项目代码库的root路径, 为后续所有的包导入提供便利</span>root_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>root_path<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>root_path<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 设置原始数据文件的路径, 通过以项目root路径为基础, 逐级添加到文件路径</span>train_raw_data_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root_path<span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'train.csv'</span><span class="token punctuation">)</span>test_raw_data_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root_path<span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'test.csv'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 停用词路径和jieba分词用户自定义字典路径</span>stop_words_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root_path<span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'stopwords.txt'</span><span class="token punctuation">)</span>user_dict_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root_path<span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'user_dict.txt'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 预处理+切分后的训练测试数据路径</span>train_seg_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root_path<span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'train_seg_data.csv'</span><span class="token punctuation">)</span>test_seg_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root_path<span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'test_seg_data.csv'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 将训练集和测试机数据混合后的文件路径</span>merged_seg_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root_path<span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'merged_seg_data.csv'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 样本与标签分离，并经过pad处理后的数据路径</span>train_x_pad_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root_path<span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'train_X_pad_data.csv'</span><span class="token punctuation">)</span>train_y_pad_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root_path<span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'train_Y_pad_data.csv'</span><span class="token punctuation">)</span>test_x_pad_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root_path<span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'test_X_pad_data.csv'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># numpy转换为数字后最终使用的的数据路径</span>train_x_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root_path<span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'train_X.npy'</span><span class="token punctuation">)</span>train_y_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root_path<span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'train_Y.npy'</span><span class="token punctuation">)</span>test_x_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root_path<span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'test_X.npy'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 正向词典和反向词典路径</span>vocab_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root_path<span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'wv'</span><span class="token punctuation">,</span> <span class="token string">'vocab.txt'</span><span class="token punctuation">)</span>reverse_vocab_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root_path<span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'wv'</span><span class="token punctuation">,</span> <span class="token string">'reverse_vocab.txt'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 测试集结果保存路径</span>result_save_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root_path<span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'result'</span><span class="token punctuation">)</span></code></pre><ul><li>输出结果:</li></ul><pre class=" language-python"><code class="language-python"><span class="token operator">/</span>home<span class="token operator">/</span>ec2<span class="token operator">-</span>user<span class="token operator">/</span>text_summary<span class="token operator">/</span>seq2seq</code></pre><h4 id="第二步-实现多核并行处理的函数multi-proc-utils-py"><a href="#第二步-实现多核并行处理的函数multi-proc-utils-py" class="headerlink" title="第二步: 实现多核并行处理的函数multi_proc_utils.py"></a>第二步: 实现多核并行处理的函数multi_proc_utils.py</h4><ul><li>代码文件路径: /home/ec2-user/text_summary/seq2seq/utils/multi_proc_utils.py</li></ul><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> cpu_count<span class="token punctuation">,</span> Pool<span class="token comment" spellcheck="true"># 计算当前服务器CPU的数量</span>cores <span class="token operator">=</span> cpu_count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 将分块个数设置为CPU的数量</span>partitions <span class="token operator">=</span> cores<span class="token keyword">print</span><span class="token punctuation">(</span>cores<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">parallelize</span><span class="token punctuation">(</span>df<span class="token punctuation">,</span> func<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 数据切分</span>    data_split <span class="token operator">=</span> np<span class="token punctuation">.</span>array_split<span class="token punctuation">(</span>df<span class="token punctuation">,</span> partitions<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 初始化线程池</span>    pool <span class="token operator">=</span> Pool<span class="token punctuation">(</span>cores<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 数据分发, 处理, 再合并</span>    data <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span>pool<span class="token punctuation">.</span>map<span class="token punctuation">(</span>func<span class="token punctuation">,</span> data_split<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 关闭线程池</span>    pool<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 执行完close后不会有新的进程加入到pool, join函数等待所有子进程结束</span>    pool<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 返回处理后的数据</span>    <span class="token keyword">return</span> data</code></pre><ul><li>输出结果:</li></ul><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 当前服务器是一个8核CPU, 32GB内存的机器</span><span class="token number">8</span></code></pre><h4 id="第三步-实现参数配置函数params-utils-py"><a href="#第三步-实现参数配置函数params-utils-py" class="headerlink" title="第三步: 实现参数配置函数params_utils.py"></a>第三步: 实现参数配置函数params_utils.py</h4><ul><li>代码文件路径: /home/ec2-user/text_summary/seq2seq/utils/params_utils.py</li></ul><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> argparse<span class="token keyword">def</span> <span class="token function">get_params</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 编码器和解码器的最大序列长度</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--max_enc_len"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token string">"Encoder input max sequence length"</span><span class="token punctuation">,</span> type<span class="token operator">=</span>int<span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--max_dec_len"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token string">"Decoder input max sequence length"</span><span class="token punctuation">,</span> type<span class="token operator">=</span>int<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 一个训练批次的大小</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--batch_size"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token string">"Batch size"</span><span class="token punctuation">,</span> type<span class="token operator">=</span>int<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># seq2seq训练轮数</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--seq2seq_train_epochs"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token string">"Seq2seq model training epochs"</span><span class="token punctuation">,</span> type<span class="token operator">=</span>int<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 词嵌入大小</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--embed_size"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token string">"Words embeddings dimension"</span><span class="token punctuation">,</span> type<span class="token operator">=</span>int<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 编码器、解码器以及attention的隐含层单元数</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--enc_units"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token string">"Encoder GRU cell units number"</span><span class="token punctuation">,</span> type<span class="token operator">=</span>int<span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--dec_units"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token string">"Decoder GRU cell units number"</span><span class="token punctuation">,</span> type<span class="token operator">=</span>int<span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--attn_units"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token string">"Used to compute the attention weights"</span><span class="token punctuation">,</span> type<span class="token operator">=</span>int<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 学习率</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">"--learning_rate"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token string">"Learning rate"</span><span class="token punctuation">,</span> type<span class="token operator">=</span>float<span class="token punctuation">)</span>    args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># param是一个字典类型的变量，键为参数名，值为参数值</span>    params <span class="token operator">=</span> vars<span class="token punctuation">(</span>args<span class="token punctuation">)</span>    <span class="token keyword">return</span> params<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    res <span class="token operator">=</span> get_params<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span></code></pre><ul><li>输出结果:</li></ul><pre class=" language-python"><code class="language-python"><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'max_enc_len': 300, 'max_dec_len': 50, 'batch_size': 64, 'seq2seq_train_epochs': </span></code></pre><h4 id="第四步-实现保存字典的函数word2vec-utils-py"><a href="#第四步-实现保存字典的函数word2vec-utils-py" class="headerlink" title="第四步: 实现保存字典的函数word2vec_utils.py"></a>第四步: 实现保存字典的函数word2vec_utils.py</h4><ul><li>代码文件路径: /home/ec2-user/text_summary/seq2seq/utils/word2vec_utils.py</li></ul><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> gensim<span class="token punctuation">.</span>models<span class="token punctuation">.</span>word2vec <span class="token keyword">import</span> Word2Vec<span class="token keyword">def</span> <span class="token function">load_embedding_matrix_from_model</span><span class="token punctuation">(</span>wv_model_path<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 从word2vec模型中获取词向量矩阵</span>    <span class="token comment" spellcheck="true"># wv_model_path: word2vec模型的路径</span>    wv_model <span class="token operator">=</span> Word2Vec<span class="token punctuation">.</span>load<span class="token punctuation">(</span>wv_model_path<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># wv_model.wv.vectors包含词向量矩阵</span>    embedding_matrix <span class="token operator">=</span> wv_model<span class="token punctuation">.</span>wv<span class="token punctuation">.</span>vectors    <span class="token keyword">return</span> embedding_matrix<span class="token keyword">def</span> <span class="token function">get_vocab_from_model</span><span class="token punctuation">(</span>wv_model_path<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 从word2vec模型中获取正向和反向词典</span>    <span class="token comment" spellcheck="true"># wv_model_path: word2vec模型的路径</span>    wv_model <span class="token operator">=</span> Word2Vec<span class="token punctuation">.</span>load<span class="token punctuation">(</span>wv_model_path<span class="token punctuation">)</span>    id_to_word <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;index: word for index, word in enumerate(wv_model.wv.index2word)&amp;#125;</span>    word_to_id <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;word: index for index, word in enumerate(wv_model.wv.index2word)&amp;#125;</span>    <span class="token keyword">return</span> word_to_id<span class="token punctuation">,</span> id_to_word<span class="token keyword">def</span> <span class="token function">save_vocab_as_txt</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> word_to_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 保存字典</span>    <span class="token comment" spellcheck="true"># filename: 目标txt文件路径</span>    <span class="token comment" spellcheck="true"># word_to_id: 要保存的字典</span>    <span class="token keyword">with</span> open<span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> word_to_id<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"&amp;#123;&amp;#125;\t&amp;#123;&amp;#125;\n"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h4 id="第五步-实现数据加载的函数data-loader-py"><a href="#第五步-实现数据加载的函数data-loader-py" class="headerlink" title="第五步: 实现数据加载的函数data_loader.py"></a>第五步: 实现数据加载的函数data_loader.py</h4><ul><li>代码文件路径: /home/ec2-user/text_summary/seq2seq/utils/data_loader.py<ul><li>1: 获取最大长度的函数.</li><li>2: 完成文本语句单词到id的数字映射函数.</li><li>3: 填充特殊标识符的函数.</li><li>4: 加载停用词表的函数.</li><li>5: 清洗文本的函数.</li><li>6: 过滤停用词的函数.</li><li>7: 语句处理的函数.</li><li>8: 加载构建好的训练集和测试集的函数.</li><li>9: 完成本步骤总体逻辑的函数build_dataset()函数.</li></ul></li></ul><h5 id="1-获取最大长度的函数"><a href="#1-获取最大长度的函数" class="headerlink" title="1: 获取最大长度的函数"></a>1: 获取最大长度的函数</h5><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">import</span> os<span class="token keyword">import</span> sys<span class="token keyword">import</span> re<span class="token keyword">import</span> jieba<span class="token comment" spellcheck="true"># 配置模块</span><span class="token keyword">from</span> utils<span class="token punctuation">.</span>config <span class="token keyword">import</span> <span class="token operator">*</span>root_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>root_path<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">get_max_len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 获得合适的最大长度值(被build_dataset调用)</span>    <span class="token comment" spellcheck="true"># data: 待统计的数据train_df['Question']</span>    <span class="token comment" spellcheck="true"># 句子最大长度为空格数+1</span>    max_lens <span class="token operator">=</span> data<span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 平均值+2倍方差的方式</span>    <span class="token keyword">return</span> int<span class="token punctuation">(</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>max_lens<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>max_lens<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h5 id="2-完成文本语句单词到id的数字映射函数"><a href="#2-完成文本语句单词到id的数字映射函数" class="headerlink" title="2: 完成文本语句单词到id的数字映射函数"></a>2: 完成文本语句单词到id的数字映射函数</h5><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">transform_data</span><span class="token punctuation">(</span>sentence<span class="token punctuation">,</span> word_to_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 句子转换为index序列(被build_dataset调用)</span>    <span class="token comment" spellcheck="true"># sentence: 'word1 word2 word3 ...'  ->  [index1, index2, index3 ...]</span>    <span class="token comment" spellcheck="true"># word_to_id: 映射字典</span>    <span class="token comment" spellcheck="true"># 字符串切分成词</span>    words <span class="token operator">=</span> sentence<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 按照word_to_id的id进行转换, 到未知词就填充unk的索引</span>    ids <span class="token operator">=</span> <span class="token punctuation">[</span>word_to_id<span class="token punctuation">[</span>w<span class="token punctuation">]</span> <span class="token keyword">if</span> w <span class="token keyword">in</span> word_to_id <span class="token keyword">else</span> word_to_id<span class="token punctuation">[</span><span class="token string">'&lt;UNK>'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> w <span class="token keyword">in</span> words<span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 返回映射后的文本id值列表</span>    <span class="token keyword">return</span> ids</code></pre><h5 id="3-填充特殊标识符的函数"><a href="#3-填充特殊标识符的函数" class="headerlink" title="3: 填充特殊标识符的函数"></a>3: 填充特殊标识符的函数</h5><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">pad_proc</span><span class="token punctuation">(</span>sentence<span class="token punctuation">,</span> max_len<span class="token punctuation">,</span> word_to_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 根据max_len和vocab填充&lt;START> &lt;STOP> &lt;PAD> &lt;UNK></span>    <span class="token comment" spellcheck="true"># 0. 按空格统计切分出词</span>    words <span class="token operator">=</span> sentence<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 1. 截取规定长度的词数</span>    words <span class="token operator">=</span> words<span class="token punctuation">[</span><span class="token punctuation">:</span>max_len<span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 2. 填充&lt;UNK></span>    sentence <span class="token operator">=</span> <span class="token punctuation">[</span>w <span class="token keyword">if</span> w <span class="token keyword">in</span> word_to_id <span class="token keyword">else</span> <span class="token string">'&lt;UNK>'</span> <span class="token keyword">for</span> w <span class="token keyword">in</span> words<span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 3. 填充&lt;START> &lt;END></span>    sentence <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'&lt;START>'</span><span class="token punctuation">]</span> <span class="token operator">+</span> sentence <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token string">'&lt;STOP>'</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 4. 判断长度，填充&lt;PAD></span>    sentence <span class="token operator">=</span> sentence <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token string">'&lt;PAD>'</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max_len <span class="token operator">-</span> len<span class="token punctuation">(</span>words<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 以空格连接列表, 返回结果字符串</span>    <span class="token keyword">return</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span></code></pre><h5 id="4-加载停用词表的函数"><a href="#4-加载停用词表的函数" class="headerlink" title="4: 加载停用词表的函数"></a>4: 加载停用词表的函数</h5><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">load_stop_words</span><span class="token punctuation">(</span>stop_word_path<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 加载停用词(程序调用)</span>    <span class="token comment" spellcheck="true"># stop_word_path: 停用词路径</span>    <span class="token comment" spellcheck="true"># 打开停用词文件</span>    f <span class="token operator">=</span> open<span class="token punctuation">(</span>stop_word_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 读取所有行</span>    stop_words <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 去除每一个停用词前后 空格 换行符</span>    stop_words <span class="token operator">=</span> <span class="token punctuation">[</span>stop_word<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> stop_word <span class="token keyword">in</span> stop_words<span class="token punctuation">]</span>    <span class="token keyword">return</span> stop_words<span class="token comment" spellcheck="true"># 加载停用词, 这里面的stop_words_path是早已在config.py文件中配置好的</span>stop_words <span class="token operator">=</span> load_stop_words<span class="token punctuation">(</span>stop_words_path<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'stop_words: '</span><span class="token punctuation">,</span> stop_words<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><h5 id="打印"><a href="#打印" class="headerlink" title="打印"></a>打印</h5><pre class=" language-python"><code class="language-python">stop_words<span class="token punctuation">:</span>  <span class="token punctuation">[</span><span class="token string">':'</span><span class="token punctuation">,</span> <span class="token string">'：'</span><span class="token punctuation">,</span> <span class="token string">'———'</span><span class="token punctuation">,</span> <span class="token string">'》），'</span><span class="token punctuation">,</span> <span class="token string">'）÷（１－'</span><span class="token punctuation">,</span> <span class="token string">'”，'</span><span class="token punctuation">,</span> <span class="token string">'）、'</span><span class="token punctuation">,</span> <span class="token string">'＝（'</span><span class="token punctuation">,</span> <span class="token string">'→'</span><span class="token punctuation">,</span> <span class="token string">'℃'</span><span class="token punctuation">,</span> <span class="token string">'&amp;'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token string">'一一'</span><span class="token punctuation">,</span> <span class="token string">'~~~~'</span><span class="token punctuation">,</span> <span class="token string">'『'</span><span class="token punctuation">,</span> <span class="token string">'.一'</span><span class="token punctuation">,</span> <span class="token string">'./'</span><span class="token punctuation">,</span> <span class="token string">'--'</span><span class="token punctuation">,</span> <span class="token string">'』'</span><span class="token punctuation">,</span> <span class="token string">'＝″'</span><span class="token punctuation">]</span></code></pre><h5 id="5-清洗文本的函数"><a href="#5-清洗文本的函数" class="headerlink" title="5: 清洗文本的函数"></a>5: 清洗文本的函数</h5><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">clean_sentence</span><span class="token punctuation">(</span>sentence<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 特殊符号去除(被sentence_proc调用)</span>    <span class="token comment" spellcheck="true"># sentence: 待处理的字符串</span>    <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>sentence<span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 删除1. 2. 3. 这些标题</span>        r <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span><span class="token string">"\D(\d\.)\D"</span><span class="token punctuation">)</span>        sentence <span class="token operator">=</span> r<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> sentence<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 删除带括号的 进口 海外</span>        r <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">"[(（]进口[)）]|\(海外\)"</span><span class="token punctuation">)</span>        sentence <span class="token operator">=</span> r<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> sentence<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 删除除了汉字数字字母和，！？。.- 以外的字符</span>        r <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span><span class="token string">"[^，！？。\.\-\u4e00-\u9fa5_a-zA-Z0-9]"</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 用中文输入法下的，！？来替换英文输入法下的,!?</span>        sentence <span class="token operator">=</span> sentence<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">,</span> <span class="token string">"，"</span><span class="token punctuation">)</span>        sentence <span class="token operator">=</span> sentence<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"!"</span><span class="token punctuation">,</span> <span class="token string">"！"</span><span class="token punctuation">)</span>        sentence <span class="token operator">=</span> sentence<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"?"</span><span class="token punctuation">,</span> <span class="token string">"？"</span><span class="token punctuation">)</span>        sentence <span class="token operator">=</span> r<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> sentence<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 删除 车主说 技师说 语音 图片 你好 您好</span>        r <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">"车主说|技师说|语音|图片|你好|您好"</span><span class="token punctuation">)</span>        sentence <span class="token operator">=</span> r<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> sentence<span class="token punctuation">)</span>        <span class="token keyword">return</span> sentence    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">''</span>    sentence <span class="token operator">=</span> <span class="token string">'技师说：你好！以前也出现过该故障吗？|技师说：缸压多少有没有测量一下?|车主说：没有过|车主说：没测缸压|技师说：测量一下缸压 看一四缸缸压是否偏低|车主说：用电脑测，只是14缸缺火|车主说：[语音]|车主说：[语音]|技师说：点火线圈  火花塞 喷油嘴不用干活  直接和二三缸对倒一下  跑一段在测量一下故障码进行排除|车主说：[语音]|车主>说：[语音]|车主说：[语音]|车主说：[语音]|车主说：师傅还在吗|技师说：调一下喷油嘴  测一下缸压  都正常则为发动机电脑板问题|车主说：[语音]|车主说：[语音]|车主说：[语音]|技师说：这个影响不大的|技师说：缸压八个以上正常|车主说：[语音]|技师说：所以说让你测量缸压  只要缸压正常则没有问题|车主说：[语音]|车主说：[语音]|技师说：可以点击头像关注我  有什么问题随时询问  一定真诚用心为你解决|车主说：师傅，谢谢了|技师说：不用客气'</span>res <span class="token operator">=</span> clean_sentence<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'res='</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span></code></pre><h5 id="打印：-2"><a href="#打印：-2" class="headerlink" title="打印："></a>打印：</h5><pre class=" language-python"><code class="language-python">res<span class="token operator">=</span> ！以前也出现过该故障吗？缸压多少有没有测量一下？没有过没测缸压测量一下缸压看一四缸缸压是否偏低用电脑测，只是<span class="token number">14</span>缸缺火点火线圈火花塞喷油嘴不用干活直接和二三缸对倒一下跑一段在测量一下故障码进行排除师傅还在吗调一下喷油嘴测一下缸压都正常则为发动机电脑板问题这个影响不大的缸压八个以上正常所以说让你测量缸压只要缸压正常则没有问题可以点击头像关注我有什么问题随时询问一定真诚用心为你解决师傅，谢谢了不用客气</code></pre><h5 id="6：-过滤停用词的函数"><a href="#6：-过滤停用词的函数" class="headerlink" title="6：#过滤停用词的函数"></a>6：#过滤停用词的函数</h5><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">filter_stopwords</span><span class="token punctuation">(</span>seg_list<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 过滤一句切好词的话中的停用词(被sentence_proc调用)</span>    <span class="token comment" spellcheck="true"># seg_list: 切好词的列表 [word1 ,word2 .......]</span>    <span class="token comment" spellcheck="true"># 首先去掉多余空字符</span>    words <span class="token operator">=</span> <span class="token punctuation">[</span>word <span class="token keyword">for</span> word <span class="token keyword">in</span> seg_list <span class="token keyword">if</span> word<span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 去掉停用词</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span>word <span class="token keyword">for</span> word <span class="token keyword">in</span> words <span class="token keyword">if</span> word <span class="token operator">not</span> <span class="token keyword">in</span> stop_words<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># 第一步: 先将原始文本执行清洗操作</span>res <span class="token operator">=</span> clean_sentence<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># print('res=', res)</span><span class="token comment" spellcheck="true"># 第二步: 对清洗结果进行分词, 默认是精确模式, 当设置cut_all=True时, 采用全模式</span>words <span class="token operator">=</span> jieba<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 第三步: 将分词的结果传入过滤停用词函数中, 并打印结果</span>result <span class="token operator">=</span> filter_stopwords<span class="token punctuation">(</span>words<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span></code></pre><h5 id="打印-1"><a href="#打印-1" class="headerlink" title="打印"></a>打印</h5><pre class=" language-python"><code class="language-python"><span class="token punctuation">[</span><span class="token string">'！'</span><span class="token punctuation">,</span> <span class="token string">'以前'</span><span class="token punctuation">,</span> <span class="token string">'出现'</span><span class="token punctuation">,</span> <span class="token string">'过该'</span><span class="token punctuation">,</span> <span class="token string">'故障'</span><span class="token punctuation">,</span> <span class="token string">'？'</span><span class="token punctuation">,</span> <span class="token string">'缸'</span><span class="token punctuation">,</span> <span class="token string">'压'</span><span class="token punctuation">,</span> <span class="token string">'有没有'</span><span class="token punctuation">,</span> <span class="token string">'测量'</span><span class="token punctuation">,</span> <span class="token string">'一下'</span><span class="token punctuation">,</span> <span class="token string">'？'</span><span class="token punctuation">,</span> <span class="token string">'没有'</span><span class="token punctuation">,</span> <span class="token string">'没测'</span><span class="token punctuation">,</span> <span class="token string">'缸'</span><span class="token punctuation">,</span> <span class="token string">'压'</span><span class="token punctuation">,</span> <span class="token string">'测量'</span><span class="token punctuation">,</span> <span class="token string">'一下'</span><span class="token punctuation">,</span> <span class="token string">'缸'</span><span class="token punctuation">,</span> <span class="token string">'压'</span><span class="token punctuation">,</span> <span class="token string">'看'</span><span class="token punctuation">,</span> <span class="token string">'一四缸'</span><span class="token punctuation">,</span> <span class="token string">'缸'</span><span class="token punctuation">,</span> <span class="token string">'压'</span><span class="token punctuation">,</span> <span class="token string">'是否'</span><span class="token punctuation">,</span> <span class="token string">'偏低'</span><span class="token punctuation">,</span> <span class="token string">'电脑'</span><span class="token punctuation">,</span> <span class="token string">'测'</span><span class="token punctuation">,</span> <span class="token string">'，'</span><span class="token punctuation">,</span> <span class="token string">'14'</span><span class="token punctuation">,</span> <span class="token string">'缸'</span><span class="token punctuation">,</span> <span class="token string">'缺火'</span><span class="token punctuation">,</span> <span class="token string">'点火'</span><span class="token punctuation">,</span> <span class="token string">'线圈'</span><span class="token punctuation">,</span> <span class="token string">'火花塞'</span><span class="token punctuation">,</span> <span class="token string">'喷油嘴'</span><span class="token punctuation">,</span> <span class="token string">'不用'</span><span class="token punctuation">,</span> <span class="token string">'干活'</span><span class="token punctuation">,</span> <span class="token string">'直接'</span><span class="token punctuation">,</span> <span class="token string">'二三'</span><span class="token punctuation">,</span> <span class="token string">'缸'</span><span class="token punctuation">,</span> <span class="token string">'倒'</span><span class="token punctuation">,</span> <span class="token string">'一下'</span><span class="token punctuation">,</span> <span class="token string">'跑'</span><span class="token punctuation">,</span> <span class="token string">'一段'</span><span class="token punctuation">,</span> <span class="token string">'测量'</span><span class="token punctuation">,</span> <span class="token string">'一下'</span><span class="token punctuation">,</span> <span class="token string">'故障'</span><span class="token punctuation">,</span> <span class="token string">'码'</span><span class="token punctuation">,</span> <span class="token string">'进行'</span><span class="token punctuation">,</span> <span class="token string">'排除'</span><span class="token punctuation">,</span> <span class="token string">'师傅'</span><span class="token punctuation">,</span> <span class="token string">'还'</span><span class="token punctuation">,</span> <span class="token string">'调'</span><span class="token punctuation">,</span> <span class="token string">'一下'</span><span class="token punctuation">,</span> <span class="token string">'喷油嘴'</span><span class="token punctuation">,</span> <span class="token string">'测'</span><span class="token punctuation">,</span> <span class="token string">'一下'</span><span class="token punctuation">,</span> <span class="token string">'缸'</span><span class="token punctuation">,</span> <span class="token string">'压'</span><span class="token punctuation">,</span> <span class="token string">'都'</span><span class="token punctuation">,</span> <span class="token string">'正常'</span><span class="token punctuation">,</span> <span class="token string">'发动机'</span><span class="token punctuation">,</span> <span class="token string">'电脑板'</span><span class="token punctuation">,</span> <span class="token string">'问题'</span><span class="token punctuation">,</span> <span class="token string">'影响'</span><span class="token punctuation">,</span> <span class="token string">'不大'</span><span class="token punctuation">,</span> <span class="token string">'缸'</span><span class="token punctuation">,</span> <span class="token string">'压'</span><span class="token punctuation">,</span> <span class="token string">'八个'</span><span class="token punctuation">,</span> <span class="token string">'以上'</span><span class="token punctuation">,</span> <span class="token string">'正常'</span><span class="token punctuation">,</span> <span class="token string">'说'</span><span class="token punctuation">,</span> <span class="token string">'测量'</span><span class="token punctuation">,</span> <span class="token string">'缸'</span><span class="token punctuation">,</span> <span class="token string">'压'</span><span class="token punctuation">,</span> <span class="token string">'缸'</span><span class="token punctuation">,</span> <span class="token string">'压'</span><span class="token punctuation">,</span> <span class="token string">'正常'</span><span class="token punctuation">,</span> <span class="token string">'没有'</span><span class="token punctuation">,</span> <span class="token string">'问题'</span><span class="token punctuation">,</span> <span class="token string">'点击'</span><span class="token punctuation">,</span> <span class="token string">'头像'</span><span class="token punctuation">,</span> <span class="token string">'关注'</span><span class="token punctuation">,</span> <span class="token string">'问题'</span><span class="token punctuation">,</span> <span class="token string">'随时'</span><span class="token punctuation">,</span> <span class="token string">'询问'</span><span class="token punctuation">,</span> <span class="token string">'一定'</span><span class="token punctuation">,</span> <span class="token string">'真诚'</span><span class="token punctuation">,</span> <span class="token string">'用心'</span><span class="token punctuation">,</span> <span class="token string">'解决'</span><span class="token punctuation">,</span> <span class="token string">'师傅'</span><span class="token punctuation">,</span> <span class="token string">'，'</span><span class="token punctuation">,</span> <span class="token string">'谢谢'</span><span class="token punctuation">,</span> <span class="token string">'不用'</span><span class="token punctuation">,</span> <span class="token string">'客气'</span><span class="token punctuation">]</span></code></pre><h5 id="7：句子的处理"><a href="#7：句子的处理" class="headerlink" title="7：句子的处理"></a>7：句子的处理</h5><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">sentence_proc</span><span class="token punctuation">(</span>sentence<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 预处理模块(处理一条句子, 被sentences_proc调用)</span>    <span class="token comment" spellcheck="true"># sentence: 待处理字符串</span>    <span class="token comment" spellcheck="true"># 第一步: 执行清洗原始文本的操作</span>    sentence <span class="token operator">=</span> clean_sentence<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 第二步: 执行分词操作, 默认精确模式, 全模式cut参数cut_all=True</span>    words <span class="token operator">=</span> jieba<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 第三步: 将分词结果输入过滤停用词函数中</span>    words <span class="token operator">=</span> filter_stopwords<span class="token punctuation">(</span>words<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 返回字符串结果, 按空格分隔, 将过滤停用词后的列表拼接</span>    <span class="token keyword">return</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>words<span class="token punctuation">)</span>res <span class="token operator">=</span> sentence_proc<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'res='</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span></code></pre><h5 id="打印-2"><a href="#打印-2" class="headerlink" title="打印"></a>打印</h5><pre class=" language-python"><code class="language-python">res<span class="token operator">=</span> ！ 以前 出现 过该 故障 ？ 缸 压 有没有 测量 一下 ？ 没有 没测 缸 压 测量 一下 缸 压 看 一四缸 缸 压 是否 偏低 电脑 测 ， <span class="token number">14</span> 缸 缺火 点火 线圈 火花塞 喷油嘴 不用 干活 直接 二三 缸 倒 一下 跑 一段 测量 一下 故障 码 进行 排除 师傅 还 调 一下 喷油嘴 测 一下 缸 压 都 正常 发动机 电脑板 问题 影响 不大 缸 压 八个 以上 正常 说 测量 缸 压 缸 压 正常 没有 问题 点击 头像 关注 问题 随时 询问 一定 真诚 用心 解决 师傅 ， 谢谢 不用 客气</code></pre><h5 id="7：语句处理的函数-2"><a href="#7：语句处理的函数-2" class="headerlink" title="7：语句处理的函数(2)"></a>7：语句处理的函数(2)</h5><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">sentences_proc</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 预处理模块(处理一个句子列表, 对每个句子调用sentence_proc操作)</span>    <span class="token comment" spellcheck="true"># df: 数据集</span>    <span class="token comment" spellcheck="true"># 批量预处理训练集和测试集</span>    <span class="token keyword">for</span> col_name <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'Brand'</span><span class="token punctuation">,</span> <span class="token string">'Model'</span><span class="token punctuation">,</span> <span class="token string">'Question'</span><span class="token punctuation">,</span> <span class="token string">'Dialogue'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        df<span class="token punctuation">[</span>col_name<span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span>sentence_proc<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 训练集Report预处理</span>    <span class="token keyword">if</span> <span class="token string">'Report'</span> <span class="token keyword">in</span> df<span class="token punctuation">.</span>columns<span class="token punctuation">:</span>        df<span class="token punctuation">[</span><span class="token string">'Report'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'Report'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span>sentence_proc<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 以Pandas的DataFrame格式返回</span>    <span class="token keyword">return</span> df</code></pre><h5 id="8：加载构建好的训练集和测试集的函数"><a href="#8：加载构建好的训练集和测试集的函数" class="headerlink" title="8：加载构建好的训练集和测试集的函数"></a>8：加载构建好的训练集和测试集的函数</h5><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 加载处理好的训练样本和训练标签.npy文件(执行完build_dataset后才能使用)</span><span class="token keyword">def</span> <span class="token function">load_train_dataset</span><span class="token punctuation">(</span>max_enc_len<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> max_dec_len<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># max_enc_len: 最长样本长度, 后面的截断</span>    <span class="token comment" spellcheck="true"># max_dec_len: 最长标签长度, 后面的截断</span>    train_X <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span>train_x_path<span class="token punctuation">)</span>    train_Y <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span>train_y_path<span class="token punctuation">)</span>    train_X <span class="token operator">=</span> train_X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span>max_enc_len<span class="token punctuation">]</span>    train_Y <span class="token operator">=</span> train_Y<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span>max_dec_len<span class="token punctuation">]</span>    <span class="token keyword">return</span> train_X<span class="token punctuation">,</span> train_Y<span class="token comment" spellcheck="true"># 加载处理好的测试样本.npy文件(执行完build_dataset后才能使用)</span><span class="token keyword">def</span> <span class="token function">load_test_dataset</span><span class="token punctuation">(</span>max_enc_len<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># max_enc_len: 最长样本长度, 后面的截断</span>    test_X <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span>test_x_path<span class="token punctuation">)</span>    test_X <span class="token operator">=</span> test_X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span>max_enc_len<span class="token punctuation">]</span>    <span class="token keyword">return</span> test_X</code></pre><h5 id="9-完成本步骤总体逻辑的函数build-dataset-函数"><a href="#9-完成本步骤总体逻辑的函数build-dataset-函数" class="headerlink" title="9: 完成本步骤总体逻辑的函数build_dataset()函数"></a>9: 完成本步骤总体逻辑的函数build_dataset()函数</h5><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 数据预处理总函数, 用于数据加载 + 预处理 (注意: 只需执行一次)</span><span class="token keyword">def</span> <span class="token function">build_dataset</span><span class="token punctuation">(</span>train_raw_data_path<span class="token punctuation">,</span> test_raw_data_path<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 1. 加载原始数据</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'1. 加载原始数据'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>train_raw_data_path<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 必须设定数据格式为utf-8</span>    train_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>train_raw_data_path<span class="token punctuation">,</span> engine<span class="token operator">=</span><span class="token string">'python'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    test_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>test_raw_data_path<span class="token punctuation">,</span> engine<span class="token operator">=</span><span class="token string">'python'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 82943, 20000</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'原始训练集行数 &amp;#123;&amp;#125;, 测试集行数 &amp;#123;&amp;#125;'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>len<span class="token punctuation">(</span>train_df<span class="token punctuation">)</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>test_df<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 2. 空值去除(对于一行数据, 任意列只要有空值就去掉该行)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'2. 空值去除（对于一行数据，任意列只要有空值就去掉该行）'</span><span class="token punctuation">)</span>    train_df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Question'</span><span class="token punctuation">,</span> <span class="token string">'Dialogue'</span><span class="token punctuation">,</span> <span class="token string">'Report'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> how<span class="token operator">=</span><span class="token string">'any'</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    test_df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Question'</span><span class="token punctuation">,</span> <span class="token string">'Dialogue'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> how<span class="token operator">=</span><span class="token string">'any'</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'空值去除后训练集行数 &amp;#123;&amp;#125;, 测试集行数 &amp;#123;&amp;#125;'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>len<span class="token punctuation">(</span>train_df<span class="token punctuation">)</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>test_df<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 3. 多线程, 批量数据预处理(对每个句子执行sentence_proc, 清除无用词, 分词, 过滤停用词, 再用空格拼接为一个字符串)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'3. 多线程, 批量数据预处理(对每个句子执行sentence_proc, 清除无用词, 分词, 过滤停用词, 再用空格拼接为一个字符串)'</span><span class="token punctuation">)</span>    train_df <span class="token operator">=</span> parallelize<span class="token punctuation">(</span>train_df<span class="token punctuation">,</span> sentences_proc<span class="token punctuation">)</span>    test_df <span class="token operator">=</span> parallelize<span class="token punctuation">(</span>test_df<span class="token punctuation">,</span> sentences_proc<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'sentences_proc has done!'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 4. 合并训练测试集, 用于构造映射字典word_to_id</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'4. 合并训练测试集, 用于构造映射字典word_to_id'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 新建一列, 按行堆积</span>    train_df<span class="token punctuation">[</span><span class="token string">'merged'</span><span class="token punctuation">]</span> <span class="token operator">=</span> train_df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Question'</span><span class="token punctuation">,</span> <span class="token string">'Dialogue'</span><span class="token punctuation">,</span> <span class="token string">'Report'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 新建一列, 按行堆积</span>    test_df<span class="token punctuation">[</span><span class="token string">'merged'</span><span class="token punctuation">]</span> <span class="token operator">=</span> test_df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Question'</span><span class="token punctuation">,</span> <span class="token string">'Dialogue'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># merged列是训练集三列和测试集两列按行连接在一起再按列堆积, 用于构造映射字典</span>    <span class="token comment" spellcheck="true"># 按列堆积, 用于构造映射字典</span>    merged_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>train_df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'merged'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> test_df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'merged'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练集行数&amp;#123;&amp;#125;, 测试集行数&amp;#123;&amp;#125;, 合并数据集行数&amp;#123;&amp;#125;'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>len<span class="token punctuation">(</span>train_df<span class="token punctuation">)</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>test_df<span class="token punctuation">)</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>merged_df<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 5. 保存分割处理好的train_seg_data.csv, test_set_data.csv</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'5. 保存分割处理好的train_seg_data.csv, test_set_data.csv'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 把建立的列merged去掉, 该列对于神经网络无用</span>    train_df <span class="token operator">=</span> train_df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'merged'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    test_df <span class="token operator">=</span> test_df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'merged'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 将处理后的数据存入持久化文件</span>    train_df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>train_seg_path<span class="token punctuation">,</span> index<span class="token operator">=</span>None<span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    test_df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>test_seg_path<span class="token punctuation">,</span> index<span class="token operator">=</span>None<span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The csv_file has saved!'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 6. 保存合并数据merged_seg_data.csv, 用于构造映射字典word_to_id</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'6. 保存合并数据merged_seg_data.csv, 用于构造映射字典word_to_id'</span><span class="token punctuation">)</span>    merged_df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>merged_seg_path<span class="token punctuation">,</span> index<span class="token operator">=</span>None<span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The word_to_vector file has saved!'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 7. 构建word_to_id字典和id_to_word字典, 根据第6步存储的合并文件数据来完成.</span>    word_to_id <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span>    count <span class="token operator">=</span> <span class="token number">0</span>    <span class="token comment" spellcheck="true"># 对训练集数据X进行处理</span>    <span class="token keyword">with</span> open<span class="token punctuation">(</span>merged_seg_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f1<span class="token punctuation">:</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> f1<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            line <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>            <span class="token keyword">for</span> w <span class="token keyword">in</span> line<span class="token punctuation">:</span>                <span class="token keyword">if</span> w <span class="token operator">not</span> <span class="token keyword">in</span> word_to_id<span class="token punctuation">:</span>                    word_to_id<span class="token punctuation">[</span>w<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>                    count <span class="token operator">+=</span> <span class="token number">1</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    word_to_id<span class="token punctuation">[</span>w<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'总体单词总数count='</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    res_dict <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span>    number <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> w<span class="token punctuation">,</span> i <span class="token keyword">in</span> word_to_id<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> i <span class="token operator">>=</span> <span class="token number">5</span><span class="token punctuation">:</span>            res_dict<span class="token punctuation">[</span>w<span class="token punctuation">]</span> <span class="token operator">=</span> i            number <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'进入到字典中的单词总数number='</span><span class="token punctuation">,</span> number<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'合并数据集的字典构造完毕, word_to_id容量: '</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>res_dict<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    word_to_id <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span>    count <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> w<span class="token punctuation">,</span> i <span class="token keyword">in</span> res_dict<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> w <span class="token operator">not</span> <span class="token keyword">in</span> word_to_id<span class="token punctuation">:</span>            word_to_id<span class="token punctuation">[</span>w<span class="token punctuation">]</span> <span class="token operator">=</span> count            count <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'最终构造完毕字典, word_to_id容量='</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>word_to_id<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'count='</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 8. 将Question和Dialogue用空格连接作为模型输入形成train_df['X']</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"8. 将Question和Dialogue用空格连接作为模型输入形成train_df['X']"</span><span class="token punctuation">)</span>    train_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span> <span class="token operator">=</span> train_df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Question'</span><span class="token punctuation">,</span> <span class="token string">'Dialogue'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    test_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span> <span class="token operator">=</span> test_df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Question'</span><span class="token punctuation">,</span> <span class="token string">'Dialogue'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 9. 填充&lt;START>, &lt;STOP>, &lt;UNK>和&lt;PAD>, 使数据变为等长</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'9. 填充&lt;START>, &lt;STOP>, &lt;UNK> 和 &lt;PAD>, 使数据变为等长'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 获取适当的最大长度</span>    train_x_max_len <span class="token operator">=</span> get_max_len<span class="token punctuation">(</span>train_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    test_x_max_len <span class="token operator">=</span> get_max_len<span class="token punctuation">(</span>test_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    train_y_max_len <span class="token operator">=</span> get_max_len<span class="token punctuation">(</span>train_df<span class="token punctuation">[</span><span class="token string">'Report'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'填充前训练集样本的最大长度为: '</span><span class="token punctuation">,</span> train_x_max_len<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'填充前测试集样本的最大长度为: '</span><span class="token punctuation">,</span> test_x_max_len<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'填充前训练集标签的最大长度为: '</span><span class="token punctuation">,</span> train_y_max_len<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 选训练集和测试集中较大的值</span>    x_max_len <span class="token operator">=</span> max<span class="token punctuation">(</span>train_x_max_len<span class="token punctuation">,</span> test_x_max_len<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 训练集X填充处理</span>    <span class="token comment" spellcheck="true"># train_df['X'] = train_df['X'].apply(lambda x: pad_proc(x, x_max_len, vocab))</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练集X填充PAD, START, STOP, UNK处理中...'</span><span class="token punctuation">)</span>    train_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span> <span class="token operator">=</span> train_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> pad_proc<span class="token punctuation">(</span>x<span class="token punctuation">,</span> x_max_len<span class="token punctuation">,</span> word_to_id<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 测试集X填充处理</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'测试集X填充PAD, START, STOP, UNK处理中...'</span><span class="token punctuation">)</span>    test_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span> <span class="token operator">=</span> test_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> pad_proc<span class="token punctuation">(</span>x<span class="token punctuation">,</span> x_max_len<span class="token punctuation">,</span> word_to_id<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 训练集Y填充处理</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练集Y填充PAD, START, STOP, UNK处理中...'</span><span class="token punctuation">)</span>    train_df<span class="token punctuation">[</span><span class="token string">'Y'</span><span class="token punctuation">]</span> <span class="token operator">=</span> train_df<span class="token punctuation">[</span><span class="token string">'Report'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> pad_proc<span class="token punctuation">(</span>x<span class="token punctuation">,</span> train_y_max_len<span class="token punctuation">,</span> word_to_id<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 10. 保存填充&lt;START>, &lt;STOP>, &lt;UNK>和&lt;PAD>后的X和Y</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'10. 保存填充&lt;START>, &lt;STOP>, &lt;UNK> 和 &lt;PAD>后的X和Y'</span><span class="token punctuation">)</span>    train_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>train_x_pad_path<span class="token punctuation">,</span> index<span class="token operator">=</span>None<span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>    train_df<span class="token punctuation">[</span><span class="token string">'Y'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>train_y_pad_path<span class="token punctuation">,</span> index<span class="token operator">=</span>None<span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>    test_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>test_x_pad_path<span class="token punctuation">,</span> index<span class="token operator">=</span>None<span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'填充后的三个文件保存完毕!'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 11. 重新构建word_to_id字典和id_to_word字典, 根据第10步存储的3个文件数据来完成.</span>    word_to_id <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span>    count <span class="token operator">=</span> <span class="token number">0</span>    <span class="token comment" spellcheck="true"># 对训练集数据X进行处理</span>    <span class="token keyword">with</span> open<span class="token punctuation">(</span>train_x_pad_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f1<span class="token punctuation">:</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> f1<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            line <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>            <span class="token keyword">for</span> w <span class="token keyword">in</span> line<span class="token punctuation">:</span>                <span class="token keyword">if</span> w <span class="token operator">not</span> <span class="token keyword">in</span> word_to_id<span class="token punctuation">:</span>                    word_to_id<span class="token punctuation">[</span>w<span class="token punctuation">]</span> <span class="token operator">=</span> count                    count <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练集X字典构造完毕, word_to_id容量: '</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>word_to_id<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 对训练集数据Y进行处理</span>    <span class="token keyword">with</span> open<span class="token punctuation">(</span>train_y_pad_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f2<span class="token punctuation">:</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> f2<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            line <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>            <span class="token keyword">for</span> w <span class="token keyword">in</span> line<span class="token punctuation">:</span>                <span class="token keyword">if</span> w <span class="token operator">not</span> <span class="token keyword">in</span> word_to_id<span class="token punctuation">:</span>                    word_to_id<span class="token punctuation">[</span>w<span class="token punctuation">]</span> <span class="token operator">=</span> count                    count <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练集Y字典构造完毕, word_to_id容量: '</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>word_to_id<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 对测试集数据X进行处理</span>    <span class="token keyword">with</span> open<span class="token punctuation">(</span>test_x_pad_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f3<span class="token punctuation">:</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> f3<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            line <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>            <span class="token keyword">for</span> w <span class="token keyword">in</span> line<span class="token punctuation">:</span>                <span class="token keyword">if</span> w <span class="token operator">not</span> <span class="token keyword">in</span> word_to_id<span class="token punctuation">:</span>                    word_to_id<span class="token punctuation">[</span>w<span class="token punctuation">]</span> <span class="token operator">=</span> count                    count <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'测试集X字典构造完毕, word_to_id容量: '</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>word_to_id<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'单词总数量count= '</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 构造逆向字典id_to_word</span>    id_to_word <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span>    <span class="token keyword">for</span> w<span class="token punctuation">,</span> i <span class="token keyword">in</span> word_to_id<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        id_to_word<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> w    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'逆向字典构造完毕, id_to_word容量: '</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>id_to_word<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 12. 更新vocab并保存</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'12. 更新vocab并保存'</span><span class="token punctuation">)</span>    save_vocab_as_txt<span class="token punctuation">(</span>vocab_path<span class="token punctuation">,</span> word_to_id<span class="token punctuation">)</span>    save_vocab_as_txt<span class="token punctuation">(</span>reverse_vocab_path<span class="token punctuation">,</span> id_to_word<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'字典映射器word_to_id, id_to_word保存完毕!'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 13. 数据集转换 将词转换成索引[&lt;START> 方向机 重 ...] -> [32800, 403, 986, 246, 231]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'13. 数据集转换 将词转换成索引[&lt;START> 方向机 重 ...] -> [32800, 403, 986, 246, 231]'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练集X执行transform_data中......'</span><span class="token punctuation">)</span>    train_ids_x <span class="token operator">=</span> train_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> transform_data<span class="token punctuation">(</span>x<span class="token punctuation">,</span> word_to_id<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练集Y执行transform_data中......'</span><span class="token punctuation">)</span>    train_ids_y <span class="token operator">=</span> train_df<span class="token punctuation">[</span><span class="token string">'Y'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> transform_data<span class="token punctuation">(</span>x<span class="token punctuation">,</span> word_to_id<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'测试集X执行transform_data中......'</span><span class="token punctuation">)</span>    test_ids_x <span class="token operator">=</span> test_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> transform_data<span class="token punctuation">(</span>x<span class="token punctuation">,</span> word_to_id<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 14. 数据转换成numpy数组(需等长)</span>    <span class="token comment" spellcheck="true"># 将索引列表转换成矩阵 [32800, 403, 986, 246, 231] --> array([[32800, 403, 986, 246, 231], ...])</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'14. 数据转换成numpy数组(需等长)'</span><span class="token punctuation">)</span>    train_X <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>train_ids_x<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    train_Y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>train_ids_y<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    test_X <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>test_ids_x<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'转换为numpy数组的形状如下: \ntrain_X的shape为: '</span><span class="token punctuation">,</span> train_X<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> <span class="token string">'\ntrain_Y的shape为: '</span><span class="token punctuation">,</span> train_Y<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> <span class="token string">'\ntest_X的shape为: '</span><span class="token punctuation">,</span> test_X<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 15. 保存数据</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'15. 保存数据......'</span><span class="token punctuation">)</span>    np<span class="token punctuation">.</span>save<span class="token punctuation">(</span>train_x_path<span class="token punctuation">,</span> train_X<span class="token punctuation">)</span>    np<span class="token punctuation">.</span>save<span class="token punctuation">(</span>train_y_path<span class="token punctuation">,</span> train_Y<span class="token punctuation">)</span>    np<span class="token punctuation">.</span>save<span class="token punctuation">(</span>test_x_path<span class="token punctuation">,</span> test_X<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'数据集构造完毕, 存储于seq2seq/data/目录下.'</span><span class="token punctuation">)</span></code></pre><h4 id="前面数据处理合并的代码"><a href="#前面数据处理合并的代码" class="headerlink" title="前面数据处理合并的代码"></a>前面数据处理合并的代码</h4><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">import</span> os<span class="token keyword">import</span> sys<span class="token keyword">import</span> re<span class="token keyword">import</span> jieba<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd<span class="token keyword">from</span> utils<span class="token punctuation">.</span>multi_proc_utils <span class="token keyword">import</span> parallelize<span class="token keyword">from</span> utils<span class="token punctuation">.</span>word2vec_utils <span class="token keyword">import</span> save_vocab_as_txtroot_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>root_path<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 配置模块</span><span class="token keyword">from</span> utils<span class="token punctuation">.</span>config <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> utils<span class="token punctuation">.</span>params_utils <span class="token keyword">import</span> get_params<span class="token comment" spellcheck="true"># 载入词向量参数</span>params <span class="token operator">=</span> get_params<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># jieba载入自定义切词表</span>jieba<span class="token punctuation">.</span>load_userdict<span class="token punctuation">(</span>user_dict_path<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">get_max_len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 获得合适的最大长度值(被build_dataset调用)</span>    <span class="token comment" spellcheck="true"># data: 待统计的数据train_df['Question']</span>    <span class="token comment" spellcheck="true"># 句子最大长度为空格数+1</span>    max_lens <span class="token operator">=</span> data<span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 平均值+2倍方差的方式</span>    <span class="token keyword">return</span> int<span class="token punctuation">(</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>max_lens<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>max_lens<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#完成文本语句单词到id的数字映射函数</span><span class="token keyword">def</span> <span class="token function">transform_data</span><span class="token punctuation">(</span>sentence<span class="token punctuation">,</span> word_to_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 句子转换为index序列(被build_dataset调用)</span>    <span class="token comment" spellcheck="true"># sentence: 'word1 word2 word3 ...'  ->  [index1, index2, index3 ...]</span>    <span class="token comment" spellcheck="true"># word_to_id: 映射字典</span>    <span class="token comment" spellcheck="true"># 字符串切分成词</span>    words <span class="token operator">=</span> sentence<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 按照word_to_id的id进行转换, 到未知词就填充unk的索引</span>    ids <span class="token operator">=</span> <span class="token punctuation">[</span>word_to_id<span class="token punctuation">[</span>w<span class="token punctuation">]</span> <span class="token keyword">if</span> w <span class="token keyword">in</span> word_to_id <span class="token keyword">else</span> word_to_id<span class="token punctuation">[</span><span class="token string">'&lt;UNK>'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> w <span class="token keyword">in</span> words<span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 返回映射后的文本id值列表</span>    <span class="token keyword">return</span> ids<span class="token comment" spellcheck="true"># 填充特殊标识符的函数</span><span class="token keyword">def</span> <span class="token function">pad_proc</span><span class="token punctuation">(</span>sentence<span class="token punctuation">,</span> max_len<span class="token punctuation">,</span> word_to_id<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 根据max_len和vocab填充&lt;START> &lt;STOP> &lt;PAD> &lt;UNK></span>    <span class="token comment" spellcheck="true"># 0. 按空格统计切分出词</span>    words <span class="token operator">=</span> sentence<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 1. 截取规定长度的词数</span>    words <span class="token operator">=</span> words<span class="token punctuation">[</span><span class="token punctuation">:</span>max_len<span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 2. 填充&lt;UNK></span>    sentence <span class="token operator">=</span> <span class="token punctuation">[</span>w <span class="token keyword">if</span> w <span class="token keyword">in</span> word_to_id <span class="token keyword">else</span> <span class="token string">'&lt;UNK>'</span> <span class="token keyword">for</span> w <span class="token keyword">in</span> words<span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 3. 填充&lt;START> &lt;END></span>    sentence <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'&lt;START>'</span><span class="token punctuation">]</span> <span class="token operator">+</span> sentence <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token string">'&lt;STOP>'</span><span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 4. 判断长度，填充&lt;PAD></span>    sentence <span class="token operator">=</span> sentence <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token string">'&lt;PAD>'</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max_len <span class="token operator">-</span> len<span class="token punctuation">(</span>words<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 以空格连接列表, 返回结果字符串</span>    <span class="token keyword">return</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#加载停用词的函数</span><span class="token keyword">def</span> <span class="token function">load_stop_words</span><span class="token punctuation">(</span>stop_word_payh<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true">#stop_word_payh:停用词的存储路径</span>    <span class="token comment" spellcheck="true">#打开停用词表</span>    f <span class="token operator">=</span> open<span class="token punctuation">(</span>stop_word_payh<span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>    stop_words <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>    stop_words <span class="token operator">=</span> <span class="token punctuation">[</span>stop_word<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span>  stop_word <span class="token keyword">in</span> stop_words<span class="token punctuation">]</span>    <span class="token keyword">return</span> stop_words<span class="token comment" spellcheck="true"># 加载停用词, 这里面的stop_words_path是早已在config.py文件中配置好的</span>stop_words <span class="token operator">=</span> load_stop_words<span class="token punctuation">(</span>stop_words_path<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'stop_words: '</span><span class="token punctuation">,</span> stop_words<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#清理文本的函数</span><span class="token keyword">def</span> <span class="token function">clean_sentence</span><span class="token punctuation">(</span>sentence<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 特殊符号去除(被sentence_proc调用)</span>    <span class="token comment" spellcheck="true"># sentence: 待处理的字符串</span>    <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>sentence<span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 删除1. 2. 3. 这些标题</span>        r <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span><span class="token string">"\D(\d\.)\D"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#正则表达式</span>        sentence <span class="token operator">=</span> r<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> sentence<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 删除带括号的 进口 海外</span>        r <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">"[(（]进口[)）]|\(海外\)"</span><span class="token punctuation">)</span>        sentence <span class="token operator">=</span> r<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> sentence<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 删除除了汉字数字字母和，！？。.- 以外的字符</span>        r <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span><span class="token string">"[^，！？。\.\-\u4e00-\u9fa5_a-zA-Z0-9]"</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 用中文输入法下的，！？来替换英文输入法下的,!?</span>        sentence <span class="token operator">=</span> sentence<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">,</span> <span class="token string">"，"</span><span class="token punctuation">)</span>        sentence <span class="token operator">=</span> sentence<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"!"</span><span class="token punctuation">,</span> <span class="token string">"！"</span><span class="token punctuation">)</span>        sentence <span class="token operator">=</span> sentence<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"?"</span><span class="token punctuation">,</span> <span class="token string">"？"</span><span class="token punctuation">)</span>        sentence <span class="token operator">=</span> r<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> sentence<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 删除 车主说 技师说 语音 图片 你好 您好</span>        r <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">"车主说|技师说|语音|图片|你好|您好"</span><span class="token punctuation">)</span>        sentence <span class="token operator">=</span> r<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> sentence<span class="token punctuation">)</span>        <span class="token keyword">return</span> sentence    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">''</span>sentence <span class="token operator">=</span> <span class="token string">'技师说：你好！以前也出现过该故障吗？|技师说：缸压多少有没有测量一下?|车主说：没有过|车主说：没测缸压|技师说：测量一下缸压 看一四缸缸压是否偏低|车主说：用电脑测，只是14缸缺火|车主说：[语音]|车主说：[语音]|技师说：点火线圈  火花塞 喷油嘴不用干活  直接和二三缸对倒一下  跑一段在测量一下故障码进行排除|车主说：[语音]|车主>说：[语音]|车主说：[语音]|车主说：[语音]|车主说：师傅还在吗|技师说：调一下喷油嘴  测一下缸压  都正常则为发动机电脑板问题|车主说：[语音]|车主说：[语音]|车主说：[语音]|技师说：这个影响不大的|技师说：缸压八个以上正常|车主说：[语音]|技师说：所以说让你测量缸压  只要缸压正常则没有问题|车主说：[语音]|车主说：[语音]|技师说：可以点击头像关注我  有什么问题随时询问  一定真诚用心为你解决|车主说：师傅，谢谢了|技师说：不用客气'</span><span class="token comment" spellcheck="true">#过滤停用词的函数</span><span class="token keyword">def</span> <span class="token function">filter_stopwords</span><span class="token punctuation">(</span>seg_list<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 过滤一句切好词的话中的停用词(被sentence_proc调用)</span>    <span class="token comment" spellcheck="true"># seg_list: 切好词的列表 [word1 ,word2 .......]</span>    <span class="token comment" spellcheck="true"># 首先去掉多余空字符</span>    words <span class="token operator">=</span> <span class="token punctuation">[</span>word <span class="token keyword">for</span> word <span class="token keyword">in</span> seg_list <span class="token keyword">if</span> word<span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 去掉停用词</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span>word <span class="token keyword">for</span> word <span class="token keyword">in</span> words <span class="token keyword">if</span> word <span class="token operator">not</span> <span class="token keyword">in</span> stop_words<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># 第一步: 先将原始文本执行清洗操作</span>res <span class="token operator">=</span> clean_sentence<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># print('res=', res)</span><span class="token comment" spellcheck="true"># 第二步: 对清洗结果进行分词, 默认是精确模式, 当设置cut_all=True时, 采用全模式</span>words <span class="token operator">=</span> jieba<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 第三步: 将分词的结果传入过滤停用词函数中, 并打印结果</span>result <span class="token operator">=</span> filter_stopwords<span class="token punctuation">(</span>words<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 句子的处理</span><span class="token keyword">def</span> <span class="token function">sentence_proc</span><span class="token punctuation">(</span>sentence<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 预处理模块(处理一条句子, 被sentences_proc调用)</span>    <span class="token comment" spellcheck="true"># sentence: 待处理字符串</span>    <span class="token comment" spellcheck="true"># 第一步: 执行清洗原始文本的操作</span>    sentence <span class="token operator">=</span> clean_sentence<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 第二步: 执行分词操作, 默认精确模式, 全模式cut参数cut_all=True</span>    words <span class="token operator">=</span> jieba<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 第三步: 将分词结果输入过滤停用词函数中</span>    words <span class="token operator">=</span> filter_stopwords<span class="token punctuation">(</span>words<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 返回字符串结果, 按空格分隔, 将过滤停用词后的列表拼接</span>    <span class="token keyword">return</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>words<span class="token punctuation">)</span>res <span class="token operator">=</span> sentence_proc<span class="token punctuation">(</span>sentence<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'res='</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 语句处理的函数(2)</span><span class="token keyword">def</span> <span class="token function">sentences_proc</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 预处理模块(处理一个句子列表, 对每个句子调用sentence_proc操作)</span>    <span class="token comment" spellcheck="true"># df: 数据集</span>    <span class="token comment" spellcheck="true"># 批量预处理训练集和测试集</span>    <span class="token keyword">for</span> col_name <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'Brand'</span><span class="token punctuation">,</span> <span class="token string">'Model'</span><span class="token punctuation">,</span> <span class="token string">'Question'</span><span class="token punctuation">,</span> <span class="token string">'Dialogue'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        df<span class="token punctuation">[</span>col_name<span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span>sentence_proc<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 训练集Report预处理</span>    <span class="token keyword">if</span> <span class="token string">'Report'</span> <span class="token keyword">in</span> df<span class="token punctuation">.</span>columns<span class="token punctuation">:</span>        df<span class="token punctuation">[</span><span class="token string">'Report'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'Report'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span>sentence_proc<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 以Pandas的DataFrame格式返回</span>    <span class="token keyword">return</span> df<span class="token comment" spellcheck="true"># 加载构建好的训练集和测试集的函数</span><span class="token comment" spellcheck="true"># 加载处理好的训练样本和训练标签.npy文件(执行完build_dataset后才能使用)</span><span class="token keyword">def</span> <span class="token function">load_train_dataset</span><span class="token punctuation">(</span>max_enc_len<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> max_dec_len<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># max_enc_len: 最长样本长度, 后面的截断</span>    <span class="token comment" spellcheck="true"># max_dec_len: 最长标签长度, 后面的截断</span>    train_X <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span>train_x_path<span class="token punctuation">)</span>    train_Y <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span>train_y_path<span class="token punctuation">)</span>    train_X <span class="token operator">=</span> train_X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span>max_enc_len<span class="token punctuation">]</span>    train_Y <span class="token operator">=</span> train_Y<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span>max_dec_len<span class="token punctuation">]</span>    <span class="token keyword">return</span> train_X<span class="token punctuation">,</span> train_Y<span class="token comment" spellcheck="true"># 加载处理好的测试样本.npy文件(执行完build_dataset后才能使用)</span><span class="token keyword">def</span> <span class="token function">load_test_dataset</span><span class="token punctuation">(</span>max_enc_len<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># max_enc_len: 最长样本长度, 后面的截断</span>    test_X <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span>test_x_path<span class="token punctuation">)</span>    test_X <span class="token operator">=</span> test_X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span>max_enc_len<span class="token punctuation">]</span>    <span class="token keyword">return</span> test_X    <span class="token comment" spellcheck="true"># 9: 完成本步骤总体逻辑的函数build_dataset()函数</span><span class="token comment" spellcheck="true"># 数据预处理总函数, 用于数据加载 + 预处理 (注意: 只需执行一次)</span><span class="token keyword">def</span> <span class="token function">build_dataset</span><span class="token punctuation">(</span>train_raw_data_path<span class="token punctuation">,</span> test_raw_data_path<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># 1. 加载原始数据</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'1. 加载原始数据'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>train_raw_data_path<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 必须设定数据格式为utf-8</span>    train_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>train_raw_data_path<span class="token punctuation">,</span> engine<span class="token operator">=</span><span class="token string">'python'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    test_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>test_raw_data_path<span class="token punctuation">,</span> engine<span class="token operator">=</span><span class="token string">'python'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 82943, 20000</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'原始训练集行数 &amp;#123;&amp;#125;, 测试集行数 &amp;#123;&amp;#125;'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>len<span class="token punctuation">(</span>train_df<span class="token punctuation">)</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>test_df<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 2. 空值去除(对于一行数据, 任意列只要有空值就去掉该行)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'2. 空值去除（对于一行数据，任意列只要有空值就去掉该行）'</span><span class="token punctuation">)</span>    train_df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Question'</span><span class="token punctuation">,</span> <span class="token string">'Dialogue'</span><span class="token punctuation">,</span> <span class="token string">'Report'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> how<span class="token operator">=</span><span class="token string">'any'</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    test_df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Question'</span><span class="token punctuation">,</span> <span class="token string">'Dialogue'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> how<span class="token operator">=</span><span class="token string">'any'</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'空值去除后训练集行数 &amp;#123;&amp;#125;, 测试集行数 &amp;#123;&amp;#125;'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>len<span class="token punctuation">(</span>train_df<span class="token punctuation">)</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>test_df<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 3. 多线程, 批量数据预处理(对每个句子执行sentence_proc, 清除无用词, 分词, 过滤停用词, 再用空格拼接为一个字符串)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'3. 多线程, 批量数据预处理(对每个句子执行sentence_proc, 清除无用词, 分词, 过滤停用词, 再用空格拼接为一个字符串)'</span><span class="token punctuation">)</span>    train_df <span class="token operator">=</span> parallelize<span class="token punctuation">(</span>train_df<span class="token punctuation">,</span> sentences_proc<span class="token punctuation">)</span>    test_df <span class="token operator">=</span> parallelize<span class="token punctuation">(</span>test_df<span class="token punctuation">,</span> sentences_proc<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'sentences_proc has done!'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 4. 合并训练测试集, 用于构造映射字典word_to_id</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'4. 合并训练测试集, 用于构造映射字典word_to_id'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 新建一列, 按行堆积</span>    train_df<span class="token punctuation">[</span><span class="token string">'merged'</span><span class="token punctuation">]</span> <span class="token operator">=</span> train_df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Question'</span><span class="token punctuation">,</span> <span class="token string">'Dialogue'</span><span class="token punctuation">,</span> <span class="token string">'Report'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 新建一列, 按行堆积</span>    test_df<span class="token punctuation">[</span><span class="token string">'merged'</span><span class="token punctuation">]</span> <span class="token operator">=</span> test_df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Question'</span><span class="token punctuation">,</span> <span class="token string">'Dialogue'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># merged列是训练集三列和测试集两列按行连接在一起再按列堆积, 用于构造映射字典</span>    <span class="token comment" spellcheck="true"># 按列堆积, 用于构造映射字典</span>    merged_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>train_df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'merged'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> test_df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'merged'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练集行数&amp;#123;&amp;#125;, 测试集行数&amp;#123;&amp;#125;, 合并数据集行数&amp;#123;&amp;#125;'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>len<span class="token punctuation">(</span>train_df<span class="token punctuation">)</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>test_df<span class="token punctuation">)</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>merged_df<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 5. 保存分割处理好的train_seg_data.csv, test_set_data.csv</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'5. 保存分割处理好的train_seg_data.csv, test_set_data.csv'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 把建立的列merged去掉, 该列对于神经网络无用</span>    train_df <span class="token operator">=</span> train_df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'merged'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    test_df <span class="token operator">=</span> test_df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'merged'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 将处理后的数据存入持久化文件</span>    train_df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>train_seg_path<span class="token punctuation">,</span> index<span class="token operator">=</span>None<span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    test_df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>test_seg_path<span class="token punctuation">,</span> index<span class="token operator">=</span>None<span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The csv_file has saved!'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 6. 保存合并数据merged_seg_data.csv, 用于构造映射字典word_to_id</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'6. 保存合并数据merged_seg_data.csv, 用于构造映射字典word_to_id'</span><span class="token punctuation">)</span>    merged_df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>merged_seg_path<span class="token punctuation">,</span> index<span class="token operator">=</span>None<span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The word_to_vector file has saved!'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 7. 构建word_to_id字典和id_to_word字典, 根据第6步存储的合并文件数据来完成.</span>    word_to_id <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span>    count <span class="token operator">=</span> <span class="token number">0</span>    <span class="token comment" spellcheck="true"># 对训练集数据X进行处理</span>    <span class="token keyword">with</span> open<span class="token punctuation">(</span>merged_seg_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f1<span class="token punctuation">:</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> f1<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            line <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>            <span class="token keyword">for</span> w <span class="token keyword">in</span> line<span class="token punctuation">:</span>                <span class="token keyword">if</span> w <span class="token operator">not</span> <span class="token keyword">in</span> word_to_id<span class="token punctuation">:</span>                    word_to_id<span class="token punctuation">[</span>w<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>                    count <span class="token operator">+=</span> <span class="token number">1</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    word_to_id<span class="token punctuation">[</span>w<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'总体单词总数count='</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    res_dict <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span>    number <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> w<span class="token punctuation">,</span> i <span class="token keyword">in</span> word_to_id<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> i <span class="token operator">>=</span> <span class="token number">5</span><span class="token punctuation">:</span>            res_dict<span class="token punctuation">[</span>w<span class="token punctuation">]</span> <span class="token operator">=</span> i            number <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'进入到字典中的单词总数number='</span><span class="token punctuation">,</span> number<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'合并数据集的字典构造完毕, word_to_id容量: '</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>res_dict<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    word_to_id <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span>    count <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> w<span class="token punctuation">,</span> i <span class="token keyword">in</span> res_dict<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> w <span class="token operator">not</span> <span class="token keyword">in</span> word_to_id<span class="token punctuation">:</span>            word_to_id<span class="token punctuation">[</span>w<span class="token punctuation">]</span> <span class="token operator">=</span> count            count <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'最终构造完毕字典, word_to_id容量='</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>word_to_id<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'count='</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 8. 将Question和Dialogue用空格连接作为模型输入形成train_df['X']</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"8. 将Question和Dialogue用空格连接作为模型输入形成train_df['X']"</span><span class="token punctuation">)</span>    train_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span> <span class="token operator">=</span> train_df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Question'</span><span class="token punctuation">,</span> <span class="token string">'Dialogue'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    test_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span> <span class="token operator">=</span> test_df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Question'</span><span class="token punctuation">,</span> <span class="token string">'Dialogue'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 9. 填充&lt;START>, &lt;STOP>, &lt;UNK>和&lt;PAD>, 使数据变为等长</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'9. 填充&lt;START>, &lt;STOP>, &lt;UNK> 和 &lt;PAD>, 使数据变为等长'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 获取适当的最大长度</span>    train_x_max_len <span class="token operator">=</span> get_max_len<span class="token punctuation">(</span>train_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    test_x_max_len <span class="token operator">=</span> get_max_len<span class="token punctuation">(</span>test_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    train_y_max_len <span class="token operator">=</span> get_max_len<span class="token punctuation">(</span>train_df<span class="token punctuation">[</span><span class="token string">'Report'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'填充前训练集样本的最大长度为: '</span><span class="token punctuation">,</span> train_x_max_len<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'填充前测试集样本的最大长度为: '</span><span class="token punctuation">,</span> test_x_max_len<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'填充前训练集标签的最大长度为: '</span><span class="token punctuation">,</span> train_y_max_len<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 选训练集和测试集中较大的值</span>    x_max_len <span class="token operator">=</span> max<span class="token punctuation">(</span>train_x_max_len<span class="token punctuation">,</span> test_x_max_len<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 训练集X填充处理</span>    <span class="token comment" spellcheck="true"># train_df['X'] = train_df['X'].apply(lambda x: pad_proc(x, x_max_len, vocab))</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练集X填充PAD, START, STOP, UNK处理中...'</span><span class="token punctuation">)</span>    train_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span> <span class="token operator">=</span> train_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> pad_proc<span class="token punctuation">(</span>x<span class="token punctuation">,</span> x_max_len<span class="token punctuation">,</span> word_to_id<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 测试集X填充处理</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'测试集X填充PAD, START, STOP, UNK处理中...'</span><span class="token punctuation">)</span>    test_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span> <span class="token operator">=</span> test_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> pad_proc<span class="token punctuation">(</span>x<span class="token punctuation">,</span> x_max_len<span class="token punctuation">,</span> word_to_id<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 训练集Y填充处理</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练集Y填充PAD, START, STOP, UNK处理中...'</span><span class="token punctuation">)</span>    train_df<span class="token punctuation">[</span><span class="token string">'Y'</span><span class="token punctuation">]</span> <span class="token operator">=</span> train_df<span class="token punctuation">[</span><span class="token string">'Report'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> pad_proc<span class="token punctuation">(</span>x<span class="token punctuation">,</span> train_y_max_len<span class="token punctuation">,</span> word_to_id<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 10. 保存填充&lt;START>, &lt;STOP>, &lt;UNK>和&lt;PAD>后的X和Y</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'10. 保存填充&lt;START>, &lt;STOP>, &lt;UNK> 和 &lt;PAD>后的X和Y'</span><span class="token punctuation">)</span>    train_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>train_x_pad_path<span class="token punctuation">,</span> index<span class="token operator">=</span>None<span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>    train_df<span class="token punctuation">[</span><span class="token string">'Y'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>train_y_pad_path<span class="token punctuation">,</span> index<span class="token operator">=</span>None<span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>    test_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>test_x_pad_path<span class="token punctuation">,</span> index<span class="token operator">=</span>None<span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'填充后的三个文件保存完毕!'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 11. 重新构建word_to_id字典和id_to_word字典, 根据第10步存储的3个文件数据来完成.</span>    word_to_id <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span>    count <span class="token operator">=</span> <span class="token number">0</span>    <span class="token comment" spellcheck="true"># 对训练集数据X进行处理</span>    <span class="token keyword">with</span> open<span class="token punctuation">(</span>train_x_pad_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f1<span class="token punctuation">:</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> f1<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            line <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>            <span class="token keyword">for</span> w <span class="token keyword">in</span> line<span class="token punctuation">:</span>                <span class="token keyword">if</span> w <span class="token operator">not</span> <span class="token keyword">in</span> word_to_id<span class="token punctuation">:</span>                    word_to_id<span class="token punctuation">[</span>w<span class="token punctuation">]</span> <span class="token operator">=</span> count                    count <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练集X字典构造完毕, word_to_id容量: '</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>word_to_id<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 对训练集数据Y进行处理</span>    <span class="token keyword">with</span> open<span class="token punctuation">(</span>train_y_pad_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f2<span class="token punctuation">:</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> f2<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            line <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>            <span class="token keyword">for</span> w <span class="token keyword">in</span> line<span class="token punctuation">:</span>                <span class="token keyword">if</span> w <span class="token operator">not</span> <span class="token keyword">in</span> word_to_id<span class="token punctuation">:</span>                    word_to_id<span class="token punctuation">[</span>w<span class="token punctuation">]</span> <span class="token operator">=</span> count                    count <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练集Y字典构造完毕, word_to_id容量: '</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>word_to_id<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 对测试集数据X进行处理</span>    <span class="token keyword">with</span> open<span class="token punctuation">(</span>test_x_pad_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f3<span class="token punctuation">:</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> f3<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            line <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>            <span class="token keyword">for</span> w <span class="token keyword">in</span> line<span class="token punctuation">:</span>                <span class="token keyword">if</span> w <span class="token operator">not</span> <span class="token keyword">in</span> word_to_id<span class="token punctuation">:</span>                    word_to_id<span class="token punctuation">[</span>w<span class="token punctuation">]</span> <span class="token operator">=</span> count                    count <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'测试集X字典构造完毕, word_to_id容量: '</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>word_to_id<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'单词总数量count= '</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 构造逆向字典id_to_word</span>    id_to_word <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span>    <span class="token keyword">for</span> w<span class="token punctuation">,</span> i <span class="token keyword">in</span> word_to_id<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        id_to_word<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> w    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'逆向字典构造完毕, id_to_word容量: '</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>id_to_word<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 12. 更新vocab并保存</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'12. 更新vocab并保存'</span><span class="token punctuation">)</span>    save_vocab_as_txt<span class="token punctuation">(</span>vocab_path<span class="token punctuation">,</span> word_to_id<span class="token punctuation">)</span>    save_vocab_as_txt<span class="token punctuation">(</span>reverse_vocab_path<span class="token punctuation">,</span> id_to_word<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'字典映射器word_to_id, id_to_word保存完毕!'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 13. 数据集转换 将词转换成索引[&lt;START> 方向机 重 ...] -> [32800, 403, 986, 246, 231]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'13. 数据集转换 将词转换成索引[&lt;START> 方向机 重 ...] -> [32800, 403, 986, 246, 231]'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练集X执行transform_data中......'</span><span class="token punctuation">)</span>    train_ids_x <span class="token operator">=</span> train_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> transform_data<span class="token punctuation">(</span>x<span class="token punctuation">,</span> word_to_id<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练集Y执行transform_data中......'</span><span class="token punctuation">)</span>    train_ids_y <span class="token operator">=</span> train_df<span class="token punctuation">[</span><span class="token string">'Y'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> transform_data<span class="token punctuation">(</span>x<span class="token punctuation">,</span> word_to_id<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'测试集X执行transform_data中......'</span><span class="token punctuation">)</span>    test_ids_x <span class="token operator">=</span> test_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> transform_data<span class="token punctuation">(</span>x<span class="token punctuation">,</span> word_to_id<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 14. 数据转换成numpy数组(需等长)</span>    <span class="token comment" spellcheck="true"># 将索引列表转换成矩阵 [32800, 403, 986, 246, 231] --> array([[32800, 403, 986, 246, 231], ...])</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'14. 数据转换成numpy数组(需等长)'</span><span class="token punctuation">)</span>    train_X <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>train_ids_x<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    train_Y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>train_ids_y<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    test_X <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>test_ids_x<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'转换为numpy数组的形状如下: \ntrain_X的shape为: '</span><span class="token punctuation">,</span> train_X<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> <span class="token string">'\ntrain_Y的shape为: '</span><span class="token punctuation">,</span> train_Y<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> <span class="token string">'\ntest_X的shape为: '</span><span class="token punctuation">,</span> test_X<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 15. 保存数据</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'15. 保存数据......'</span><span class="token punctuation">)</span>    np<span class="token punctuation">.</span>save<span class="token punctuation">(</span>train_x_path<span class="token punctuation">,</span> train_X<span class="token punctuation">)</span>    np<span class="token punctuation">.</span>save<span class="token punctuation">(</span>train_y_path<span class="token punctuation">,</span> train_Y<span class="token punctuation">)</span>    np<span class="token punctuation">.</span>save<span class="token punctuation">(</span>test_x_path<span class="token punctuation">,</span> test_X<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'数据集构造完毕, 存储于seq2seq/data/目录下.'</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    build_dataset<span class="token punctuation">(</span>train_raw_data_path<span class="token punctuation">,</span> test_raw_data_path<span class="token punctuation">)</span></code></pre><h5 id="打印输出"><a href="#打印输出" class="headerlink" title="打印输出"></a>打印输出</h5><pre class=" language-python"><code class="language-python">Building prefix dict <span class="token keyword">from</span> the default dictionary <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>Loading model <span class="token keyword">from</span> cache <span class="token operator">/</span>tmp<span class="token operator">/</span>jieba<span class="token punctuation">.</span>cacheLoading model cost <span class="token number">0.753</span> seconds<span class="token punctuation">.</span>Prefix dict has been built successfully<span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">.</span> 加载原始数据<span class="token operator">/</span>home<span class="token operator">/</span>ec2<span class="token operator">-</span>user<span class="token operator">/</span>text_summary<span class="token operator">/</span>seq2seq<span class="token operator">/</span>data<span class="token operator">/</span>train<span class="token punctuation">.</span>csv原始训练集行数 <span class="token number">82943</span><span class="token punctuation">,</span> 测试集行数 <span class="token number">20000</span><span class="token number">2</span><span class="token punctuation">.</span> 空值去除（对于一行数据，任意列只要有空值就去掉该行）空值去除后训练集行数 <span class="token number">82871</span><span class="token punctuation">,</span> 测试集行数 <span class="token number">20000</span><span class="token number">3</span><span class="token punctuation">.</span> 多线程<span class="token punctuation">,</span> 批量数据预处理<span class="token punctuation">(</span>对每个句子执行sentence_proc，清除无用词，切词，过滤停用词，再用空格拼接为一个字符串<span class="token punctuation">)</span>sentences_proc has done!<span class="token number">4</span><span class="token punctuation">.</span> 合并训练测试集，用于训练词向量训练集行数<span class="token number">82871</span><span class="token punctuation">,</span> 测试集行数<span class="token number">20000</span><span class="token punctuation">,</span> 合并数据集行数<span class="token number">102871</span><span class="token number">5</span><span class="token punctuation">.</span> 保存分割处理好的train_seg_data<span class="token punctuation">.</span>csv、test_set_data<span class="token punctuation">.</span>csvThe csv_file has saved!<span class="token number">6</span><span class="token punctuation">.</span> 保存合并数据merged_seg_data<span class="token punctuation">.</span>csv，用于训练词向量The word_to_vector file has saved!总体单词总数count<span class="token operator">=</span> <span class="token number">124520</span>进入到字典中的单词总数number<span class="token operator">=</span> <span class="token number">32227</span>合并数据集的字典构造完毕<span class="token punctuation">,</span> word_to_id容量<span class="token punctuation">:</span>  <span class="token number">32227</span>最终构造完毕字典<span class="token punctuation">,</span> word_to_id容量<span class="token operator">=</span> <span class="token number">32227</span>count<span class="token operator">=</span> <span class="token number">32227</span><span class="token number">8</span><span class="token punctuation">.</span> 将Question和Dialogue用空格连接作为模型输入形成train_df<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token number">9</span><span class="token punctuation">.</span> 填充<span class="token operator">&lt;</span>START<span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>STOP<span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>UNK<span class="token operator">></span>和<span class="token operator">&lt;</span>PAD<span class="token operator">></span>，使数据变为等长填充前训练集样本的最大长度为<span class="token punctuation">:</span>  <span class="token number">298</span>填充前测试集样本的最大长度为<span class="token punctuation">:</span>  <span class="token number">312</span>填充前训练集标签的最大长度为<span class="token punctuation">:</span>  <span class="token number">38</span>训练集X填充PAD<span class="token punctuation">,</span>START<span class="token punctuation">,</span>STOP<span class="token punctuation">,</span>UNK处理中<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>测试集X填充PAD<span class="token punctuation">,</span>START<span class="token punctuation">,</span>STOP<span class="token punctuation">,</span>UNK处理中<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>训练集Y填充PAD<span class="token punctuation">,</span>START<span class="token punctuation">,</span>STOP<span class="token punctuation">,</span>UNK处理中<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">10</span><span class="token punctuation">.</span> 保存填充<span class="token operator">&lt;</span>START<span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>STOP<span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>UNK<span class="token operator">></span>和<span class="token operator">&lt;</span>PAD<span class="token operator">></span>后的X和Y填充后的三个文件保存完毕!训练集X字典构造完毕<span class="token punctuation">,</span> word_to_id容量<span class="token punctuation">:</span>  <span class="token number">32101</span>训练集Y字典构造完毕<span class="token punctuation">,</span> word_to_id容量<span class="token punctuation">:</span>  <span class="token number">32130</span>测试集X字典构造完毕<span class="token punctuation">,</span> word_to_id容量<span class="token punctuation">:</span>  <span class="token number">32217</span>单词总数量count<span class="token operator">=</span>  <span class="token number">32217</span>逆向字典构造完毕<span class="token punctuation">,</span> id_to_word容量<span class="token punctuation">:</span>  <span class="token number">32217</span>字典映射器word_to_id<span class="token punctuation">,</span> id_to_word保存完毕!<span class="token number">13</span><span class="token punctuation">.</span> 数据集转换 将词转换成索引  <span class="token punctuation">[</span><span class="token operator">&lt;</span>START<span class="token operator">></span> 方向机 重 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token number">32800</span><span class="token punctuation">,</span> <span class="token number">403</span><span class="token punctuation">,</span> <span class="token number">986</span><span class="token punctuation">,</span> <span class="token number">246</span><span class="token punctuation">,</span> <span class="token number">231</span><span class="token punctuation">]</span>训练集X执行transform_data中<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>训练集Y执行transform_data中<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>测试集X执行transform_data中<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">14</span><span class="token punctuation">.</span> 数据转换成numpy数组<span class="token punctuation">(</span>需等长<span class="token punctuation">)</span>转换为numpy数组的形状如下<span class="token punctuation">:</span> train_X的shape为<span class="token punctuation">:</span>  <span class="token punctuation">(</span><span class="token number">82871</span><span class="token punctuation">,</span> <span class="token number">314</span><span class="token punctuation">)</span> train_Y的shape为<span class="token punctuation">:</span>  <span class="token punctuation">(</span><span class="token number">82871</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span> test_X的shape为<span class="token punctuation">:</span>  <span class="token punctuation">(</span><span class="token number">20000</span><span class="token punctuation">,</span> <span class="token number">314</span><span class="token punctuation">)</span><span class="token number">15</span><span class="token punctuation">.</span> 保存数据数据集构造完毕，于seq2seq<span class="token operator">/</span>data<span class="token operator">/</span>目录下</code></pre><p><strong>结论</strong>: 通过五个步骤实现了全部的工具函数, 并完成了数据预处理. 后续模型类需要数据的时候, 可以直接通过加载文件的方式读取数据, 非常方便. 对于任意工业级别的项目来说, 数据预处理都处于非常重要的地位, 代码量和耗费的时间也占了整个项目很大的比例.</p><h4 id="模型类的实现"><a href="#模型类的实现" class="headerlink" title="模型类的实现"></a>模型类的实现</h4><ul><li><p>在模型类的实现过程中, 为了代码的解耦和结构清晰, 总共需要完成以下几个函数的实现:</p><ul><li>第一步: 实现批次数据加载的函数batcher.py</li><li>第二步: 实现模型中子层的函数layers.py</li><li>第三步: 实现模型类的函数model.py</li></ul></li><li><h5 id="第一步-实现批次数据加载的函数batcher-py"><a href="#第一步-实现批次数据加载的函数batcher-py" class="headerlink" title="第一步: 实现批次数据加载的函数batcher.py"></a>第一步: 实现批次数据加载的函数batcher.py</h5><ul><li>代码文件路径: /home/ec2-user/text_summary/seq2seq/src/batcher.py</li></ul></li></ul><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 导入工具包</span><span class="token keyword">import</span> os<span class="token keyword">import</span> sys<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">import</span> torch<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">import</span> DataLoader<span class="token punctuation">,</span> TensorDataset<span class="token comment" spellcheck="true"># 设定项目的rootL路径, 方便后续相关代码文件的导入</span>root_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>root_path<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 导入项目相关的代码文件</span><span class="token keyword">from</span> utils<span class="token punctuation">.</span>data_loader <span class="token keyword">import</span> load_train_dataset<span class="token punctuation">,</span> load_test_dataset<span class="token comment" spellcheck="true"># 训练批次数据生成器函数</span><span class="token keyword">def</span> <span class="token function">train_batch_generator</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> max_enc_len<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> max_dec_len<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> sample_num<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># batch_size: batch大小</span>    <span class="token comment" spellcheck="true"># max_enc_len: 样本最大长度</span>    <span class="token comment" spellcheck="true"># max_dec_len: 标签最大长度</span>    <span class="token comment" spellcheck="true"># sample_num: 限定样本个数大小</span>    <span class="token comment" spellcheck="true"># 直接从已经预处理好的数据文件中加载训练集数据</span>    train_X<span class="token punctuation">,</span> train_Y <span class="token operator">=</span> load_train_dataset<span class="token punctuation">(</span>max_enc_len<span class="token punctuation">,</span> max_dec_len<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 对数据进行限定长度的切分</span>    <span class="token keyword">if</span> sample_num<span class="token punctuation">:</span>        train_X <span class="token operator">=</span> train_X<span class="token punctuation">[</span><span class="token punctuation">:</span>sample_num<span class="token punctuation">]</span>        train_Y <span class="token operator">=</span> train_Y<span class="token punctuation">[</span><span class="token punctuation">:</span>sample_num<span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># 将numpy类型的数据转换为Pytorch下的tensor类型, 因为TensorDataset只接收tensor类型数据</span>    x_data <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>train_X<span class="token punctuation">)</span>    y_data <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>train_Y<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 第一步: 先对数据进行封装</span>    dataset <span class="token operator">=</span> TensorDataset<span class="token punctuation">(</span>x_data<span class="token punctuation">,</span> y_data<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 第二步: 再对dataset进行迭代器的构建</span>    <span class="token comment" spellcheck="true"># 如果机器没有GPU, 请采用下面的注释行代码</span>    <span class="token comment" spellcheck="true"># dataset = DataLoader(dataset, batch_size=batch_size, shuffle=True, drop_last=True)</span>    <span class="token comment" spellcheck="true"># 如果机器有GPU, 请采用下面的代码, 可以加速训练流程</span>    dataset <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> drop_last<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                         num_workers<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> pin_memory<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 计算每个epoch要循环多少次</span>    steps_per_epoch <span class="token operator">=</span> len<span class="token punctuation">(</span>train_X<span class="token punctuation">)</span> <span class="token operator">//</span> batch_size    <span class="token comment" spellcheck="true"># 将封装好的数据集和次数返回</span>    <span class="token keyword">return</span> dataset<span class="token punctuation">,</span> steps_per_epoch<span class="token comment" spellcheck="true"># 测试批次数据生成器函数</span><span class="token keyword">def</span> <span class="token function">test_batch_generator</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> max_enc_len<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># batch_size: batch大小</span>    <span class="token comment" spellcheck="true"># max_enc_len: 样本最大长度</span>    <span class="token comment" spellcheck="true"># 直接从已经预处理好的数据文件中加载测试集数据</span>    test_X <span class="token operator">=</span> load_test_dataset<span class="token punctuation">(</span>max_enc_len<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 将numpy类型的数据转换为Pytorch下的tensor类型, 因为TensorDataset只接收tensor类型数据</span>    x_data <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>test_X<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 第一步: 先对数据进行封装</span>    dataset <span class="token operator">=</span> TensorDataset<span class="token punctuation">(</span>x_data<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 第二步: 再对dataset进行迭代器的构建</span>    dataset <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> drop_last<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 计算每个epoch要循环多少次</span>    steps_per_epoch <span class="token operator">=</span> len<span class="token punctuation">(</span>test_X<span class="token punctuation">)</span> <span class="token operator">//</span> batch_size    <span class="token comment" spellcheck="true"># 将封装好的数据集和次数返回</span>    <span class="token keyword">return</span> dataset<span class="token punctuation">,</span> steps_per_epoch</code></pre><h5 id="打印-3"><a href="#打印-3" class="headerlink" title="打印"></a>打印</h5><pre class=" language-python"><code class="language-python">Building prefix dict <span class="token keyword">from</span> the default dictionary <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>Loading model <span class="token keyword">from</span> cache Loading model cost <span class="token number">0.829</span> seconds<span class="token punctuation">.</span>Prefix dict has been built successfully<span class="token punctuation">.</span>stop_words<span class="token punctuation">:</span>  <span class="token punctuation">[</span><span class="token string">':'</span><span class="token punctuation">,</span> <span class="token string">'：'</span><span class="token punctuation">,</span> <span class="token string">'———'</span><span class="token punctuation">,</span> <span class="token string">'》），'</span><span class="token punctuation">,</span> <span class="token string">'）÷（１－'</span><span class="token punctuation">,</span> <span class="token string">'”，'</span><span class="token punctuation">,</span> <span class="token string">'）、'</span><span class="token punctuation">,</span> <span class="token string">'＝（'</span><span class="token punctuation">,</span> <span class="token string">'→'</span><span class="token punctuation">,</span> <span class="token string">'℃'</span><span class="token punctuation">,</span> <span class="token string">'&amp;'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token string">'一一'</span><span class="token punctuation">,</span> <span class="token string">'~~~~'</span><span class="token punctuation">,</span> <span class="token string">'『'</span><span class="token punctuation">,</span> <span class="token string">'.一'</span><span class="token punctuation">,</span> <span class="token string">'./'</span><span class="token punctuation">,</span> <span class="token string">'--'</span><span class="token punctuation">,</span> <span class="token string">'』'</span><span class="token punctuation">,</span> <span class="token string">'＝″'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'！'</span><span class="token punctuation">,</span> <span class="token string">'以前'</span><span class="token punctuation">,</span> <span class="token string">'出现'</span><span class="token punctuation">,</span> <span class="token string">'过该'</span><span class="token punctuation">,</span> <span class="token string">'故障'</span><span class="token punctuation">,</span> <span class="token string">'？'</span><span class="token punctuation">,</span> <span class="token string">'缸'</span><span class="token punctuation">,</span> <span class="token string">'压'</span><span class="token punctuation">,</span> <span class="token string">'有没有'</span><span class="token punctuation">,</span> <span class="token string">'测量'</span><span class="token punctuation">,</span> <span class="token string">'一下'</span><span class="token punctuation">,</span> <span class="token string">'？'</span><span class="token punctuation">,</span> <span class="token string">'没有'</span><span class="token punctuation">,</span> <span class="token string">'没测'</span><span class="token punctuation">,</span> <span class="token string">'缸'</span><span class="token punctuation">,</span> <span class="token string">'压'</span><span class="token punctuation">,</span> <span class="token string">'测量'</span><span class="token punctuation">,</span> <span class="token string">'一下'</span><span class="token punctuation">,</span> <span class="token string">'缸'</span><span class="token punctuation">,</span> <span class="token string">'压'</span><span class="token punctuation">,</span> <span class="token string">'看'</span><span class="token punctuation">,</span> <span class="token string">'一四缸'</span><span class="token punctuation">,</span> <span class="token string">'缸'</span><span class="token punctuation">,</span> <span class="token string">'压'</span><span class="token punctuation">,</span> <span class="token string">'是否'</span><span class="token punctuation">,</span> <span class="token string">'偏低'</span><span class="token punctuation">,</span> <span class="token string">'电脑'</span><span class="token punctuation">,</span> <span class="token string">'测'</span><span class="token punctuation">,</span> <span class="token string">'，'</span><span class="token punctuation">,</span> <span class="token string">'14'</span><span class="token punctuation">,</span> <span class="token string">'缸'</span><span class="token punctuation">,</span> <span class="token string">'缺火'</span><span class="token punctuation">,</span> <span class="token string">'点火'</span><span class="token punctuation">,</span> <span class="token string">'线圈'</span><span class="token punctuation">,</span> <span class="token string">'火花塞'</span><span class="token punctuation">,</span> <span class="token string">'喷油嘴'</span><span class="token punctuation">,</span> <span class="token string">'不用'</span><span class="token punctuation">,</span> <span class="token string">'干活'</span><span class="token punctuation">,</span> <span class="token string">'直接'</span><span class="token punctuation">,</span> <span class="token string">'二三'</span><span class="token punctuation">,</span> <span class="token string">'缸'</span><span class="token punctuation">,</span> <span class="token string">'倒'</span><span class="token punctuation">,</span> <span class="token string">'一下'</span><span class="token punctuation">,</span> <span class="token string">'跑'</span><span class="token punctuation">,</span> <span class="token string">'一段'</span><span class="token punctuation">,</span> <span class="token string">'测量'</span><span class="token punctuation">,</span> <span class="token string">'一下'</span><span class="token punctuation">,</span> <span class="token string">'故障'</span><span class="token punctuation">,</span> <span class="token string">'码'</span><span class="token punctuation">,</span> <span class="token string">'进行'</span><span class="token punctuation">,</span> <span class="token string">'排除'</span><span class="token punctuation">,</span> <span class="token string">'师傅'</span><span class="token punctuation">,</span> <span class="token string">'还'</span><span class="token punctuation">,</span> <span class="token string">'调'</span><span class="token punctuation">,</span> <span class="token string">'一下'</span><span class="token punctuation">,</span> <span class="token string">'喷油嘴'</span><span class="token punctuation">,</span> <span class="token string">'测'</span><span class="token punctuation">,</span> <span class="token string">'一下'</span><span class="token punctuation">,</span> <span class="token string">'缸'</span><span class="token punctuation">,</span> <span class="token string">'压'</span><span class="token punctuation">,</span> <span class="token string">'都'</span><span class="token punctuation">,</span> <span class="token string">'正常'</span><span class="token punctuation">,</span> <span class="token string">'发动机'</span><span class="token punctuation">,</span> <span class="token string">'电脑板'</span><span class="token punctuation">,</span> <span class="token string">'问题'</span><span class="token punctuation">,</span> <span class="token string">'影响'</span><span class="token punctuation">,</span> <span class="token string">'不大'</span><span class="token punctuation">,</span> <span class="token string">'缸'</span><span class="token punctuation">,</span> <span class="token string">'压'</span><span class="token punctuation">,</span> <span class="token string">'八个'</span><span class="token punctuation">,</span> <span class="token string">'以上'</span><span class="token punctuation">,</span> <span class="token string">'正常'</span><span class="token punctuation">,</span> <span class="token string">'说'</span><span class="token punctuation">,</span> <span class="token string">'测量'</span><span class="token punctuation">,</span> <span class="token string">'缸'</span><span class="token punctuation">,</span> <span class="token string">'压'</span><span class="token punctuation">,</span> <span class="token string">'缸'</span><span class="token punctuation">,</span> <span class="token string">'压'</span><span class="token punctuation">,</span> <span class="token string">'正常'</span><span class="token punctuation">,</span> <span class="token string">'没有'</span><span class="token punctuation">,</span> <span class="token string">'问题'</span><span class="token punctuation">,</span> <span class="token string">'点击'</span><span class="token punctuation">,</span> <span class="token string">'头像'</span><span class="token punctuation">,</span> <span class="token string">'关注'</span><span class="token punctuation">,</span> <span class="token string">'问题'</span><span class="token punctuation">,</span> <span class="token string">'随时'</span><span class="token punctuation">,</span> <span class="token string">'询问'</span><span class="token punctuation">,</span> <span class="token string">'一定'</span><span class="token punctuation">,</span> <span class="token string">'真诚'</span><span class="token punctuation">,</span> <span class="token string">'用心'</span><span class="token punctuation">,</span> <span class="token string">'解决'</span><span class="token punctuation">,</span> <span class="token string">'师傅'</span><span class="token punctuation">,</span> <span class="token string">'，'</span><span class="token punctuation">,</span> <span class="token string">'谢谢'</span><span class="token punctuation">,</span> <span class="token string">'不用'</span><span class="token punctuation">,</span> <span class="token string">'客气'</span><span class="token punctuation">]</span>res<span class="token operator">=</span> ！ 以前 出现 过该 故障 ？ 缸 压 有没有 测量 一下 ？ 没有 没测 缸 压 测量 一下 缸 压 看 一四缸 缸 压 是否 偏低 电脑 测 ， <span class="token number">14</span> 缸 缺火 点火 线圈 火花塞 喷油嘴 不用 干活 直接 二三 缸 倒 一下 跑 一段 测量 一下 故障 码 进行 排除 师傅 还 调 一下 喷油嘴 测 一下 缸 压 都 正常 发动机 电脑板 问题 影响 不大 缸 压 八个 以上 正常 说 测量 缸 压 缸 压 正常 没有 问题 点击 头像 关注 问题 随时 询问 一定 真诚 用心 解决 师傅 ， 谢谢 不用 客气<span class="token operator">&lt;</span>torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>dataloader<span class="token punctuation">.</span>DataLoader object at <span class="token number">0x00000167C3F8DFC8</span><span class="token operator">></span><span class="token number">1294</span><span class="token operator">&lt;</span>torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>dataloader<span class="token punctuation">.</span>DataLoader object at <span class="token number">0x00000167C231BFC8</span><span class="token operator">></span><span class="token number">312</span></code></pre><ul><li><h5 id="第二步-实现模型中子层的函数layers-py"><a href="#第二步-实现模型中子层的函数layers-py" class="headerlink" title="第二步: 实现模型中子层的函数layers.py"></a>第二步: 实现模型中子层的函数layers.py</h5><ul><li>代码文件路径: /home/ec2-user/text_summary/seq2seq/src/layers.py</li></ul></li><li><p>为了完成模型中子层的构建, 我们需要分3个小步骤:</p></li><li><p>1: 实现编码器类Encoder.</p></li><li><p>2: 实现注意力类Attention.</p></li><li><p>3: 实现解码器类Decoder.</p></li><li><p>1: 实现编码器类Encoder.</p></li></ul><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 导入工具包</span><span class="token keyword">import</span> torch<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F<span class="token keyword">import</span> os<span class="token keyword">import</span> sys<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd<span class="token comment" spellcheck="true"># 设定项目的root路径, 方便后续的代码文件导入</span>root_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>root_path<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 导入项目相关的代码文件</span><span class="token keyword">from</span> utils<span class="token punctuation">.</span>config <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> utils<span class="token punctuation">.</span>word2vec_utils <span class="token keyword">import</span> get_vocab_from_model<span class="token comment" spellcheck="true"># 构建编码器类</span><span class="token keyword">class</span> <span class="token class-name">Encoder</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> vocab_size<span class="token punctuation">,</span> embedding_dim<span class="token punctuation">,</span> enc_units<span class="token punctuation">,</span> batch_size<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span>Encoder<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>vocab_size <span class="token operator">=</span> vocab_size        self<span class="token punctuation">.</span>embedding_dim <span class="token operator">=</span> embedding_dim        self<span class="token punctuation">.</span>enc_units <span class="token operator">=</span> enc_units        self<span class="token punctuation">.</span>batch_size <span class="token operator">=</span> batch_size        <span class="token comment" spellcheck="true"># 第一层: 词嵌入层</span>        self<span class="token punctuation">.</span>embedding <span class="token operator">=</span> nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span>vocab_size<span class="token punctuation">,</span> embedding_dim<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 第二层: GRU层</span>        self<span class="token punctuation">.</span>gru <span class="token operator">=</span> nn<span class="token punctuation">.</span>GRU<span class="token punctuation">(</span>input_size<span class="token operator">=</span>embedding_dim<span class="token punctuation">,</span> hidden_size<span class="token operator">=</span>enc_units<span class="token punctuation">,</span> num_layers<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> batch_first<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> h0<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># x.shape: (batch_size, sequence_length)</span>        <span class="token comment" spellcheck="true"># h0.shape: (num_layers, batch_size, enc_units)</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>embedding<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        output<span class="token punctuation">,</span> hn <span class="token operator">=</span> self<span class="token punctuation">.</span>gru<span class="token punctuation">(</span>x<span class="token punctuation">,</span> h0<span class="token punctuation">)</span>        <span class="token keyword">return</span> output<span class="token punctuation">,</span> hn<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">initialize_hidden_state</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># hidden state张量形状: (num_layers, batch_size, enc_units)</span>        <span class="token keyword">return</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>batch_size<span class="token punctuation">,</span> self<span class="token punctuation">.</span>enc_units<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Attention</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> enc_units<span class="token punctuation">,</span> dec_units<span class="token punctuation">,</span> attn_units<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span>Attention<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>enc_units <span class="token operator">=</span> enc_units        self<span class="token punctuation">.</span>dec_units <span class="token operator">=</span> dec_units        self<span class="token punctuation">.</span>attn_units <span class="token operator">=</span> attn_units        <span class="token comment" spellcheck="true"># 计算注意力的三次矩阵乘法, 对应着3个全连接层.</span>        self<span class="token punctuation">.</span>w1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>enc_units<span class="token punctuation">,</span> attn_units<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>w2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>dec_units<span class="token punctuation">,</span> attn_units<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>v <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>attn_units<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># query为上次的decoder隐藏层，shape: (batch_size, dec_units)</span>        <span class="token comment" spellcheck="true"># values为编码器的编码结果enc_output，shape: (batch_size, enc_seq_len, enc_units)</span>        <span class="token comment" spellcheck="true"># 在应用self.V之前，张量的形状是(batch_size, enc_seq_len, attention_units)</span>        <span class="token comment" spellcheck="true"># 得到score的shape: (batch_size, seq_len, 1)</span>        score <span class="token operator">=</span> self<span class="token punctuation">.</span>v<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>tanh<span class="token punctuation">(</span>self<span class="token punctuation">.</span>w1<span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>w2<span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 注意力权重，是score经过softmax，但是要作用在第一个轴上(seq_len的轴)</span>        attention_weights <span class="token operator">=</span> F<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>score<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># (batch_size, enc_seq_len, 1) * (batch_size, enc_seq_len, enc_units)</span>        <span class="token comment" spellcheck="true"># 广播, encoder unit的每个位置都对应相乘</span>        context_vector <span class="token operator">=</span> attention_weights <span class="token operator">*</span> value        <span class="token comment" spellcheck="true"># 在最大长度enc_seq_len这一维度上求和</span>        context_vector <span class="token operator">=</span> torch<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>context_vector<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># context_vector求和之后的shape: (batch_size, enc_units)</span>        <span class="token keyword">return</span> context_vector<span class="token punctuation">,</span> attention_weights</code></pre><h5 id="打印-4"><a href="#打印-4" class="headerlink" title="打印"></a>打印</h5><pre class=" language-python"><code class="language-python">torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">32217</span><span class="token punctuation">]</span><span class="token punctuation">)</span>torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><ul><li><h5 id="第三步-实现模型类的函数model-py"><a href="#第三步-实现模型类的函数model-py" class="headerlink" title="第三步: 实现模型类的函数model.py"></a>第三步: 实现模型类的函数model.py</h5><ul><li>代码文件路径: /home/ec2-user/text_summary/seq2seq/src/model.py</li></ul></li></ul><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">import</span> sys<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd<span class="token comment" spellcheck="true"># 设定项目的root路径, 方便后续代码文件的导入</span>root_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>root_path<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 导入工具包和项目相关的代码文件</span><span class="token keyword">import</span> torch<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn<span class="token keyword">from</span> src<span class="token punctuation">.</span>layers <span class="token keyword">import</span> Encoder<span class="token punctuation">,</span> Attention<span class="token punctuation">,</span> Decoder<span class="token keyword">from</span> utils<span class="token punctuation">.</span>config <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> utils<span class="token punctuation">.</span>word2vec_utils <span class="token keyword">import</span> get_vocab_from_model<span class="token comment" spellcheck="true"># 构建完整的seq2seq模型</span><span class="token keyword">class</span> <span class="token class-name">Seq2Seq</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span>Seq2Seq<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>params <span class="token operator">=</span> params        <span class="token comment" spellcheck="true"># 第一层: 编码器层</span>        self<span class="token punctuation">.</span>encoder <span class="token operator">=</span> Encoder<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token string">'vocab_size'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> params<span class="token punctuation">[</span><span class="token string">'embed_size'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                               params<span class="token punctuation">[</span><span class="token string">'enc_units'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> params<span class="token punctuation">[</span><span class="token string">'batch_size'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 第二层: 注意力机制层</span>        self<span class="token punctuation">.</span>attention <span class="token operator">=</span> Attention<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token string">'enc_units'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> params<span class="token punctuation">[</span><span class="token string">'dec_units'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> params<span class="token punctuation">[</span><span class="token string">'attn_units'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 第三层: 解码器层</span>        self<span class="token punctuation">.</span>decoder <span class="token operator">=</span> Decoder<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token string">'vocab_size'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> params<span class="token punctuation">[</span><span class="token string">'embed_size'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                               params<span class="token punctuation">[</span><span class="token string">'dec_units'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> params<span class="token punctuation">[</span><span class="token string">'batch_size'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 实质上是在调用解码器,因为需要注意力机制,直接封装到forward中. 要调用编码器直接encoder()即可</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dec_input<span class="token punctuation">,</span> dec_hidden<span class="token punctuation">,</span> enc_output<span class="token punctuation">,</span> dec_target<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># 这里的dec_input实质是(batch_size, 1)大小的&lt;START></span>        predictions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true"># 拿编码器的输出和最终隐含层向量来计算</span>        context_vector<span class="token punctuation">,</span> attention_weights <span class="token operator">=</span> self<span class="token punctuation">.</span>attention<span class="token punctuation">(</span>dec_hidden<span class="token punctuation">,</span> enc_output<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 循环解码</span>        <span class="token keyword">for</span> t <span class="token keyword">in</span> range<span class="token punctuation">(</span>dec_target<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true"># dec_input (batch_size, 1); dec_hidden (batch_size, hidden_units)</span>            pred<span class="token punctuation">,</span> dec_hidden <span class="token operator">=</span> self<span class="token punctuation">.</span>decoder<span class="token punctuation">(</span>dec_input<span class="token punctuation">,</span> context_vector<span class="token punctuation">)</span>            context_vector<span class="token punctuation">,</span> attention_weights <span class="token operator">=</span> self<span class="token punctuation">.</span>attention<span class="token punctuation">(</span>dec_hidden<span class="token punctuation">,</span> enc_output<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 使用teacher forcing, 并扩展维度到三维张量</span>            dec_input <span class="token operator">=</span> dec_target<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> t<span class="token punctuation">]</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>            predictions<span class="token punctuation">.</span>append<span class="token punctuation">(</span>pred<span class="token punctuation">)</span>        <span class="token keyword">return</span> torch<span class="token punctuation">.</span>stack<span class="token punctuation">(</span>predictions<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dec_hidden<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># word_to_id, id_to_word = get_vocab_from_model(vocab_path, reverse_vocab_path)</span>    word_to_id <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>    vocab_size <span class="token operator">=</span> len<span class="token punctuation">(</span>word_to_id<span class="token punctuation">)</span>    batch_size <span class="token operator">=</span> <span class="token number">64</span>    input_seq_len <span class="token operator">=</span> <span class="token number">300</span>    <span class="token comment" spellcheck="true"># 模拟测试参数</span>    params <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"vocab_size": vocab_size, "embed_size": 500, "enc_units": 512,</span>              <span class="token string">"attn_units"</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">"dec_units"</span><span class="token punctuation">:</span> <span class="token number">512</span><span class="token punctuation">,</span><span class="token string">"batch_size"</span><span class="token punctuation">:</span> batch_size<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>    <span class="token comment" spellcheck="true"># 实例化类对象</span>    model <span class="token operator">=</span> Seq2Seq<span class="token punctuation">(</span>params<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 初始化测试输入数据</span>    sample_input_batch <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> input_seq_len<span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>long<span class="token punctuation">)</span>    sample_hidden <span class="token operator">=</span> model<span class="token punctuation">.</span>encoder<span class="token punctuation">.</span>initialize_hidden_state<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 调用Encoder进行编码</span>    sample_output<span class="token punctuation">,</span> sample_hidden <span class="token operator">=</span> model<span class="token punctuation">.</span>encoder<span class="token punctuation">(</span>sample_input_batch<span class="token punctuation">,</span> sample_hidden<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 打印输出张量维度</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Encoder output shape: (batch_size, enc_seq_len, enc_units) &amp;#123;&amp;#125;'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>sample_output<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Encoder Hidden state shape: (batch_size, enc_units) &amp;#123;&amp;#125;'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>sample_hidden<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 调用Attention进行注意力张量</span>    context_vector<span class="token punctuation">,</span> attention_weights <span class="token operator">=</span> model<span class="token punctuation">.</span>attention<span class="token punctuation">(</span>sample_hidden<span class="token punctuation">,</span> sample_output<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Attention context_vector shape: (batch_size, enc_units) &amp;#123;&amp;#125;"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>context_vector<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Attention weights shape: (batch_size, sequence_length, 1) &amp;#123;&amp;#125;"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>attention_weights<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 调用Decoder进行解码</span>    dec_input <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>long<span class="token punctuation">)</span>    sample_decoder_output<span class="token punctuation">,</span> _<span class="token punctuation">,</span> <span class="token operator">=</span> model<span class="token punctuation">.</span>decoder<span class="token punctuation">(</span>dec_input<span class="token punctuation">,</span> context_vector<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Decoder output shape: (batch_size, vocab_size) &amp;#123;&amp;#125;'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>sample_decoder_output<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 这里仅测试一步，没有用到dec_seq_len</span></code></pre><h6 id="打印-5"><a href="#打印-5" class="headerlink" title="打印"></a>打印</h6><pre class=" language-python"><code class="language-python">Encoder output shape<span class="token punctuation">:</span> <span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> enc_seq_len<span class="token punctuation">,</span> enc_units<span class="token punctuation">)</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">)</span>Encoder Hidden state shape<span class="token punctuation">:</span> <span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> enc_units<span class="token punctuation">)</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">)</span>Attention context_vector shape<span class="token punctuation">:</span> <span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> enc_units<span class="token punctuation">)</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">)</span>Attention weights shape<span class="token punctuation">:</span> <span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> sequence_length<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>Decoder output shape<span class="token punctuation">:</span> <span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> vocab_size<span class="token punctuation">)</span> torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">32216</span><span class="token punctuation">]</span><span class="token punctuation">)</span>Process finished <span class="token keyword">with</span> exit code <span class="token number">0</span></code></pre><h4 id="训练和测试函数的实现"><a href="#训练和测试函数的实现" class="headerlink" title="训练和测试函数的实现"></a>训练和测试函数的实现</h4><ul><li>构建完成模型类后, 我们要分别实现训练函数和测试函数:<ul><li>第一步: 编写训练辅助函数train_helper.py</li><li>第二步: 编写训练主函数train.py</li><li>第三步: 编写测试辅助函数test_helper.py</li><li>第四步: 编写测试主函数test.py</li></ul></li></ul><hr><ul><li>第一步: 编写训练辅助函数train_helper.py<ul><li>代码文件路径: /home/ec2-user/text_summary/seq2seq/src/train_helper.py </li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1：文本摘要项目理论&quot;&gt;&lt;a href=&quot;#1：文本摘要项目理论&quot; class=&quot;headerlink&quot; title=&quot;1：文本摘要项目理论&quot;&gt;&lt;/a&gt;&lt;strong&gt;1：文本摘要项目理论&lt;/strong&gt;&lt;/h2&gt;&lt;h4 id=&quot;基本概念&quot;&gt;&lt;a href=&quot;#</summary>
      
    
    
    
    <category term="NLP" scheme="https://xiaoyvlongoing.github.io/categories/NLP/"/>
    
    
    <category term="文本摘要" scheme="https://xiaoyvlongoing.github.io/tags/%E6%96%87%E6%9C%AC%E6%91%98%E8%A6%81/"/>
    
  </entry>
  
</feed>
